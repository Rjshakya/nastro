diff --git a/dist/chunk-EAOE5RX7.mjs b/dist/chunk-EAOE5RX7.mjs
index 41955b7d0ef7012ba8412206795f5e274d695c17..8fecda0f687aea3e7c473be75b312ebfcd9a96d4 100644
--- a/dist/chunk-EAOE5RX7.mjs
+++ b/dist/chunk-EAOE5RX7.mjs
@@ -1,21 +1,285 @@
-import {Client}from'@notionhq/client';import*as y from'fs';import*as h from'path';import {Project}from'ts-morph';function N(t){return /[^a-zA-Z0-9_$]/.test(t)?`"${t}"`:t}var I=(t,e)=>{switch(t){case "title":case "rich_text":case "url":case "email":case "phone_number":return "string";case "number":return "number";case "select":return e&&"select"in e&&e.select&&"options"in e.select&&Array.isArray(e.select.options)&&e.select.options.length>0?e.select.options.map(s=>`"${s.name}"`).join(" | "):"string";case "multi_select":return e&&"multi_select"in e&&e.multi_select&&"options"in e.multi_select&&Array.isArray(e.multi_select.options)&&e.multi_select.options.length>0?`Array<${e.multi_select.options.map(i=>`"${i.name}"`).join(" | ")}>`:"string[]";case "date":return "Date";case "people":return "string[]";case "files":return "{ name: string; url: string; }[]";case "checkbox":return "boolean";case "formula":return "any";case "relation":return "string[]";case "rollup":return "any";case "created_time":case "last_edited_time":return "string";case "created_by":case "last_edited_by":return "{ id: string; name: string | null; avatar_url: string | null; }";default:return "any"}};function v(t){let e=t.replace(/[^\w\s]/g,"").replace(/\s+(.)/g,(s,i)=>i.toUpperCase()).replace(/\s/g,"");return "Record"+e.charAt(0).toUpperCase()+e.slice(1)}function k(t){return `notion-types-${t.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g,"-")}.ts`}function R(t,e){if(!t||typeof t!="object")throw console.error(`[generator] Invalid properties received for database ${e.databaseName} (${e.databaseId}).`,{properties:t}),new Error("Notion database response does not include a valid properties object.");let s=[];for(let[i,o]of Object.entries(t)){if(!o||typeof o!="object"||!("type"in o)||typeof o.type!="string"){console.warn(`[generator] Skipping property "${i}" for database ${e.databaseName} (${e.databaseId}) because it is missing a valid type.`,{property:o});continue}s.push([i,o]);}if(s.length===0)throw console.error(`[generator] No usable properties found for database ${e.databaseName} (${e.databaseId}).`,{properties:t}),new Error("Unable to generate types because no usable properties were found in the Notion schema response.");return s}async function Y(t,e,s){let o=await new Client({auth:s}).databases.retrieve({database_id:t}),p=o.properties,u="NotionDatabase",r=o;if(r.title&&Array.isArray(r.title)&&r.title.length>0){let n=r.title[0].plain_text;n&&(u=n);}if(u==="NotionDatabase"){u=t.replace(/-/g,"").substring(0,12);let n=Object.keys(p).find($=>p[$].type==="title");n&&(u=n);}let m=v(u),d=k(u);y.mkdirSync(e,{recursive:true});let g=h.join(e,d),a=new Project().createSourceFile(g,"",{overwrite:true});M(a,p,m,u,t),await a.save(),F(e,d);}function F(t,e){let s=h.join(t,"index.ts");y.existsSync(s)||y.writeFileSync(s,`// Auto-generated index file for Notion CMS types
+import { Client } from "@notionhq/client";
+import * as y from "fs";
+import * as h from "path";
+import { Project } from "ts-morph";
+function N(t) {
+  return /[^a-zA-Z0-9_$]/.test(t) ? `"${t}"` : t;
+}
+var I = (t, e) => {
+  switch (t) {
+    case "title":
+    case "rich_text":
+    case "url":
+    case "email":
+    case "phone_number":
+      return "string";
+    case "number":
+      return "number";
+    case "select":
+      return e &&
+        "select" in e &&
+        e.select &&
+        "options" in e.select &&
+        Array.isArray(e.select.options) &&
+        e.select.options.length > 0
+        ? e.select.options.map((s) => `"${s.name}"`).join(" | ")
+        : "string";
+    case "multi_select":
+      return e &&
+        "multi_select" in e &&
+        e.multi_select &&
+        "options" in e.multi_select &&
+        Array.isArray(e.multi_select.options) &&
+        e.multi_select.options.length > 0
+        ? `Array<${e.multi_select.options.map((i) => `"${i.name}"`).join(" | ")}>`
+        : "string[]";
+    case "date":
+      return "Date";
+    case "people":
+      return "string[]";
+    case "files":
+      return "{ name: string; url: string; }[]";
+    case "checkbox":
+      return "boolean";
+    case "formula":
+      return "any";
+    case "relation":
+      return "string[]";
+    case "rollup":
+      return "any";
+    case "created_time":
+    case "last_edited_time":
+      return "string";
+    case "created_by":
+    case "last_edited_by":
+      return "{ id: string; name: string | null; avatar_url: string | null; }";
+    default:
+      return "any";
+  }
+};
+function v(t) {
+  let e = t
+    .replace(/[^\w\s]/g, "")
+    .replace(/\s+(.)/g, (s, i) => i.toUpperCase())
+    .replace(/\s/g, "");
+  return "Record" + e.charAt(0).toUpperCase() + e.slice(1);
+}
+function k(t) {
+  return `notion-types-${t
+    .toLowerCase()
+    .replace(/[^\w\s]/g, "")
+    .replace(/\s+/g, "-")}.ts`;
+}
+function R(t, e) {
+  if (!t || typeof t != "object")
+    throw (
+      console.error(
+        `[generator] Invalid properties received for database ${e.databaseName} (${e.databaseId}).`,
+        { properties: t },
+      ),
+      new Error(
+        "Notion database response does not include a valid properties object.",
+      )
+    );
+  let s = [];
+  for (let [i, o] of Object.entries(t)) {
+    if (
+      !o ||
+      typeof o != "object" ||
+      !("type" in o) ||
+      typeof o.type != "string"
+    ) {
+      console.warn(
+        `[generator] Skipping property "${i}" for database ${e.databaseName} (${e.databaseId}) because it is missing a valid type.`,
+        { property: o },
+      );
+      continue;
+    }
+    s.push([i, o]);
+  }
+  if (s.length === 0)
+    throw (
+      console.error(
+        `[generator] No usable properties found for database ${e.databaseName} (${e.databaseId}).`,
+        { properties: t },
+      ),
+      new Error(
+        "Unable to generate types because no usable properties were found in the Notion schema response.",
+      )
+    );
+  return s;
+}
+async function Y(t, e, s) {
+  let o = await new Client({ auth: s , fetch:fetch.bind(globalThis) }).databases.retrieve({ database_id: t }),
+    p = o.properties,
+    u = "NotionDatabase",
+    r = o;
+  if (r.title && Array.isArray(r.title) && r.title.length > 0) {
+    let n = r.title[0].plain_text;
+    n && (u = n);
+  }
+  if (u === "NotionDatabase") {
+    u = t.replace(/-/g, "").substring(0, 12);
+    let n = Object.keys(p).find(($) => p[$].type === "title");
+    n && (u = n);
+  }
+  let m = v(u),
+    d = k(u);
+  y.mkdirSync(e, { recursive: true });
+  let g = h.join(e, d),
+    a = new Project().createSourceFile(g, "", { overwrite: true });
+  (M(a, p, m, u, t), await a.save(), F(e, d));
+}
+function F(t, e) {
+  let s = h.join(t, "index.ts");
+  y.existsSync(s) ||
+    y.writeFileSync(
+      s,
+      `// Auto-generated index file for Notion CMS types
 
 // Export database-specific types
-`);let i=`// Auto-generated index file for Notion CMS types
+`,
+    );
+  let i = `// Auto-generated index file for Notion CMS types
 
 // Export database-specific types
-`,o=`import './${e.replace(".ts","")}';
-`;o+=`export * from './${e.replace(".ts","")}';`,i.includes(o)||(i+=`${o}
-`,y.writeFileSync(s,i));}function M(t,e,s,i,o){try{let p=R(e,{databaseId:o,databaseName:i});t.addStatements(`/**
+`,
+    o = `import './${e.replace(".ts", "")}';
+`;
+  ((o += `export * from './${e.replace(".ts", "")}';`),
+    i.includes(o) ||
+      ((i += `${o}
+`),
+      y.writeFileSync(s, i)));
+}
+function M(t, e, s, i, o) {
+  try {
+    let p = R(e, { databaseId: o, databaseName: i });
+    (t.addStatements(`/**
  * THIS FILE IS AUTO-GENERATED BY NOTION-CMS
  * DO NOT EDIT DIRECTLY - YOUR CHANGES WILL BE OVERWRITTEN
  * v0.1.3
  * Generated for database: ${i}
- */`),t.addImportDeclaration({moduleSpecifier:"@mikemajara/notion-cms",namedImports:["DatabaseRecord","NotionCMS","DatabaseFieldMetadata"]}),t.addImportDeclaration({moduleSpecifier:"@notionhq/client/build/src/api-endpoints",namedImports:["PageObjectResponse"]}),t.addExportDeclaration({moduleSpecifier:"@mikemajara/notion-cms",namedExports:["NotionCMS"]});let u=a=>{switch(a){case "title":return "{ content: string; annotations: any; href: string | null; link?: { url: string } | null }[]";case "rich_text":return "{ content: string; annotations: any; href: string | null; link?: { url: string } | null }[]";case "number":return "number";case "select":return "{ id: string; name: string; color: string } | null";case "multi_select":return "{ id: string; name: string; color: string }[]";case "date":return "{ start: string; end: string | null; time_zone: string | null; parsedStart: Date | null; parsedEnd: Date | null } | null";case "people":return "{ id: string; name: string | null; avatar_url: string | null; object: string; type: string; email?: string }[]";case "files":return "{ name: string; type: string; external?: { url: string }; file?: { url: string; expiry_time: string } }[]";case "checkbox":return "boolean";case "url":return "string";case "email":return "string";case "phone_number":return "string";case "formula":return "{ type: string; value: any }";case "relation":return "{ id: string }[]";case "rollup":return "{ type: string; function: string; array?: any[]; number?: number; date?: any }";case "created_time":return "{ timestamp: string; date: Date }";case "created_by":case "last_edited_by":return "{ id: string; name: string | null; avatar_url: string | null; object: string; type: string; email?: string }";case "last_edited_time":return "{ timestamp: string; date: Date }";case "status":return "{ id: string; name: string; color: string } | null";case "unique_id":return "{ prefix: string | null; number: number }";default:return "any"}},r=[];r.push(`export const ${s}FieldTypes = {`),r.push('  "id": { type: "unique_id" },');for(let[a,n]of p)if(n.type==="select"||n.type==="multi_select"){let f=((n.type==="select"?n.select?.options:n.multi_select?.options)??[]).map(_=>`"${_.name}"`).join(", ");f.length===0&&console.warn(`[generator] Property "${a}" in database ${i} (${o}) declares type ${n.type} but contains no options. Falling back to empty options array.`,{property:n}),r.push(`  "${a}": { 
+ */`),
+      t.addImportDeclaration({
+        moduleSpecifier: "@mikemajara/notion-cms",
+        namedImports: ["DatabaseRecord", "NotionCMS", "DatabaseFieldMetadata"],
+      }),
+      t.addImportDeclaration({
+        moduleSpecifier: "@notionhq/client/build/src/api-endpoints",
+        namedImports: ["PageObjectResponse"],
+      }),
+      t.addExportDeclaration({
+        moduleSpecifier: "@mikemajara/notion-cms",
+        namedExports: ["NotionCMS"],
+      }));
+    let u = (a) => {
+        switch (a) {
+          case "title":
+            return "{ content: string; annotations: any; href: string | null; link?: { url: string } | null }[]";
+          case "rich_text":
+            return "{ content: string; annotations: any; href: string | null; link?: { url: string } | null }[]";
+          case "number":
+            return "number";
+          case "select":
+            return "{ id: string; name: string; color: string } | null";
+          case "multi_select":
+            return "{ id: string; name: string; color: string }[]";
+          case "date":
+            return "{ start: string; end: string | null; time_zone: string | null; parsedStart: Date | null; parsedEnd: Date | null } | null";
+          case "people":
+            return "{ id: string; name: string | null; avatar_url: string | null; object: string; type: string; email?: string }[]";
+          case "files":
+            return "{ name: string; type: string; external?: { url: string }; file?: { url: string; expiry_time: string } }[]";
+          case "checkbox":
+            return "boolean";
+          case "url":
+            return "string";
+          case "email":
+            return "string";
+          case "phone_number":
+            return "string";
+          case "formula":
+            return "{ type: string; value: any }";
+          case "relation":
+            return "{ id: string }[]";
+          case "rollup":
+            return "{ type: string; function: string; array?: any[]; number?: number; date?: any }";
+          case "created_time":
+            return "{ timestamp: string; date: Date }";
+          case "created_by":
+          case "last_edited_by":
+            return "{ id: string; name: string | null; avatar_url: string | null; object: string; type: string; email?: string }";
+          case "last_edited_time":
+            return "{ timestamp: string; date: Date }";
+          case "status":
+            return "{ id: string; name: string; color: string } | null";
+          case "unique_id":
+            return "{ prefix: string | null; number: number }";
+          default:
+            return "any";
+        }
+      },
+      r = [];
+    (r.push(`export const ${s}FieldTypes = {`),
+      r.push('  "id": { type: "unique_id" },'));
+    for (let [a, n] of p)
+      if (n.type === "select" || n.type === "multi_select") {
+        let f = (
+          (n.type === "select" ? n.select?.options : n.multi_select?.options) ??
+          []
+        )
+          .map((_) => `"${_.name}"`)
+          .join(", ");
+        (f.length === 0 &&
+          console.warn(
+            `[generator] Property "${a}" in database ${i} (${o}) declares type ${n.type} but contains no options. Falling back to empty options array.`,
+            { property: n },
+          ),
+          r.push(`  "${a}": { 
     type: "${n.type}",
     options: [${f}] as const
-  },`);}else r.push(`  "${a}": { type: "${n.type}" },`);r.push("} as const satisfies DatabaseFieldMetadata;"),t.addStatements(r.join(`
-`));let m=s,d=`${m}Advanced`,g=`${m}Raw`;t.addInterface({name:d,properties:[{name:"id",type:"string"},...p.map(([a,n])=>({name:N(a),type:u(n.type)}))],isExported:!0}),t.addInterface({name:g,properties:[{name:"id",type:"string"},{name:"properties",type:"Record<string, any>"}],isExported:!0}),t.addInterface({name:m,extends:["DatabaseRecord"],properties:[{name:"id",type:"string"},...p.map(([a,n])=>({name:N(a),type:I(n.type,n)}))],isExported:!0});let b=i.replace(/[^\w\s]/g,"").replace(/\s+(.)/g,(a,n)=>n.toUpperCase()).replace(/\s/g,"").replace(/^./,a=>a.toLowerCase());t.addStatements(`
+  },`));
+      } else r.push(`  "${a}": { type: "${n.type}" },`);
+    (r.push("} as const satisfies DatabaseFieldMetadata;"),
+      t.addStatements(
+        r.join(`
+`),
+      ));
+    let m = s,
+      d = `${m}Advanced`,
+      g = `${m}Raw`;
+    (t.addInterface({
+      name: d,
+      properties: [
+        { name: "id", type: "string" },
+        ...p.map(([a, n]) => ({ name: N(a), type: u(n.type) })),
+      ],
+      isExported: !0,
+    }),
+      t.addInterface({
+        name: g,
+        properties: [
+          { name: "id", type: "string" },
+          { name: "properties", type: "Record<string, any>" },
+        ],
+        isExported: !0,
+      }),
+      t.addInterface({
+        name: m,
+        extends: ["DatabaseRecord"],
+        properties: [
+          { name: "id", type: "string" },
+          ...p.map(([a, n]) => ({ name: N(a), type: I(n.type, n) })),
+        ],
+        isExported: !0,
+      }));
+    let b = i
+      .replace(/[^\w\s]/g, "")
+      .replace(/\s+(.)/g, (a, n) => n.toUpperCase())
+      .replace(/\s/g, "")
+      .replace(/^./, (a) => a.toLowerCase());
+    t.addStatements(`
 // Extend DatabaseRegistry interface with this database
 declare module "@mikemajara/notion-cms" {
   interface DatabaseRegistry {
@@ -33,19 +297,156 @@ NotionCMS.prototype.databases["${b}"] = {
   id: process.env.NOTION_CMS_${b.toUpperCase()}_DATABASE_ID || "${o}",
   fields: ${s}FieldTypes,
 };
-`);}catch(p){console.error("Error generating database-specific types:",p);}}async function q(t,e,s){let i=new Client({auth:s}),p=h.join(e,"notion-types-combined.ts"),r=new Project().createSourceFile(p,"",{overwrite:true});r.addStatements(`/**
+`);
+  } catch (p) {
+    console.error("Error generating database-specific types:", p);
+  }
+}
+async function q(t, e, s) {
+  let i = new Client({ auth: s  , fetch:fetch.bind(globalThis)}),
+    p = h.join(e, "notion-types-combined.ts"),
+    r = new Project().createSourceFile(p, "", { overwrite: true });
+  (r.addStatements(`/**
  * THIS FILE IS AUTO-GENERATED BY NOTION-CMS
  * DO NOT EDIT DIRECTLY - YOUR CHANGES WILL BE OVERWRITTEN
  * 
  * Generated for multiple databases: ${t.join(", ")}
- */`),r.addImportDeclaration({moduleSpecifier:"@mikemajara/notion-cms",namedImports:["DatabaseRecord","NotionCMS","DatabaseFieldMetadata"]});let m=[];for(let d of t)try{console.log(`Processing database: ${d}`);let g=await i.databases.retrieve({database_id:d}),b=g.properties,a=`Database${d.substring(0,8)}`,n=g;if(n.title&&Array.isArray(n.title)&&n.title.length>0){let l=n.title[0].plain_text;l&&(a=l);}let $=v(a),f=R(b,{databaseId:d,databaseName:a}),_=`query${a.replace(/[^\w\s]/g,"").replace(/\s+(.)/g,(l,c)=>c.toUpperCase()).replace(/\s/g,"").replace(/^./,l=>l.toUpperCase())}`,T=1,A=_;for(;m.includes(_);)_=`${A}${T}`,T++;m.push(_),r.addStatements(`
+ */`),
+    r.addImportDeclaration({
+      moduleSpecifier: "@mikemajara/notion-cms",
+      namedImports: ["DatabaseRecord", "NotionCMS", "DatabaseFieldMetadata"],
+    }));
+  let m = [];
+  for (let d of t)
+    try {
+      console.log(`Processing database: ${d}`);
+      let g = await i.databases.retrieve({ database_id: d }),
+        b = g.properties,
+        a = `Database${d.substring(0, 8)}`,
+        n = g;
+      if (n.title && Array.isArray(n.title) && n.title.length > 0) {
+        let l = n.title[0].plain_text;
+        l && (a = l);
+      }
+      let $ = v(a),
+        f = R(b, { databaseId: d, databaseName: a }),
+        _ = `query${a
+          .replace(/[^\w\s]/g, "")
+          .replace(/\s+(.)/g, (l, c) => c.toUpperCase())
+          .replace(/\s/g, "")
+          .replace(/^./, (l) => l.toUpperCase())}`,
+        T = 1,
+        A = _;
+      for (; m.includes(_); ) ((_ = `${A}${T}`), T++);
+      (m.push(_),
+        r.addStatements(`
 // ============================================================================
 // ${a} Database Types
 // ============================================================================
-`),r.addStatements(`export const ${$}FieldTypes = {`),r.addStatements('  "id": { type: "string" },');for(let[l,c]of f)if(c.type==="select"||c.type==="multi_select"){let x=((c.type==="select"?c.select?.options:c.multi_select?.options)??[]).map(O=>`"${O.name}"`).join(", ");x.length===0&&console.warn(`[generator] Property "${l}" in database ${a} (${d}) declares type ${c.type} but contains no options. Falling back to empty options array.`,{property:c}),r.addStatements(`  "${l}": { 
+`),
+        r.addStatements(`export const ${$}FieldTypes = {`),
+        r.addStatements('  "id": { type: "string" },'));
+      for (let [l, c] of f)
+        if (c.type === "select" || c.type === "multi_select") {
+          let x = (
+            (c.type === "select"
+              ? c.select?.options
+              : c.multi_select?.options) ?? []
+          )
+            .map((O) => `"${O.name}"`)
+            .join(", ");
+          (x.length === 0 &&
+            console.warn(
+              `[generator] Property "${l}" in database ${a} (${d}) declares type ${c.type} but contains no options. Falling back to empty options array.`,
+              { property: c },
+            ),
+            r.addStatements(`  "${l}": { 
     type: "${c.type}",
     options: [${x}] as const
-  },`);}else r.addStatements(`  "${l}": { type: "${c.type}" },`);r.addStatements("} as const satisfies DatabaseFieldMetadata;");let P=l=>{switch(l){case "title":return "{ content: string; annotations: any; href: string | null; link?: { url: string } | null }[]";case "rich_text":return "{ content: string; annotations: any; href: string | null; link?: { url: string } | null }[]";case "number":return "number";case "select":return "{ id: string; name: string; color: string } | null";case "multi_select":return "{ id: string; name: string; color: string }[]";case "date":return "{ start: string; end: string | null; time_zone: string | null; parsedStart: Date | null; parsedEnd: Date | null } | null";case "people":return "{ id: string; name: string | null; avatar_url: string | null; object: string; type: string; email?: string }[]";case "files":return "{ name: string; type: string; external?: { url: string }; file?: { url: string; expiry_time: string } }[]";case "checkbox":return "boolean";case "url":return "string";case "email":return "string";case "phone_number":return "string";case "formula":return "{ type: string; value: any }";case "relation":return "{ id: string }[]";case "rollup":return "{ type: string; function: string; array?: any[]; number?: number; date?: any }";case "created_time":return "{ timestamp: string; date: Date }";case "created_by":case "last_edited_by":return "{ id: string; name: string | null; avatar_url: string | null; object: string; type: string; email?: string }";case "last_edited_time":return "{ timestamp: string; date: Date }";case "status":return "{ id: string; name: string; color: string } | null";case "unique_id":return "{ prefix: string | null; number: number }";default:return "any"}},S=$,E=`${S}Advanced`,D=`${S}Raw`;r.addInterface({name:E,properties:[{name:"id",type:"string"},...f.map(([l,c])=>({name:N(l),type:P(c.type)}))],isExported:!0}),r.addInterface({name:D,properties:[{name:"id",type:"string"},{name:"properties",type:"Record<string, any>"}],isExported:!0}),r.addInterface({name:S,extends:["DatabaseRecord"],properties:[{name:"id",type:"string"},...f.map(([l,c])=>({name:N(l),type:I(c.type,c)})),{name:"advanced",type:E},{name:"raw",type:D}],isExported:!0});}catch(g){console.error(`Error processing database ${d}:`,g);}r.addStatements(`
+  },`));
+        } else r.addStatements(`  "${l}": { type: "${c.type}" },`);
+      r.addStatements("} as const satisfies DatabaseFieldMetadata;");
+      let P = (l) => {
+          switch (l) {
+            case "title":
+              return "{ content: string; annotations: any; href: string | null; link?: { url: string } | null }[]";
+            case "rich_text":
+              return "{ content: string; annotations: any; href: string | null; link?: { url: string } | null }[]";
+            case "number":
+              return "number";
+            case "select":
+              return "{ id: string; name: string; color: string } | null";
+            case "multi_select":
+              return "{ id: string; name: string; color: string }[]";
+            case "date":
+              return "{ start: string; end: string | null; time_zone: string | null; parsedStart: Date | null; parsedEnd: Date | null } | null";
+            case "people":
+              return "{ id: string; name: string | null; avatar_url: string | null; object: string; type: string; email?: string }[]";
+            case "files":
+              return "{ name: string; type: string; external?: { url: string }; file?: { url: string; expiry_time: string } }[]";
+            case "checkbox":
+              return "boolean";
+            case "url":
+              return "string";
+            case "email":
+              return "string";
+            case "phone_number":
+              return "string";
+            case "formula":
+              return "{ type: string; value: any }";
+            case "relation":
+              return "{ id: string }[]";
+            case "rollup":
+              return "{ type: string; function: string; array?: any[]; number?: number; date?: any }";
+            case "created_time":
+              return "{ timestamp: string; date: Date }";
+            case "created_by":
+            case "last_edited_by":
+              return "{ id: string; name: string | null; avatar_url: string | null; object: string; type: string; email?: string }";
+            case "last_edited_time":
+              return "{ timestamp: string; date: Date }";
+            case "status":
+              return "{ id: string; name: string; color: string } | null";
+            case "unique_id":
+              return "{ prefix: string | null; number: number }";
+            default:
+              return "any";
+          }
+        },
+        S = $,
+        E = `${S}Advanced`,
+        D = `${S}Raw`;
+      (r.addInterface({
+        name: E,
+        properties: [
+          { name: "id", type: "string" },
+          ...f.map(([l, c]) => ({ name: N(l), type: P(c.type) })),
+        ],
+        isExported: !0,
+      }),
+        r.addInterface({
+          name: D,
+          properties: [
+            { name: "id", type: "string" },
+            { name: "properties", type: "Record<string, any>" },
+          ],
+          isExported: !0,
+        }),
+        r.addInterface({
+          name: S,
+          extends: ["DatabaseRecord"],
+          properties: [
+            { name: "id", type: "string" },
+            ...f.map(([l, c]) => ({ name: N(l), type: I(c.type, c) })),
+            { name: "advanced", type: E },
+            { name: "raw", type: D },
+          ],
+          isExported: !0,
+        }));
+    } catch (g) {
+      console.error(`Error processing database ${d}:`, g);
+    }
+  (r.addStatements(`
 // ============================================================================
 // NotionCMS Extension Methods
 // ============================================================================
@@ -53,10 +454,15 @@ NotionCMS.prototype.databases["${b}"] = {
 // Extend DatabaseRegistry only; no instance helper methods are generated in combined mode
 /* eslint-disable */
 declare module "@mikemajara/notion-cms" {
-  interface NotionCMS {}`),r.addStatements(`
+  interface NotionCMS {}`),
+    r.addStatements(`
 // ============================================================================
 // Method Implementations
 // ============================================================================
 
 // No instance helper implementations are emitted in combined mode.
-`),await r.save(),console.log(`Generated combined types file: ${p}`);}export{Y as a,q as b};
\ No newline at end of file
+`),
+    await r.save(),
+    console.log(`Generated combined types file: ${p}`));
+}
+export { Y as a, q as b };
diff --git a/dist/chunk-VMXQFQ6I.js b/dist/chunk-VMXQFQ6I.js
index 90086720c60dbfee053eeea5af75e5fc5dd7ab70..54238304bdeb81d408c4666c592ed62caf0a9de5 100644
--- a/dist/chunk-VMXQFQ6I.js
+++ b/dist/chunk-VMXQFQ6I.js
@@ -1,21 +1,315 @@
-'use strict';var client=require('@notionhq/client'),y=require('fs'),h=require('path'),tsMorph=require('ts-morph');function _interopNamespace(e){if(e&&e.__esModule)return e;var n=Object.create(null);if(e){Object.keys(e).forEach(function(k){if(k!=='default'){var d=Object.getOwnPropertyDescriptor(e,k);Object.defineProperty(n,k,d.get?d:{enumerable:true,get:function(){return e[k]}});}})}n.default=e;return Object.freeze(n)}var y__namespace=/*#__PURE__*/_interopNamespace(y);var h__namespace=/*#__PURE__*/_interopNamespace(h);function N(t){return /[^a-zA-Z0-9_$]/.test(t)?`"${t}"`:t}var I=(t,e)=>{switch(t){case "title":case "rich_text":case "url":case "email":case "phone_number":return "string";case "number":return "number";case "select":return e&&"select"in e&&e.select&&"options"in e.select&&Array.isArray(e.select.options)&&e.select.options.length>0?e.select.options.map(s=>`"${s.name}"`).join(" | "):"string";case "multi_select":return e&&"multi_select"in e&&e.multi_select&&"options"in e.multi_select&&Array.isArray(e.multi_select.options)&&e.multi_select.options.length>0?`Array<${e.multi_select.options.map(i=>`"${i.name}"`).join(" | ")}>`:"string[]";case "date":return "Date";case "people":return "string[]";case "files":return "{ name: string; url: string; }[]";case "checkbox":return "boolean";case "formula":return "any";case "relation":return "string[]";case "rollup":return "any";case "created_time":case "last_edited_time":return "string";case "created_by":case "last_edited_by":return "{ id: string; name: string | null; avatar_url: string | null; }";default:return "any"}};function v(t){let e=t.replace(/[^\w\s]/g,"").replace(/\s+(.)/g,(s,i)=>i.toUpperCase()).replace(/\s/g,"");return "Record"+e.charAt(0).toUpperCase()+e.slice(1)}function k(t){return `notion-types-${t.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g,"-")}.ts`}function R(t,e){if(!t||typeof t!="object")throw console.error(`[generator] Invalid properties received for database ${e.databaseName} (${e.databaseId}).`,{properties:t}),new Error("Notion database response does not include a valid properties object.");let s=[];for(let[i,o]of Object.entries(t)){if(!o||typeof o!="object"||!("type"in o)||typeof o.type!="string"){console.warn(`[generator] Skipping property "${i}" for database ${e.databaseName} (${e.databaseId}) because it is missing a valid type.`,{property:o});continue}s.push([i,o]);}if(s.length===0)throw console.error(`[generator] No usable properties found for database ${e.databaseName} (${e.databaseId}).`,{properties:t}),new Error("Unable to generate types because no usable properties were found in the Notion schema response.");return s}async function Y(t,e,s){let o=await new client.Client({auth:s}).databases.retrieve({database_id:t}),p=o.properties,u="NotionDatabase",r=o;if(r.title&&Array.isArray(r.title)&&r.title.length>0){let n=r.title[0].plain_text;n&&(u=n);}if(u==="NotionDatabase"){u=t.replace(/-/g,"").substring(0,12);let n=Object.keys(p).find($=>p[$].type==="title");n&&(u=n);}let m=v(u),d=k(u);y__namespace.mkdirSync(e,{recursive:true});let g=h__namespace.join(e,d),a=new tsMorph.Project().createSourceFile(g,"",{overwrite:true});M(a,p,m,u,t),await a.save(),F(e,d);}function F(t,e){let s=h__namespace.join(t,"index.ts");y__namespace.existsSync(s)||y__namespace.writeFileSync(s,`// Auto-generated index file for Notion CMS types
+"use strict";
+var client = require("@notionhq/client"),
+  y = require("fs"),
+  h = require("path"),
+  tsMorph = require("ts-morph");
+function _interopNamespace(e) {
+  if (e && e.__esModule) return e;
+  var n = Object.create(null);
+  if (e) {
+    Object.keys(e).forEach(function (k) {
+      if (k !== "default") {
+        var d = Object.getOwnPropertyDescriptor(e, k);
+        Object.defineProperty(
+          n,
+          k,
+          d.get
+            ? d
+            : {
+                enumerable: true,
+                get: function () {
+                  return e[k];
+                },
+              },
+        );
+      }
+    });
+  }
+  n.default = e;
+  return Object.freeze(n);
+}
+var y__namespace = /*#__PURE__*/ _interopNamespace(y);
+var h__namespace = /*#__PURE__*/ _interopNamespace(h);
+function N(t) {
+  return /[^a-zA-Z0-9_$]/.test(t) ? `"${t}"` : t;
+}
+var I = (t, e) => {
+  switch (t) {
+    case "title":
+    case "rich_text":
+    case "url":
+    case "email":
+    case "phone_number":
+      return "string";
+    case "number":
+      return "number";
+    case "select":
+      return e &&
+        "select" in e &&
+        e.select &&
+        "options" in e.select &&
+        Array.isArray(e.select.options) &&
+        e.select.options.length > 0
+        ? e.select.options.map((s) => `"${s.name}"`).join(" | ")
+        : "string";
+    case "multi_select":
+      return e &&
+        "multi_select" in e &&
+        e.multi_select &&
+        "options" in e.multi_select &&
+        Array.isArray(e.multi_select.options) &&
+        e.multi_select.options.length > 0
+        ? `Array<${e.multi_select.options.map((i) => `"${i.name}"`).join(" | ")}>`
+        : "string[]";
+    case "date":
+      return "Date";
+    case "people":
+      return "string[]";
+    case "files":
+      return "{ name: string; url: string; }[]";
+    case "checkbox":
+      return "boolean";
+    case "formula":
+      return "any";
+    case "relation":
+      return "string[]";
+    case "rollup":
+      return "any";
+    case "created_time":
+    case "last_edited_time":
+      return "string";
+    case "created_by":
+    case "last_edited_by":
+      return "{ id: string; name: string | null; avatar_url: string | null; }";
+    default:
+      return "any";
+  }
+};
+function v(t) {
+  let e = t
+    .replace(/[^\w\s]/g, "")
+    .replace(/\s+(.)/g, (s, i) => i.toUpperCase())
+    .replace(/\s/g, "");
+  return "Record" + e.charAt(0).toUpperCase() + e.slice(1);
+}
+function k(t) {
+  return `notion-types-${t
+    .toLowerCase()
+    .replace(/[^\w\s]/g, "")
+    .replace(/\s+/g, "-")}.ts`;
+}
+function R(t, e) {
+  if (!t || typeof t != "object")
+    throw (
+      console.error(
+        `[generator] Invalid properties received for database ${e.databaseName} (${e.databaseId}).`,
+        { properties: t },
+      ),
+      new Error(
+        "Notion database response does not include a valid properties object.",
+      )
+    );
+  let s = [];
+  for (let [i, o] of Object.entries(t)) {
+    if (
+      !o ||
+      typeof o != "object" ||
+      !("type" in o) ||
+      typeof o.type != "string"
+    ) {
+      console.warn(
+        `[generator] Skipping property "${i}" for database ${e.databaseName} (${e.databaseId}) because it is missing a valid type.`,
+        { property: o },
+      );
+      continue;
+    }
+    s.push([i, o]);
+  }
+  if (s.length === 0)
+    throw (
+      console.error(
+        `[generator] No usable properties found for database ${e.databaseName} (${e.databaseId}).`,
+        { properties: t },
+      ),
+      new Error(
+        "Unable to generate types because no usable properties were found in the Notion schema response.",
+      )
+    );
+  return s;
+}
+async function Y(t, e, s) {
+  let o = await new client.Client({ auth: s  , fetch:fetch.bind(globalThis)}).databases.retrieve({
+      database_id: t,
+    }),
+    p = o.properties,
+    u = "NotionDatabase",
+    r = o;
+  if (r.title && Array.isArray(r.title) && r.title.length > 0) {
+    let n = r.title[0].plain_text;
+    n && (u = n);
+  }
+  if (u === "NotionDatabase") {
+    u = t.replace(/-/g, "").substring(0, 12);
+    let n = Object.keys(p).find(($) => p[$].type === "title");
+    n && (u = n);
+  }
+  let m = v(u),
+    d = k(u);
+  y__namespace.mkdirSync(e, { recursive: true });
+  let g = h__namespace.join(e, d),
+    a = new tsMorph.Project().createSourceFile(g, "", { overwrite: true });
+  (M(a, p, m, u, t), await a.save(), F(e, d));
+}
+function F(t, e) {
+  let s = h__namespace.join(t, "index.ts");
+  y__namespace.existsSync(s) ||
+    y__namespace.writeFileSync(
+      s,
+      `// Auto-generated index file for Notion CMS types
 
 // Export database-specific types
-`);let i=`// Auto-generated index file for Notion CMS types
+`,
+    );
+  let i = `// Auto-generated index file for Notion CMS types
 
 // Export database-specific types
-`,o=`import './${e.replace(".ts","")}';
-`;o+=`export * from './${e.replace(".ts","")}';`,i.includes(o)||(i+=`${o}
-`,y__namespace.writeFileSync(s,i));}function M(t,e,s,i,o){try{let p=R(e,{databaseId:o,databaseName:i});t.addStatements(`/**
+`,
+    o = `import './${e.replace(".ts", "")}';
+`;
+  ((o += `export * from './${e.replace(".ts", "")}';`),
+    i.includes(o) ||
+      ((i += `${o}
+`),
+      y__namespace.writeFileSync(s, i)));
+}
+function M(t, e, s, i, o) {
+  try {
+    let p = R(e, { databaseId: o, databaseName: i });
+    (t.addStatements(`/**
  * THIS FILE IS AUTO-GENERATED BY NOTION-CMS
  * DO NOT EDIT DIRECTLY - YOUR CHANGES WILL BE OVERWRITTEN
  * v0.1.3
  * Generated for database: ${i}
- */`),t.addImportDeclaration({moduleSpecifier:"@mikemajara/notion-cms",namedImports:["DatabaseRecord","NotionCMS","DatabaseFieldMetadata"]}),t.addImportDeclaration({moduleSpecifier:"@notionhq/client/build/src/api-endpoints",namedImports:["PageObjectResponse"]}),t.addExportDeclaration({moduleSpecifier:"@mikemajara/notion-cms",namedExports:["NotionCMS"]});let u=a=>{switch(a){case "title":return "{ content: string; annotations: any; href: string | null; link?: { url: string } | null }[]";case "rich_text":return "{ content: string; annotations: any; href: string | null; link?: { url: string } | null }[]";case "number":return "number";case "select":return "{ id: string; name: string; color: string } | null";case "multi_select":return "{ id: string; name: string; color: string }[]";case "date":return "{ start: string; end: string | null; time_zone: string | null; parsedStart: Date | null; parsedEnd: Date | null } | null";case "people":return "{ id: string; name: string | null; avatar_url: string | null; object: string; type: string; email?: string }[]";case "files":return "{ name: string; type: string; external?: { url: string }; file?: { url: string; expiry_time: string } }[]";case "checkbox":return "boolean";case "url":return "string";case "email":return "string";case "phone_number":return "string";case "formula":return "{ type: string; value: any }";case "relation":return "{ id: string }[]";case "rollup":return "{ type: string; function: string; array?: any[]; number?: number; date?: any }";case "created_time":return "{ timestamp: string; date: Date }";case "created_by":case "last_edited_by":return "{ id: string; name: string | null; avatar_url: string | null; object: string; type: string; email?: string }";case "last_edited_time":return "{ timestamp: string; date: Date }";case "status":return "{ id: string; name: string; color: string } | null";case "unique_id":return "{ prefix: string | null; number: number }";default:return "any"}},r=[];r.push(`export const ${s}FieldTypes = {`),r.push('  "id": { type: "unique_id" },');for(let[a,n]of p)if(n.type==="select"||n.type==="multi_select"){let f=((n.type==="select"?n.select?.options:n.multi_select?.options)??[]).map(_=>`"${_.name}"`).join(", ");f.length===0&&console.warn(`[generator] Property "${a}" in database ${i} (${o}) declares type ${n.type} but contains no options. Falling back to empty options array.`,{property:n}),r.push(`  "${a}": { 
+ */`),
+      t.addImportDeclaration({
+        moduleSpecifier: "@mikemajara/notion-cms",
+        namedImports: ["DatabaseRecord", "NotionCMS", "DatabaseFieldMetadata"],
+      }),
+      t.addImportDeclaration({
+        moduleSpecifier: "@notionhq/client/build/src/api-endpoints",
+        namedImports: ["PageObjectResponse"],
+      }),
+      t.addExportDeclaration({
+        moduleSpecifier: "@mikemajara/notion-cms",
+        namedExports: ["NotionCMS"],
+      }));
+    let u = (a) => {
+        switch (a) {
+          case "title":
+            return "{ content: string; annotations: any; href: string | null; link?: { url: string } | null }[]";
+          case "rich_text":
+            return "{ content: string; annotations: any; href: string | null; link?: { url: string } | null }[]";
+          case "number":
+            return "number";
+          case "select":
+            return "{ id: string; name: string; color: string } | null";
+          case "multi_select":
+            return "{ id: string; name: string; color: string }[]";
+          case "date":
+            return "{ start: string; end: string | null; time_zone: string | null; parsedStart: Date | null; parsedEnd: Date | null } | null";
+          case "people":
+            return "{ id: string; name: string | null; avatar_url: string | null; object: string; type: string; email?: string }[]";
+          case "files":
+            return "{ name: string; type: string; external?: { url: string }; file?: { url: string; expiry_time: string } }[]";
+          case "checkbox":
+            return "boolean";
+          case "url":
+            return "string";
+          case "email":
+            return "string";
+          case "phone_number":
+            return "string";
+          case "formula":
+            return "{ type: string; value: any }";
+          case "relation":
+            return "{ id: string }[]";
+          case "rollup":
+            return "{ type: string; function: string; array?: any[]; number?: number; date?: any }";
+          case "created_time":
+            return "{ timestamp: string; date: Date }";
+          case "created_by":
+          case "last_edited_by":
+            return "{ id: string; name: string | null; avatar_url: string | null; object: string; type: string; email?: string }";
+          case "last_edited_time":
+            return "{ timestamp: string; date: Date }";
+          case "status":
+            return "{ id: string; name: string; color: string } | null";
+          case "unique_id":
+            return "{ prefix: string | null; number: number }";
+          default:
+            return "any";
+        }
+      },
+      r = [];
+    (r.push(`export const ${s}FieldTypes = {`),
+      r.push('  "id": { type: "unique_id" },'));
+    for (let [a, n] of p)
+      if (n.type === "select" || n.type === "multi_select") {
+        let f = (
+          (n.type === "select" ? n.select?.options : n.multi_select?.options) ??
+          []
+        )
+          .map((_) => `"${_.name}"`)
+          .join(", ");
+        (f.length === 0 &&
+          console.warn(
+            `[generator] Property "${a}" in database ${i} (${o}) declares type ${n.type} but contains no options. Falling back to empty options array.`,
+            { property: n },
+          ),
+          r.push(`  "${a}": { 
     type: "${n.type}",
     options: [${f}] as const
-  },`);}else r.push(`  "${a}": { type: "${n.type}" },`);r.push("} as const satisfies DatabaseFieldMetadata;"),t.addStatements(r.join(`
-`));let m=s,d=`${m}Advanced`,g=`${m}Raw`;t.addInterface({name:d,properties:[{name:"id",type:"string"},...p.map(([a,n])=>({name:N(a),type:u(n.type)}))],isExported:!0}),t.addInterface({name:g,properties:[{name:"id",type:"string"},{name:"properties",type:"Record<string, any>"}],isExported:!0}),t.addInterface({name:m,extends:["DatabaseRecord"],properties:[{name:"id",type:"string"},...p.map(([a,n])=>({name:N(a),type:I(n.type,n)}))],isExported:!0});let b=i.replace(/[^\w\s]/g,"").replace(/\s+(.)/g,(a,n)=>n.toUpperCase()).replace(/\s/g,"").replace(/^./,a=>a.toLowerCase());t.addStatements(`
+  },`));
+      } else r.push(`  "${a}": { type: "${n.type}" },`);
+    (r.push("} as const satisfies DatabaseFieldMetadata;"),
+      t.addStatements(
+        r.join(`
+`),
+      ));
+    let m = s,
+      d = `${m}Advanced`,
+      g = `${m}Raw`;
+    (t.addInterface({
+      name: d,
+      properties: [
+        { name: "id", type: "string" },
+        ...p.map(([a, n]) => ({ name: N(a), type: u(n.type) })),
+      ],
+      isExported: !0,
+    }),
+      t.addInterface({
+        name: g,
+        properties: [
+          { name: "id", type: "string" },
+          { name: "properties", type: "Record<string, any>" },
+        ],
+        isExported: !0,
+      }),
+      t.addInterface({
+        name: m,
+        extends: ["DatabaseRecord"],
+        properties: [
+          { name: "id", type: "string" },
+          ...p.map(([a, n]) => ({ name: N(a), type: I(n.type, n) })),
+        ],
+        isExported: !0,
+      }));
+    let b = i
+      .replace(/[^\w\s]/g, "")
+      .replace(/\s+(.)/g, (a, n) => n.toUpperCase())
+      .replace(/\s/g, "")
+      .replace(/^./, (a) => a.toLowerCase());
+    t.addStatements(`
 // Extend DatabaseRegistry interface with this database
 declare module "@mikemajara/notion-cms" {
   interface DatabaseRegistry {
@@ -33,19 +327,156 @@ NotionCMS.prototype.databases["${b}"] = {
   id: process.env.NOTION_CMS_${b.toUpperCase()}_DATABASE_ID || "${o}",
   fields: ${s}FieldTypes,
 };
-`);}catch(p){console.error("Error generating database-specific types:",p);}}async function q(t,e,s){let i=new client.Client({auth:s}),p=h__namespace.join(e,"notion-types-combined.ts"),r=new tsMorph.Project().createSourceFile(p,"",{overwrite:true});r.addStatements(`/**
+`);
+  } catch (p) {
+    console.error("Error generating database-specific types:", p);
+  }
+}
+async function q(t, e, s) {
+  let i = new client.Client({ auth: s , fetch:fetch.bind(globalThis) }),
+    p = h__namespace.join(e, "notion-types-combined.ts"),
+    r = new tsMorph.Project().createSourceFile(p, "", { overwrite: true });
+  (r.addStatements(`/**
  * THIS FILE IS AUTO-GENERATED BY NOTION-CMS
  * DO NOT EDIT DIRECTLY - YOUR CHANGES WILL BE OVERWRITTEN
  * 
  * Generated for multiple databases: ${t.join(", ")}
- */`),r.addImportDeclaration({moduleSpecifier:"@mikemajara/notion-cms",namedImports:["DatabaseRecord","NotionCMS","DatabaseFieldMetadata"]});let m=[];for(let d of t)try{console.log(`Processing database: ${d}`);let g=await i.databases.retrieve({database_id:d}),b=g.properties,a=`Database${d.substring(0,8)}`,n=g;if(n.title&&Array.isArray(n.title)&&n.title.length>0){let l=n.title[0].plain_text;l&&(a=l);}let $=v(a),f=R(b,{databaseId:d,databaseName:a}),_=`query${a.replace(/[^\w\s]/g,"").replace(/\s+(.)/g,(l,c)=>c.toUpperCase()).replace(/\s/g,"").replace(/^./,l=>l.toUpperCase())}`,T=1,A=_;for(;m.includes(_);)_=`${A}${T}`,T++;m.push(_),r.addStatements(`
+ */`),
+    r.addImportDeclaration({
+      moduleSpecifier: "@mikemajara/notion-cms",
+      namedImports: ["DatabaseRecord", "NotionCMS", "DatabaseFieldMetadata"],
+    }));
+  let m = [];
+  for (let d of t)
+    try {
+      console.log(`Processing database: ${d}`);
+      let g = await i.databases.retrieve({ database_id: d }),
+        b = g.properties,
+        a = `Database${d.substring(0, 8)}`,
+        n = g;
+      if (n.title && Array.isArray(n.title) && n.title.length > 0) {
+        let l = n.title[0].plain_text;
+        l && (a = l);
+      }
+      let $ = v(a),
+        f = R(b, { databaseId: d, databaseName: a }),
+        _ = `query${a
+          .replace(/[^\w\s]/g, "")
+          .replace(/\s+(.)/g, (l, c) => c.toUpperCase())
+          .replace(/\s/g, "")
+          .replace(/^./, (l) => l.toUpperCase())}`,
+        T = 1,
+        A = _;
+      for (; m.includes(_); ) ((_ = `${A}${T}`), T++);
+      (m.push(_),
+        r.addStatements(`
 // ============================================================================
 // ${a} Database Types
 // ============================================================================
-`),r.addStatements(`export const ${$}FieldTypes = {`),r.addStatements('  "id": { type: "string" },');for(let[l,c]of f)if(c.type==="select"||c.type==="multi_select"){let x=((c.type==="select"?c.select?.options:c.multi_select?.options)??[]).map(O=>`"${O.name}"`).join(", ");x.length===0&&console.warn(`[generator] Property "${l}" in database ${a} (${d}) declares type ${c.type} but contains no options. Falling back to empty options array.`,{property:c}),r.addStatements(`  "${l}": { 
+`),
+        r.addStatements(`export const ${$}FieldTypes = {`),
+        r.addStatements('  "id": { type: "string" },'));
+      for (let [l, c] of f)
+        if (c.type === "select" || c.type === "multi_select") {
+          let x = (
+            (c.type === "select"
+              ? c.select?.options
+              : c.multi_select?.options) ?? []
+          )
+            .map((O) => `"${O.name}"`)
+            .join(", ");
+          (x.length === 0 &&
+            console.warn(
+              `[generator] Property "${l}" in database ${a} (${d}) declares type ${c.type} but contains no options. Falling back to empty options array.`,
+              { property: c },
+            ),
+            r.addStatements(`  "${l}": { 
     type: "${c.type}",
     options: [${x}] as const
-  },`);}else r.addStatements(`  "${l}": { type: "${c.type}" },`);r.addStatements("} as const satisfies DatabaseFieldMetadata;");let P=l=>{switch(l){case "title":return "{ content: string; annotations: any; href: string | null; link?: { url: string } | null }[]";case "rich_text":return "{ content: string; annotations: any; href: string | null; link?: { url: string } | null }[]";case "number":return "number";case "select":return "{ id: string; name: string; color: string } | null";case "multi_select":return "{ id: string; name: string; color: string }[]";case "date":return "{ start: string; end: string | null; time_zone: string | null; parsedStart: Date | null; parsedEnd: Date | null } | null";case "people":return "{ id: string; name: string | null; avatar_url: string | null; object: string; type: string; email?: string }[]";case "files":return "{ name: string; type: string; external?: { url: string }; file?: { url: string; expiry_time: string } }[]";case "checkbox":return "boolean";case "url":return "string";case "email":return "string";case "phone_number":return "string";case "formula":return "{ type: string; value: any }";case "relation":return "{ id: string }[]";case "rollup":return "{ type: string; function: string; array?: any[]; number?: number; date?: any }";case "created_time":return "{ timestamp: string; date: Date }";case "created_by":case "last_edited_by":return "{ id: string; name: string | null; avatar_url: string | null; object: string; type: string; email?: string }";case "last_edited_time":return "{ timestamp: string; date: Date }";case "status":return "{ id: string; name: string; color: string } | null";case "unique_id":return "{ prefix: string | null; number: number }";default:return "any"}},S=$,E=`${S}Advanced`,D=`${S}Raw`;r.addInterface({name:E,properties:[{name:"id",type:"string"},...f.map(([l,c])=>({name:N(l),type:P(c.type)}))],isExported:!0}),r.addInterface({name:D,properties:[{name:"id",type:"string"},{name:"properties",type:"Record<string, any>"}],isExported:!0}),r.addInterface({name:S,extends:["DatabaseRecord"],properties:[{name:"id",type:"string"},...f.map(([l,c])=>({name:N(l),type:I(c.type,c)})),{name:"advanced",type:E},{name:"raw",type:D}],isExported:!0});}catch(g){console.error(`Error processing database ${d}:`,g);}r.addStatements(`
+  },`));
+        } else r.addStatements(`  "${l}": { type: "${c.type}" },`);
+      r.addStatements("} as const satisfies DatabaseFieldMetadata;");
+      let P = (l) => {
+          switch (l) {
+            case "title":
+              return "{ content: string; annotations: any; href: string | null; link?: { url: string } | null }[]";
+            case "rich_text":
+              return "{ content: string; annotations: any; href: string | null; link?: { url: string } | null }[]";
+            case "number":
+              return "number";
+            case "select":
+              return "{ id: string; name: string; color: string } | null";
+            case "multi_select":
+              return "{ id: string; name: string; color: string }[]";
+            case "date":
+              return "{ start: string; end: string | null; time_zone: string | null; parsedStart: Date | null; parsedEnd: Date | null } | null";
+            case "people":
+              return "{ id: string; name: string | null; avatar_url: string | null; object: string; type: string; email?: string }[]";
+            case "files":
+              return "{ name: string; type: string; external?: { url: string }; file?: { url: string; expiry_time: string } }[]";
+            case "checkbox":
+              return "boolean";
+            case "url":
+              return "string";
+            case "email":
+              return "string";
+            case "phone_number":
+              return "string";
+            case "formula":
+              return "{ type: string; value: any }";
+            case "relation":
+              return "{ id: string }[]";
+            case "rollup":
+              return "{ type: string; function: string; array?: any[]; number?: number; date?: any }";
+            case "created_time":
+              return "{ timestamp: string; date: Date }";
+            case "created_by":
+            case "last_edited_by":
+              return "{ id: string; name: string | null; avatar_url: string | null; object: string; type: string; email?: string }";
+            case "last_edited_time":
+              return "{ timestamp: string; date: Date }";
+            case "status":
+              return "{ id: string; name: string; color: string } | null";
+            case "unique_id":
+              return "{ prefix: string | null; number: number }";
+            default:
+              return "any";
+          }
+        },
+        S = $,
+        E = `${S}Advanced`,
+        D = `${S}Raw`;
+      (r.addInterface({
+        name: E,
+        properties: [
+          { name: "id", type: "string" },
+          ...f.map(([l, c]) => ({ name: N(l), type: P(c.type) })),
+        ],
+        isExported: !0,
+      }),
+        r.addInterface({
+          name: D,
+          properties: [
+            { name: "id", type: "string" },
+            { name: "properties", type: "Record<string, any>" },
+          ],
+          isExported: !0,
+        }),
+        r.addInterface({
+          name: S,
+          extends: ["DatabaseRecord"],
+          properties: [
+            { name: "id", type: "string" },
+            ...f.map(([l, c]) => ({ name: N(l), type: I(c.type, c) })),
+            { name: "advanced", type: E },
+            { name: "raw", type: D },
+          ],
+          isExported: !0,
+        }));
+    } catch (g) {
+      console.error(`Error processing database ${d}:`, g);
+    }
+  (r.addStatements(`
 // ============================================================================
 // NotionCMS Extension Methods
 // ============================================================================
@@ -53,10 +484,16 @@ NotionCMS.prototype.databases["${b}"] = {
 // Extend DatabaseRegistry only; no instance helper methods are generated in combined mode
 /* eslint-disable */
 declare module "@mikemajara/notion-cms" {
-  interface NotionCMS {}`),r.addStatements(`
+  interface NotionCMS {}`),
+    r.addStatements(`
 // ============================================================================
 // Method Implementations
 // ============================================================================
 
 // No instance helper implementations are emitted in combined mode.
-`),await r.save(),console.log(`Generated combined types file: ${p}`);}exports.a=Y;exports.b=q;
\ No newline at end of file
+`),
+    await r.save(),
+    console.log(`Generated combined types file: ${p}`));
+}
+exports.a = Y;
+exports.b = q;
diff --git a/dist/file-utils-42FAMQFG.js b/dist/file-utils-42FAMQFG.js
index 19598ac3ad48e55bc9d0cad88052818e5d754763..447b905d0b181c8ff7acdc93b3830a5151f2f7d6 100644
--- a/dist/file-utils-42FAMQFG.js
+++ b/dist/file-utils-42FAMQFG.js
@@ -1 +1,75 @@
-'use strict';async function l(t){let r=await fetch(t);if(!r.ok)throw new Error(`Failed to download file: ${r.statusText}`);let i=await r.arrayBuffer();return Buffer.from(i)}async function m(t){try{return await(await import('fs/promises')).access(t),!0}catch{return  false}}async function f(t){let r=await import('fs/promises');try{await r.mkdir(t,{recursive:!0});}catch(i){if(i.code!=="EEXIST")throw i}}async function p(t,r){let i=await import('fs/promises'),a=(await import('path')).dirname(t);await f(a),await i.writeFile(t,r);}async function y(t){try{return (await(await import('fs/promises')).stat(t)).size}catch{return 0}}async function u(t){try{let r=await import('fs/promises'),i=await import('path'),e=0,a=await r.readdir(t,{withFileTypes:!0});for(let s of a){let n=i.join(t,s.name);if(s.isFile()){let o=await r.stat(n);e+=o.size;}else s.isDirectory()&&(e+=await u(n));}return e}catch{return 0}}async function d(t,r){try{let i=await import('fs/promises'),e=await import('path'),a=Date.now(),s=await i.readdir(t,{withFileTypes:!0});for(let n of s)if(n.isFile()){let o=e.join(t,n.name),c=await i.stat(o);a-c.mtime.getTime()>r&&await i.unlink(o);}}catch(i){console.warn(`Failed to cleanup old files in ${t}:`,i);}}exports.calculateDirSize=u;exports.cleanupOldFiles=d;exports.downloadFile=l;exports.ensureDir=f;exports.fileExists=m;exports.getFileSize=y;exports.writeFile=p;
\ No newline at end of file
+"use strict";
+async function l(t) {
+  let r = await fetch(t);
+  if (!r.ok) throw new Error(`Failed to download file: ${r.statusText}`);
+  let i = await r.arrayBuffer();
+  return Buffer.from(i);
+}
+async function m(t) {
+  try {
+    return (await (await import("fs/promises")).access(t), !0);
+  } catch {
+    return false;
+  }
+}
+async function f(t) {
+  let r = await import("fs/promises");
+  try {
+    await r.mkdir(t, { recursive: !0 });
+  } catch (i) {
+    if (i.code !== "EEXIST") throw i;
+  }
+}
+async function p(t, r) {
+  let i = await import("fs/promises"),
+    a = (await import("path")).dirname(t);
+  (await f(a), await i.writeFile(t, r));
+}
+async function y(t) {
+  try {
+    return (await (await import("fs/promises")).stat(t)).size;
+  } catch {
+    return 0;
+  }
+}
+async function u(t) {
+  try {
+    let r = await import("fs/promises"),
+      i = await import("path"),
+      e = 0,
+      a = await r.readdir(t, { withFileTypes: !0 });
+    for (let s of a) {
+      let n = i.join(t, s.name);
+      if (s.isFile()) {
+        let o = await r.stat(n);
+        e += o.size;
+      } else s.isDirectory() && (e += await u(n));
+    }
+    return e;
+  } catch {
+    return 0;
+  }
+}
+async function d(t, r) {
+  try {
+    let i = await import("fs/promises"),
+      e = await import("path"),
+      a = Date.now(),
+      s = await i.readdir(t, { withFileTypes: !0 });
+    for (let n of s)
+      if (n.isFile()) {
+        let o = e.join(t, n.name),
+          c = await i.stat(o);
+        a - c.mtime.getTime() > r && (await i.unlink(o));
+      }
+  } catch (i) {
+    console.warn(`Failed to cleanup old files in ${t}:`, i);
+  }
+}
+exports.calculateDirSize = u;
+exports.cleanupOldFiles = d;
+exports.downloadFile = l;
+exports.ensureDir = f;
+exports.fileExists = m;
+exports.getFileSize = y;
+exports.writeFile = p;
diff --git a/dist/index.js b/dist/index.js
index a105163148772d7c17eadbe6ed94b63b0ae09a3d..dc89ba633321eb46573126ad72be16e207c7c839 100644
--- a/dist/index.js
+++ b/dist/index.js
@@ -1,18 +1,1847 @@
-'use strict';var client=require('@notionhq/client');var re="./public/assets/notion-files",f={files:{strategy:"direct",storage:{path:re,endpoint:"",bucket:"",accessKey:"",secretKey:"",region:""}},debug:{enabled:false,level:"info"}};function E(n){return n?{files:{strategy:n.files?.strategy??f.files.strategy,storage:{path:n.files?.storage?.path??f.files.storage.path,endpoint:n.files?.storage?.endpoint??f.files.storage.endpoint,bucket:n.files?.storage?.bucket??f.files.storage.bucket,accessKey:n.files?.storage?.accessKey??f.files.storage.accessKey,secretKey:n.files?.storage?.secretKey??f.files.storage.secretKey,region:n.files?.storage?.region??f.files.storage.region}},debug:{enabled:n.debug?.enabled??f.debug.enabled,level:n.debug?.level??f.debug.level}}:f}var S=class{async processFileUrl(t,e){return t}},v=class{constructor(t){this.config=t;}async processFileUrl(t,e){try{let r=N(t),s=Q(e),o=`${r}${s}`,a=await this.createStorage();if(await a.exists(o))return a.getPublicUrl(o);let{downloadFile:i}=await import('./file-utils-42FAMQFG.js'),c=await i(t);return await a.store(o,c),a.getPublicUrl(o)}catch(r){return console.warn(`Failed to cache file locally: ${e} from ${t}`,{fileName:e,url:t,error:r instanceof Error?r.message:String(r)}),t}}async createStorage(){let{LocalStorage:t}=await import('./s3-storage-47VTK7YA.js'),e=this.config?.storage?.path||"./public/assets/notion-files";return new t(e)}},T=class{constructor(t){this.config=t;}async processFileUrl(t,e){if(!this.config?.storage)return t;try{let r=N(t),s=Q(e),o=this.config.storage.path||"",a=o?`${o}${r}${s}`:`${r}${s}`,i=await this.createStorage();if(await i.exists(a))return i.getPublicUrl(a);let{downloadFile:c}=await import('./file-utils-42FAMQFG.js'),d=await c(t);return await i.store(a,d),i.getPublicUrl(a)}catch(r){return console.warn(`Failed to store file remotely: ${e} from ${t}`,{fileName:e,url:t,error:r instanceof Error?r.message:String(r)}),t}}async createStorage(){if(!this.config?.storage)throw new Error("S3 storage configuration is required for remote strategy");let{S3Storage:t}=await import('./s3-storage-47VTK7YA.js');return new t({endpoint:this.config.storage.endpoint,bucket:this.config.storage.bucket||"default-bucket",accessKey:this.config.storage.accessKey,secretKey:this.config.storage.secretKey,region:this.config.storage.region})}},k=class{constructor(t){let e=t.files;switch(e?.strategy){case "local":this.strategy=new v(e);break;case "remote":this.strategy=new T(e);break;case "direct":default:this.strategy=new S;break}}isCacheEnabled(){return this.strategy instanceof v||this.strategy instanceof T}async processFileUrl(t,e){return this.strategy.processFileUrl(t,e)}async processFileInfoArray(t){return Promise.all(t.map(async e=>{let r=await this.processFileUrl(e.url,e.name);return {...e,url:r}}))}extractFileUrl(t){return t.type==="external"?t.external.url:t.type==="file"?t.file.url:""}createFileInfo(t){return {name:t.name,url:this.extractFileUrl(t),type:t.type,...t.type==="file"&&{expiry_time:t.file.expiry_time}}}};function N(n){let t=n.match(/([a-f0-9-]{36})/g);if(t&&t.length>=2)return t[1].replace(/-/g,"");if(t&&t.length===1)return t[0].replace(/-/g,"");let e=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);e=(e<<5)-e+s,e=e&e;}return Math.abs(e).toString(16)}function Q(n){let t=n.match(/\.([a-zA-Z0-9]+)(?:\?|$)/);return t?`.${t[1]}`:""}function ne(n,t){let e=n;return t.code&&(e=`\`${e}\``),t.bold&&(e=`**${e}**`),t.italic&&(e=`*${e}*`),t.strikethrough&&(e=`~~${e}~~`),e}function m(n=[]){return Array.isArray(n)?n.map(t=>t.plain_text||"").join(""):""}function l(n=[]){return Array.isArray(n)?n.map(t=>{let e=t.plain_text||"",r=ne(e,t.annotations),s=t.href;return s?`[${r}](${s})`:r}).join(""):""}function C(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function p(n=[],t=""){if(!Array.isArray(n))return "";let e=t||"";return n.map(r=>{let s=C(r.plain_text||""),{bold:o,italic:a,strikethrough:i,code:c,color:d}=r.annotations;c&&(s=`<code>${s}</code>`),o&&(s=`<strong>${s}</strong>`),a&&(s=`<em>${s}</em>`),i&&(s=`<s>${s}</s>`);let y=[];if(d&&d!=="default")if(d.endsWith("_background")){let P=d.replace("_background","");y.push(`${e}bg-${P}`);}else y.push(`${e}color-${d}`);y.length&&(s=`<span class="${y.join(" ")}">${s}</span>`);let _=r.href;return _?`<a href="${C(_)}">${s}</a>`:s}).join("")}function V(n){return n.type}function se(n){return n[V(n)]}async function ae(n,t,e){if(e.mediaUrlResolver){let r=await e.mediaUrlResolver(n,t);if(r)return r}return t?t?.type==="external"?t?.external?.url??"":t?.file?.url??"":""}async function oe(n,t){let e=V(n),r=se(n),s=n.children||[],o=await A(s,t);switch(e){case "paragraph":case "quote":{let a=m(r?.rich_text??[]),i=l(r?.rich_text??[]);return {id:n.id,type:e,text:a,text_md:i,children:o.length?o:void 0}}case "heading_1":case "heading_2":case "heading_3":{let a=m(r?.rich_text??[]),i=l(r?.rich_text??[]);return {id:n.id,type:e,text:a,text_md:i}}case "bulleted_list_item":case "numbered_list_item":case "toggle":{let a=m(r?.rich_text??[]),i=l(r?.rich_text??[]);return {id:n.id,type:e,text:a,text_md:i,children:o.length?o:void 0}}case "to_do":{let a=m(r?.rich_text??[]),i=l(r?.rich_text??[]),c=!!r?.checked;return {id:n.id,type:e,checked:c,text:a,text_md:i,children:o.length?o:void 0}}case "code":{let a=r?.language||"",i=m(r?.rich_text??[]),c=l(r?.rich_text??[]);return {id:n.id,type:e,language:a,text:i,text_md:c}}case "bookmark":case "embed":case "link_preview":{let a=r?.url||"",i=m(r?.caption??[])||void 0,c=l(r?.caption??[])||void 0;return {id:n.id,type:e,url:a,caption_text:i,caption_md:c}}case "image":case "video":case "audio":case "file":case "pdf":{let a=await ae(n,r,t),i=m(r?.caption??[])||void 0,c=l(r?.caption??[])||void 0,d=r?.file?.expiry_time||void 0;return {id:n.id,type:e,url:a,caption_text:i,caption_md:c,expiry_time:d}}case "equation":{let a=r?.expression||"";return {id:n.id,type:e,expression:a}}case "divider":return {id:n.id,type:e};case "table":{let a=!!r?.has_column_header,i=!!r?.has_row_header,d=(await A(s,t)).filter(y=>y.type==="table_row");return {id:n.id,type:e,hasColumnHeader:a,hasRowHeader:i,rows:d}}case "table_row":{let a=r?.cells?.map(i=>{let c=Array.isArray(i)?i:[];return {text:m(c),text_md:l(c)}})??[];return {id:n.id,type:e,cells:a}}case "columns":{let i=(o.length?o:[]).filter(c=>c.type==="column").map(c=>({type:"column",children:c.children||[]}));return {id:n.id,type:"columns",children:i}}case "column":return {id:n.id,type:e,children:o.length?o:[]};case "synced_block":{let a=r?.synced_from?.block_id||void 0;return {id:n.id,type:e,originalBlockId:a,children:o.length?o:void 0}}case "child_page":{let a=r?.title||void 0;return {id:n.id,type:e,title:a,pageId:n.id}}case "child_database":{let a=r?.title||void 0;return {id:n.id,type:e,title:a,databaseId:n.id}}case "breadcrumb":case "table_of_contents":case "template":return {id:n.id,type:e,children:o.length?o:void 0};default:return null}}async function A(n,t){let e=[];for(let r of n){let s=await oe(r,t);s&&e.push(s);}return e}async function H(n=[],t={}){let e={mediaUrlResolver:t.mediaUrlResolver};return A(n,e)}async function z(n,t={}){let e=ce(n),r=n.children||[],s=r.length?await O(r,t):void 0;return {id:n.id,type:n.type,content:e,hasChildren:!!n.has_children,...s&&s.length?{children:s}:{}}}async function O(n=[],t={}){return Promise.all(n.map(e=>z(e,t)))}async function ie(n=[],t={}){let e=t.mediaUrlResolver||(async(r,s)=>{if(!s)return "";let o=s?.type==="external"?s?.external?.url:s?.file?.url;if(!t.fileManager||!o)return o||"";try{return await t.fileManager.processFileUrl(o,`content-block-${r.id}`)}catch{return o||""}});return H(n,{mediaUrlResolver:e})}function ce(n){let t=n.type,e=n[t];switch(t){case "paragraph":case "heading_1":case "heading_2":case "heading_3":case "bulleted_list_item":case "numbered_list_item":case "toggle":case "quote":return {text:g(e?.rich_text),richText:e?.rich_text};case "code":return {text:g(e?.rich_text),language:e?.language};case "image":case "file":case "pdf":case "video":case "audio":{let r=le(e);return {caption:e?.caption?g(e.caption):"",url:r}}case "bookmark":case "embed":case "link_preview":return {url:e?.url||"",caption:e?.caption?g(e.caption):""};case "divider":case "equation":case "table_of_contents":return e||{};case "to_do":return {text:g(e?.rich_text),checked:!!e?.checked};case "callout":return {text:g(e?.rich_text),icon:e?.icon};case "table":return {tableWidth:e?.table_width,hasColumnHeader:e?.has_column_header,hasRowHeader:e?.has_row_header};case "table_row":return {cells:(e?.cells||[]).map(r=>({plainText:g(r),richText:r}))};default:return e||{}}}function le(n){return n&&(n?.type==="external"?n?.external?.url:n?.file?.url)||""}function g(n=[]){return Array.isArray(n)?n.map(t=>t?.plain_text||"").join(""):""}var M=class{constructor(t,e){this.client=t;this.fileManager=e;}async getPageContent(t,e=true){let r=await this.getBlocks(t);if(e)for(let s of r)s.has_children&&(s.children=await this.getPageContent(s.id,true));return r}async getBlocks(t){let e=[],r=true,s;for(;r;){let o=await this.client.blocks.children.list({block_id:t,start_cursor:s}),i=o.results;await Promise.all(i.map(c=>this.enrichBlockFiles(c))),e=[...e,...i],r=o.has_more,s=o.next_cursor||void 0;}return e}async convertBlocksToSimple(t){return O(t,{fileManager:this.fileManager})}async enrichBlockFiles(t){let e=t.type,r=t[e];if(!r)return;let s=async(a,i)=>{if(!a)return a;try{return await this.fileManager.processFileUrl(a,i||`${t.id}-${e}`)}catch{return a}},o=async(a,i)=>{a&&(a.type==="external"&&a.external?.url&&(a.external.url=await s(a.external.url,i)||a.external.url),a.type==="file"&&a.file?.url&&(a.file.url=await s(a.file.url,i)||a.file.url));};switch(e){case "image":case "video":case "audio":case "file":case "pdf":{await o(r,r?.name);break}case "embed":case "bookmark":case "link_preview":{r.url&&(r.url=await s(r.url,r?.url)||r.url);break}case "callout":{r.icon&&r.icon.type==="file"&&await o(r.icon,`${t.id}-icon`);break}}}};var D=class{constructor(){this.config={enabled:false,level:"info"};}configure(t){this.config={...this.config,...t};}normalizeLevel(t){return t&&["error","warn","info","debug"].includes(t)?t:"info"}shouldLog(t){if(!this.config.enabled)return  false;let e=["error","warn","info","debug"],r=e.indexOf(this.normalizeLevel(this.config.level));return e.indexOf(t)<=r}log(...t){this.shouldLog("info")&&console.log("[NotionCMS Debug]:",...t);}query(t,e){this.shouldLog("debug")&&console.log(`
-[NotionCMS Query]:`,{databaseId:t,filter:e.filter,sorts:e.sorts,pageSize:e.page_size,startCursor:e.start_cursor,timestamp:new Date().toISOString()});}error(t,e){this.shouldLog("error")&&console.error("[NotionCMS Error]:",{message:t.message,code:t.code,context:e,timestamp:new Date().toISOString()});}},u=new D;async function G(n,t){switch(n.type){case "unique_id":return n.unique_id.number;case "title":return n.title?.[0]?.plain_text??"";case "rich_text":return n.rich_text?.[0]?.plain_text??"";case "number":return n.number;case "select":return n.select?.name??null;case "multi_select":return n.multi_select.map(e=>e.name);case "date":{let e=n;return e.date?new Date(e.date.start):null}case "people":{let e=n;return Array.isArray(e.people)?e.people.map(r=>r.name||""):[]}case "files":{let r=n.files.map(s=>s.type==="external"?{name:s.name,url:s.external.url}:s.type==="file"?{name:s.name,url:s.file.url}:{name:s.name,url:""});return t?Promise.all(r.map(async s=>{let o=await t.processFileUrl(s.url,s.name);return {...s,url:o}})):r}case "checkbox":return n.checkbox;case "url":return n.url;case "email":return n.email;case "phone_number":return n.phone_number;case "formula":return n.formula;case "relation":{let e=n;return Array.isArray(e.relation)?e.relation.map(r=>r.id):[]}case "rollup":return n.rollup;case "created_time":return n.created_time;case "created_by":{let e=n.created_by;return {id:e.id,name:e.name,avatar_url:e.avatar_url}}case "last_edited_time":return n.last_edited_time;case "last_edited_by":{let e=n.last_edited_by;return {id:e.id,name:e.name,avatar_url:e.avatar_url}}default:return null}}async function W(n,t){switch(n.type){case "title":{let e=n;return Array.isArray(e.title)?e.title.map(r=>({content:r.plain_text,annotations:r.annotations,href:r.href,...r.type==="text"&&{link:r.text.link}})):[]}case "rich_text":{let e=n;return Array.isArray(e.rich_text)?e.rich_text.map(r=>({content:r.plain_text,annotations:r.annotations,href:r.href,...r.type==="text"&&{link:r.text.link}})):[]}case "number":return n.number;case "select":{let e=n.select;return e?{id:e.id,name:e.name,color:e.color}:null}case "multi_select":return n.multi_select.map(r=>({id:r.id,name:r.name,color:r.color}));case "date":{let e=n;return e.date?{start:e.date.start,end:e.date.end,time_zone:e.date.time_zone,parsedStart:e.date.start?new Date(e.date.start):null,parsedEnd:e.date.end?new Date(e.date.end):null}:null}case "people":{let e=n;return Array.isArray(e.people)?e.people.map(r=>({id:r.id,name:r.name,avatar_url:r.avatar_url,object:r.object,type:r.type,...r.type==="person"&&r.person&&{email:r.person.email}})):[]}case "files":{let r=n.files.map(s=>s.type==="external"?{name:s.name,type:s.type,external:{url:s.external.url}}:s.type==="file"?{name:s.name,type:s.type,file:{url:s.file.url,expiry_time:s.file.expiry_time}}:{name:s.name,type:s.type});return t?Promise.all(r.map(async s=>{let o=s.type==="external"?s.external?.url:s.file?.url;if(o){let a=await t.processFileUrl(o,s.name);s.type==="external"&&s.external?s.external.url=a:s.type==="file"&&s.file&&(s.file.url=a);}return s})):r}case "checkbox":return n.checkbox;case "url":return n.url;case "email":return n.email;case "phone_number":return n.phone_number;case "formula":{let e=n.formula;return {type:e.type,value:e.type==="string"?e.string:e.type==="number"?e.number:e.type==="boolean"?e.boolean:e.type==="date"?e.date:null}}case "relation":{let e=n;return Array.isArray(e.relation)?e.relation.map(r=>({id:r.id})):[]}case "rollup":{let e=n.rollup;return {type:e.type,function:e.function,...e.type==="array"&&{array:e.array},...e.type==="number"&&{number:e.number},...e.type==="date"&&{date:e.date}}}case "created_time":return {timestamp:n.created_time,date:new Date(n.created_time)};case "created_by":{let e=n.created_by;return {id:e.id,name:e.name,avatar_url:e.avatar_url,object:e.object,type:e.type,...e.type==="person"&&e.person&&{email:e.person.email}}}case "last_edited_time":return {timestamp:n.last_edited_time,date:new Date(n.last_edited_time)};case "last_edited_by":{let e=n.last_edited_by;return {id:e.id,name:e.name,avatar_url:e.avatar_url,object:e.object,type:e.type,...e.type==="person"&&e.person&&{email:e.person.email}}}case "status":{let e=n.status;return e?{id:e.id,name:e.name,color:e.color}:null}case "unique_id":{let e=n.unique_id;return e?{prefix:e.prefix,number:e.number}:null}default:return null}}async function Z(n,t,e={}){switch(t){case "simple":return F(n,e.fileManager);case "advanced":return B(n,e.fileManager);default:return n}}async function F(n,t){let e={id:n.id};return await Promise.all(Object.entries(n.properties).map(async([r,s])=>{e[r]=await G(s,t);})),e}async function B(n,t){let e={id:n.id};return await Promise.all(Object.entries(n.properties).map(async([r,s])=>{e[r]=await W(s,t);})),e}async function de(n,t,e={}){return Promise.all(n.map(r=>Z(r,t,e)))}var U={title:["equals","does_not_equal","contains","does_not_contain","starts_with","ends_with","is_empty","is_not_empty"],rich_text:["equals","does_not_equal","contains","does_not_contain","starts_with","ends_with","is_empty","is_not_empty"],url:["equals","does_not_equal","contains","does_not_contain","starts_with","ends_with","is_empty","is_not_empty"],email:["equals","does_not_equal","contains","does_not_contain","starts_with","ends_with","is_empty","is_not_empty"],phone_number:["equals","does_not_equal","contains","does_not_contain","starts_with","ends_with","is_empty","is_not_empty"],number:["equals","does_not_equal","greater_than","less_than","greater_than_or_equal_to","less_than_or_equal_to","is_empty","is_not_empty"],select:["equals","does_not_equal","is_empty","is_not_empty"],multi_select:["contains","does_not_contain","is_empty","is_not_empty"],status:["equals","does_not_equal","is_empty","is_not_empty"],date:["equals","before","after","on_or_before","on_or_after","is_empty","is_not_empty"],created_time:["equals","before","after","on_or_before","on_or_after"],last_edited_time:["equals","before","after","on_or_before","on_or_after"],checkbox:["equals"],people:["contains","does_not_contain","is_empty","is_not_empty"],relation:["contains","does_not_contain","is_empty","is_not_empty"],created_by:["contains","does_not_contain"],last_edited_by:["contains","does_not_contain"],files:["is_empty","is_not_empty"],formula:["equals","does_not_equal","contains","does_not_contain","greater_than","less_than","greater_than_or_equal_to","less_than_or_equal_to","is_empty","is_not_empty"],rollup:["equals","does_not_equal","contains","does_not_contain","greater_than","less_than","greater_than_or_equal_to","less_than_or_equal_to","is_empty","is_not_empty"],unique_id:["equals","does_not_equal","greater_than","less_than","greater_than_or_equal_to","less_than_or_equal_to"],verification:["equals","before","after","on_or_before","on_or_after"],unknown:["equals","does_not_equal","is_empty","is_not_empty"]},b=class{constructor(t,e,r={},s,o="raw"){this.filterConditions=[];this.logicalOperator="and";this.nestedFilters=[];this.sortOptions=[];this.pageLimit=100;this.singleMode=null;this.recordType="raw";this.client=t,this.databaseId=e,this.fieldTypes=r,this.fileManager=s,this.recordType=o;}filter(t,e,r){if(!this.isValidOperatorForField(t,e))throw new Error(`Invalid operator "${e}" for field "${t}" of type "${this.getFieldTypeForFilter(t)}"`);let s=this.getFieldTypeForFilter(t),o=this.mapFieldTypeToNotionProperty(s);return this.filterConditions.push({property:t,operator:e,value:this.prepareFilterValue(s,e,r),propertyType:o}),this}mapFieldTypeToNotionProperty(t){if(!t)return "rich_text";switch(t){case "title":return "title";case "rich_text":return "rich_text";case "number":return "number";case "select":return "select";case "multi_select":return "multi_select";case "date":case "created_time":case "last_edited_time":return "date";case "checkbox":return "checkbox";case "people":case "created_by":case "last_edited_by":return "people";case "files":return "files";case "url":return "url";case "email":return "email";case "phone_number":return "phone_number";case "relation":return "relation";case "formula":return "formula";case "rollup":return "rollup";case "status":return "status";case "unique_id":return "unique_id";case "button":return "button";default:return "rich_text"}}prepareFilterValue(t,e,r){return e==="is_empty"||e==="is_not_empty"?true:t==="date"||t==="created_time"||t==="last_edited_time"?r instanceof Date?r.toISOString():r:t==="multi_select"&&(e==="contains"||e==="does_not_contain")&&Array.isArray(r)?r[0]||"":r}sort(t,e="ascending"){if(!this.isValidSortField(t))throw new Error(`Invalid sort property "${t}". Property not found in database schema. Available fields: ${Object.keys(this.fieldTypes).join(", ")}`);if(e!=="ascending"&&e!=="descending")throw new Error(`Invalid sort direction "${e}". Must be "ascending" or "descending".`);return u.log(`Adding sort: ${t} ${e}`),this.sortOptions.push({property:t,direction:e}),this}limit(t){return this.pageLimit=t,this}startAfter(t){return this.startCursor=t,this}single(){return this.singleMode="required",this.pageLimit=2,this}maybeSingle(){return this.singleMode="optional",this.pageLimit=1,this}then(t,e){return this.execute().then(t,e)}async execute(){let{results:t}=await this.paginate(this.pageLimit);if(this.singleMode==="required"){if(t.length===0)throw new Error("No records found matching the query");if(t.length>1)throw new Error("Multiple records found when expecting exactly one");return t[0]}return this.singleMode==="optional"?t.length>0?t[0]:null:t}async paginate(t=100){let e=this.buildFilter();try{u.query(this.databaseId,{database_id:this.databaseId,filter:e||void 0,sorts:this.sortOptions,page_size:t,start_cursor:this.startCursor});let r=await this.client.databases.query({database_id:this.databaseId,filter:e||void 0,sorts:this.sortOptions&&this.sortOptions.length>0?this.sortOptions:void 0,page_size:t,start_cursor:this.startCursor});u.log(`Query returned ${r.results.length} results`);let s=r.results;u.log("[QueryBuilder] FileManager present:",!!this.fileManager),u.log("[QueryBuilder] Cache enabled:",this.fileManager?.isCacheEnabled()),u.log(`[QueryBuilder] recordType=${this.recordType}`);let o;switch(this.recordType){case "advanced":o=await Promise.all(s.map(async a=>B(a,this.fileManager)));break;case "simple":o=await Promise.all(s.map(async a=>F(a,this.fileManager)));break;case "raw":o=s;break;default:o=s;break}return {results:o,hasMore:r.has_more,nextCursor:r.next_cursor}}catch(r){throw u.error(r,{databaseId:this.databaseId,filter:e,sorts:this.sortOptions,pageSize:t,startCursor:this.startCursor}),r}}async all(){let t=[],e=true,r=null;for(;e;){r&&this.startAfter(r);let s=await this.paginate(100);t=[...t,...s.results],e=s.hasMore,r=s.nextCursor;}return t}buildFilter(){let t=[];if(this.filterConditions.forEach(e=>{let{property:r,operator:s,value:o,propertyType:a}=e,i={property:r};if(!a)throw new Error(`Property type not determined for property: ${String(r)}`);let c=this.mapToNotionOperator(s);i[a]={[c]:o},t.push(i);}),t.push(...this.nestedFilters),t.length!==0)return t.length===1?t[0]:{[this.logicalOperator]:t}}mapToNotionOperator(t){switch(t){case "equals":case "does_not_equal":case "contains":case "does_not_contain":case "starts_with":case "ends_with":case "greater_than":case "less_than":case "greater_than_or_equal_to":case "less_than_or_equal_to":case "before":case "after":case "on_or_before":case "on_or_after":case "is_empty":case "is_not_empty":return t;default:return t}}getFieldTypeForFilter(t){return this.fieldTypes[t]?.type}isValidOperatorForField(t,e){let r=this.getFieldTypeForFilter(t);return !r||!(r in U)?false:U[r].includes(e)}isValidSortField(t){return this.getFieldTypeForFilter(t)!==void 0}};var q=class{constructor(t,e){this.client=t;this.fileManager=e;}query(t,e,r){return e?new b(this.client,t,e,this.fileManager,r?.recordType||"raw"):new b(this.client,t,{},this.fileManager,r?.recordType||"raw")}async getDatabase(t,e={}){try{u.query(t,{database_id:t,filter:e.filter,sorts:e.sorts,page_size:e.pageSize,start_cursor:e.startCursor});let r=await this.client.databases.query({database_id:t,filter:e.filter,sorts:e.sorts,page_size:e.pageSize,start_cursor:e.startCursor});u.log(`Query returned ${r.results.length} results`);let s=r.results;return await Promise.all(s.map(o=>this.enrichRecordFiles(o))),{results:s,nextCursor:r.next_cursor,hasMore:r.has_more}}catch(r){throw u.error(r,{databaseId:t,options:e}),r}}async getRecord(t){let e=await this.client.pages.retrieve({page_id:t});return await this.enrichRecordFiles(e),e}async getAllDatabaseRecords(t,e={}){let r=[],s=true,o=null;for(;s;){let a=await this.getDatabase(t,{...e,startCursor:o||void 0});r.push(...a.results),s=a.hasMore,o=a.nextCursor;}return r}async enrichRecordFiles(t){t.cover&&(t.cover=await this.processPageCover(t.cover,`${t.id}-cover`)),t.icon&&t.icon.type==="file"&&(t.icon=await this.processPageIcon(t.icon,`${t.id}-icon`));let e=Object.entries(t.properties);await Promise.all(e.map(async([r,s])=>{if(s.type==="files"){let o=s;o.files=await Promise.all(o.files.map((a,i)=>this.processPropertyFile(a,`${t.id}-${r}-${i}`)));}}));}async processPageCover(t,e){if(t.type==="external"){let r=await this.safeProcessUrl(t.external.url,e);t.external.url=r;}else if(t.type==="file"){let r=await this.safeProcessUrl(t.file.url,e);t.file.url=r;}return t}async processPageIcon(t,e){let r=await this.safeProcessUrl(t.file.url,e);return t.file.url=r,t}async processPropertyFile(t,e){let r=t.name||e,s=this.fileManager.extractFileUrl(t);if(!s)return t;try{let o=await this.fileManager.processFileUrl(s,r);t.type==="external"&&t.external?t.external.url=o:t.type==="file"&&t.file&&(t.file.url=o);}catch(o){u.error(o,{scope:"file-cache",fileName:r,originalUrl:s});}return t}async safeProcessUrl(t,e){try{return await this.fileManager.processFileUrl(t,e)}catch(r){return u.error(r,{scope:"file-cache",fallbackName:e,originalUrl:t}),t}}};var K=class K{constructor(t,e){this.client=new client.Client({auth:t}),this.config=E(e),u.configure(this.config.debug),this.fileManager=new k(this.config),this.pageContentService=new M(this.client,this.fileManager),this.databaseService=new q(this.client,this.fileManager);}query(t,e){let r=this.databases?.[t];if(!r)throw new Error(`Database "${String(t)}" not found in registry. Make sure you've imported the generated types file.`);return this._query(r.id,r.fields,{recordType:e?.recordType||"raw"})}_query(t,e,r){return this.databaseService.query(t,e,r)}async getRecord(t){return this.databaseService.getRecord(t)}async getPageContent(t,e={}){let r=e.recursive??true;return this.pageContentService.getPageContent(t,r)}};K.prototype.databases={};var j=K;function pe(n,t){j.prototype.databases[n]=t;}function J(n){return n==="bulleted_list_item"||n==="numbered_list_item"}function $(n){let t=[],e=0;for(;e<n.length;){let r=n[e],s=r.type;if(J(s)){let o=s,a=[];for(;e<n.length&&J(n[e].type);){let i=n[e];if(i.type!==o)break;a.push(i),e+=1;}t.push({kind:"list_group",listType:o,items:a});continue}t.push(r),e+=1;}return t}function X(n){return n.type}function x(n){let t=X(n);return n[t]}function Y(n,t){return t.repeat(Math.max(0,n*2))}function me(n){let t=Math.max(1,Math.floor(n)),e="";for(;t>0;)t--,e=String.fromCharCode(97+t%26)+e,t=Math.floor(t/26);return e}function ye(n){let t=Math.max(1,Math.floor(n)),e=[[1e3,"m"],[900,"cm"],[500,"d"],[400,"cd"],[100,"c"],[90,"xc"],[50,"l"],[40,"xl"],[10,"x"],[9,"ix"],[5,"v"],[4,"iv"],[1,"i"]],r="";for(let[s,o]of e)for(;t>=s;)r+=o,t-=s;return r}function fe(n,t){let r=(Math.max(1,t)-1)%3;return r===0?String(n):r===1?me(n):ye(n)}function I(n,t,e,r){let s=t.id,o=`[${n}]${e?` ${e}`:""}`;return o+=` [id: ${s}]`,`${o}
-`}function h(n,t,e,r){let s=n.children;return !s||!s.length?"":L(s,t,e,r)}function _e(n,t,e,r,s){let o=Y(e,r.listIndent),a="";if(t==="bulleted_list_item")for(let i of n){let c=x(i),d=l(c?.rich_text??[]);a+=`${o}- ${d}
-`,a+=h(i,e+1,r,0);}else {let i=1;for(let c of n){let d=x(c),y=l(d?.rich_text??[]),_=r.alternateOrderedListStyles?fe(i,s):String(i);a+=`${o}${_}. ${y}
-`,a+=h(c,e+1,r,s),i++;}}return a}function ge(n,t){let e=x(n),s=(n.children||[]).map(c=>(x(c)?.cells||[]).map(_=>{let P=Array.isArray(_)?_:[];return l(P)})),o=!!e?.has_column_header,a="";if(s.length===0)return a;let i=s[0].length;if(o){a+=`| ${s[0].join(" | ")} |
-`,a+=`| ${Array.from({length:i}).map(()=>"---").join(" | ")} |
-`;for(let c=1;c<s.length;c++)a+=`| ${s[c].join(" | ")} |
-`;}else {a+=`| ${Array.from({length:i}).map(()=>" ").join(" | ")} |
-`,a+=`| ${Array.from({length:i}).map(()=>"---").join(" | ")} |
-`;for(let c=0;c<s.length;c++)a+=`| ${s[c].join(" | ")} |
-`;}return a}function he(n,t,e){let r=X(n),s=x(n);if(s===void 0)throw new Error(`blocksToMarkdown expects Raw Notion blocks; missing field for type "${r}"`);let o=Y(t,e.listIndent);switch(r){case "paragraph":{let a=l(s?.rich_text??[]);return a?`${a}`:""}case "quote":{let a=l(s?.rich_text??[]);return a?`> ${a}`:">"}case "toggle":return `${l(s?.rich_text??[])}${h(n,t+1,e,0)}`;case "to_do":{let a=!!s?.checked,i=l(s?.rich_text??[]);return `${o}- [${a?"x":" "}] ${i}${h(n,t+1,e,0)}`}case "heading_1":return `# ${l(s?.rich_text??[])}`;case "heading_2":return `## ${l(s?.rich_text??[])}`;case "heading_3":return `### ${l(s?.rich_text??[])}`;case "code":{let a=s?.language||"",i=m(s?.rich_text??[]);return `\`\`\`
+"use strict";
+var client = require("@notionhq/client");
+var re = "./public/assets/notion-files",
+  f = {
+    files: {
+      strategy: "direct",
+      storage: {
+        path: re,
+        endpoint: "",
+        bucket: "",
+        accessKey: "",
+        secretKey: "",
+        region: "",
+      },
+    },
+    debug: { enabled: false, level: "info" },
+  };
+function E(n) {
+  return n
+    ? {
+        files: {
+          strategy: n.files?.strategy ?? f.files.strategy,
+          storage: {
+            path: n.files?.storage?.path ?? f.files.storage.path,
+            endpoint: n.files?.storage?.endpoint ?? f.files.storage.endpoint,
+            bucket: n.files?.storage?.bucket ?? f.files.storage.bucket,
+            accessKey: n.files?.storage?.accessKey ?? f.files.storage.accessKey,
+            secretKey: n.files?.storage?.secretKey ?? f.files.storage.secretKey,
+            region: n.files?.storage?.region ?? f.files.storage.region,
+          },
+        },
+        debug: {
+          enabled: n.debug?.enabled ?? f.debug.enabled,
+          level: n.debug?.level ?? f.debug.level,
+        },
+      }
+    : f;
+}
+var S = class {
+    async processFileUrl(t, e) {
+      return t;
+    }
+  },
+  v = class {
+    constructor(t) {
+      this.config = t;
+    }
+    async processFileUrl(t, e) {
+      try {
+        let r = N(t),
+          s = Q(e),
+          o = `${r}${s}`,
+          a = await this.createStorage();
+        if (await a.exists(o)) return a.getPublicUrl(o);
+        let { downloadFile: i } = await import("./file-utils-42FAMQFG.js"),
+          c = await i(t);
+        return (await a.store(o, c), a.getPublicUrl(o));
+      } catch (r) {
+        return (
+          console.warn(`Failed to cache file locally: ${e} from ${t}`, {
+            fileName: e,
+            url: t,
+            error: r instanceof Error ? r.message : String(r),
+          }),
+          t
+        );
+      }
+    }
+    async createStorage() {
+      let { LocalStorage: t } = await import("./s3-storage-47VTK7YA.js"),
+        e = this.config?.storage?.path || "./public/assets/notion-files";
+      return new t(e);
+    }
+  },
+  T = class {
+    constructor(t) {
+      this.config = t;
+    }
+    async processFileUrl(t, e) {
+      if (!this.config?.storage) return t;
+      try {
+        let r = N(t),
+          s = Q(e),
+          o = this.config.storage.path || "",
+          a = o ? `${o}${r}${s}` : `${r}${s}`,
+          i = await this.createStorage();
+        if (await i.exists(a)) return i.getPublicUrl(a);
+        let { downloadFile: c } = await import("./file-utils-42FAMQFG.js"),
+          d = await c(t);
+        return (await i.store(a, d), i.getPublicUrl(a));
+      } catch (r) {
+        return (
+          console.warn(`Failed to store file remotely: ${e} from ${t}`, {
+            fileName: e,
+            url: t,
+            error: r instanceof Error ? r.message : String(r),
+          }),
+          t
+        );
+      }
+    }
+    async createStorage() {
+      if (!this.config?.storage)
+        throw new Error(
+          "S3 storage configuration is required for remote strategy",
+        );
+      let { S3Storage: t } = await import("./s3-storage-47VTK7YA.js");
+      return new t({
+        endpoint: this.config.storage.endpoint,
+        bucket: this.config.storage.bucket || "default-bucket",
+        accessKey: this.config.storage.accessKey,
+        secretKey: this.config.storage.secretKey,
+        region: this.config.storage.region,
+      });
+    }
+  },
+  k = class {
+    constructor(t) {
+      let e = t.files;
+      switch (e?.strategy) {
+        case "local":
+          this.strategy = new v(e);
+          break;
+        case "remote":
+          this.strategy = new T(e);
+          break;
+        case "direct":
+        default:
+          this.strategy = new S();
+          break;
+      }
+    }
+    isCacheEnabled() {
+      return this.strategy instanceof v || this.strategy instanceof T;
+    }
+    async processFileUrl(t, e) {
+      return this.strategy.processFileUrl(t, e);
+    }
+    async processFileInfoArray(t) {
+      return Promise.all(
+        t.map(async (e) => {
+          let r = await this.processFileUrl(e.url, e.name);
+          return { ...e, url: r };
+        }),
+      );
+    }
+    extractFileUrl(t) {
+      return t.type === "external"
+        ? t.external.url
+        : t.type === "file"
+          ? t.file.url
+          : "";
+    }
+    createFileInfo(t) {
+      return {
+        name: t.name,
+        url: this.extractFileUrl(t),
+        type: t.type,
+        ...(t.type === "file" && { expiry_time: t.file.expiry_time }),
+      };
+    }
+  };
+function N(n) {
+  let t = n.match(/([a-f0-9-]{36})/g);
+  if (t && t.length >= 2) return t[1].replace(/-/g, "");
+  if (t && t.length === 1) return t[0].replace(/-/g, "");
+  let e = 0;
+  for (let r = 0; r < n.length; r++) {
+    let s = n.charCodeAt(r);
+    ((e = (e << 5) - e + s), (e = e & e));
+  }
+  return Math.abs(e).toString(16);
+}
+function Q(n) {
+  let t = n.match(/\.([a-zA-Z0-9]+)(?:\?|$)/);
+  return t ? `.${t[1]}` : "";
+}
+function ne(n, t) {
+  let e = n;
+  return (
+    t.code && (e = `\`${e}\``),
+    t.bold && (e = `**${e}**`),
+    t.italic && (e = `*${e}*`),
+    t.strikethrough && (e = `~~${e}~~`),
+    e
+  );
+}
+function m(n = []) {
+  return Array.isArray(n) ? n.map((t) => t.plain_text || "").join("") : "";
+}
+function l(n = []) {
+  return Array.isArray(n)
+    ? n
+        .map((t) => {
+          let e = t.plain_text || "",
+            r = ne(e, t.annotations),
+            s = t.href;
+          return s ? `[${r}](${s})` : r;
+        })
+        .join("")
+    : "";
+}
+function C(n) {
+  return n
+    .replace(/&/g, "&amp;")
+    .replace(/</g, "&lt;")
+    .replace(/>/g, "&gt;")
+    .replace(/"/g, "&quot;")
+    .replace(/'/g, "&#39;");
+}
+function p(n = [], t = "") {
+  if (!Array.isArray(n)) return "";
+  let e = t || "";
+  return n
+    .map((r) => {
+      let s = C(r.plain_text || ""),
+        {
+          bold: o,
+          italic: a,
+          strikethrough: i,
+          code: c,
+          color: d,
+        } = r.annotations;
+      (c && (s = `<code>${s}</code>`),
+        o && (s = `<strong>${s}</strong>`),
+        a && (s = `<em>${s}</em>`),
+        i && (s = `<s>${s}</s>`));
+      let y = [];
+      if (d && d !== "default")
+        if (d.endsWith("_background")) {
+          let P = d.replace("_background", "");
+          y.push(`${e}bg-${P}`);
+        } else y.push(`${e}color-${d}`);
+      y.length && (s = `<span class="${y.join(" ")}">${s}</span>`);
+      let _ = r.href;
+      return _ ? `<a href="${C(_)}">${s}</a>` : s;
+    })
+    .join("");
+}
+function V(n) {
+  return n.type;
+}
+function se(n) {
+  return n[V(n)];
+}
+async function ae(n, t, e) {
+  if (e.mediaUrlResolver) {
+    let r = await e.mediaUrlResolver(n, t);
+    if (r) return r;
+  }
+  return t
+    ? t?.type === "external"
+      ? (t?.external?.url ?? "")
+      : (t?.file?.url ?? "")
+    : "";
+}
+async function oe(n, t) {
+  let e = V(n),
+    r = se(n),
+    s = n.children || [],
+    o = await A(s, t);
+  switch (e) {
+    case "paragraph":
+    case "quote": {
+      let a = m(r?.rich_text ?? []),
+        i = l(r?.rich_text ?? []);
+      return {
+        id: n.id,
+        type: e,
+        text: a,
+        text_md: i,
+        children: o.length ? o : void 0,
+      };
+    }
+    case "heading_1":
+    case "heading_2":
+    case "heading_3": {
+      let a = m(r?.rich_text ?? []),
+        i = l(r?.rich_text ?? []);
+      return { id: n.id, type: e, text: a, text_md: i };
+    }
+    case "bulleted_list_item":
+    case "numbered_list_item":
+    case "toggle": {
+      let a = m(r?.rich_text ?? []),
+        i = l(r?.rich_text ?? []);
+      return {
+        id: n.id,
+        type: e,
+        text: a,
+        text_md: i,
+        children: o.length ? o : void 0,
+      };
+    }
+    case "to_do": {
+      let a = m(r?.rich_text ?? []),
+        i = l(r?.rich_text ?? []),
+        c = !!r?.checked;
+      return {
+        id: n.id,
+        type: e,
+        checked: c,
+        text: a,
+        text_md: i,
+        children: o.length ? o : void 0,
+      };
+    }
+    case "code": {
+      let a = r?.language || "",
+        i = m(r?.rich_text ?? []),
+        c = l(r?.rich_text ?? []);
+      return { id: n.id, type: e, language: a, text: i, text_md: c };
+    }
+    case "bookmark":
+    case "embed":
+    case "link_preview": {
+      let a = r?.url || "",
+        i = m(r?.caption ?? []) || void 0,
+        c = l(r?.caption ?? []) || void 0;
+      return { id: n.id, type: e, url: a, caption_text: i, caption_md: c };
+    }
+    case "image":
+    case "video":
+    case "audio":
+    case "file":
+    case "pdf": {
+      let a = await ae(n, r, t),
+        i = m(r?.caption ?? []) || void 0,
+        c = l(r?.caption ?? []) || void 0,
+        d = r?.file?.expiry_time || void 0;
+      return {
+        id: n.id,
+        type: e,
+        url: a,
+        caption_text: i,
+        caption_md: c,
+        expiry_time: d,
+      };
+    }
+    case "equation": {
+      let a = r?.expression || "";
+      return { id: n.id, type: e, expression: a };
+    }
+    case "divider":
+      return { id: n.id, type: e };
+    case "table": {
+      let a = !!r?.has_column_header,
+        i = !!r?.has_row_header,
+        d = (await A(s, t)).filter((y) => y.type === "table_row");
+      return {
+        id: n.id,
+        type: e,
+        hasColumnHeader: a,
+        hasRowHeader: i,
+        rows: d,
+      };
+    }
+    case "table_row": {
+      let a =
+        r?.cells?.map((i) => {
+          let c = Array.isArray(i) ? i : [];
+          return { text: m(c), text_md: l(c) };
+        }) ?? [];
+      return { id: n.id, type: e, cells: a };
+    }
+    case "columns": {
+      let i = (o.length ? o : [])
+        .filter((c) => c.type === "column")
+        .map((c) => ({ type: "column", children: c.children || [] }));
+      return { id: n.id, type: "columns", children: i };
+    }
+    case "column":
+      return { id: n.id, type: e, children: o.length ? o : [] };
+    case "synced_block": {
+      let a = r?.synced_from?.block_id || void 0;
+      return {
+        id: n.id,
+        type: e,
+        originalBlockId: a,
+        children: o.length ? o : void 0,
+      };
+    }
+    case "child_page": {
+      let a = r?.title || void 0;
+      return { id: n.id, type: e, title: a, pageId: n.id };
+    }
+    case "child_database": {
+      let a = r?.title || void 0;
+      return { id: n.id, type: e, title: a, databaseId: n.id };
+    }
+    case "breadcrumb":
+    case "table_of_contents":
+    case "template":
+      return { id: n.id, type: e, children: o.length ? o : void 0 };
+    default:
+      return null;
+  }
+}
+async function A(n, t) {
+  let e = [];
+  for (let r of n) {
+    let s = await oe(r, t);
+    s && e.push(s);
+  }
+  return e;
+}
+async function H(n = [], t = {}) {
+  let e = { mediaUrlResolver: t.mediaUrlResolver };
+  return A(n, e);
+}
+async function z(n, t = {}) {
+  let e = ce(n),
+    r = n.children || [],
+    s = r.length ? await O(r, t) : void 0;
+  return {
+    id: n.id,
+    type: n.type,
+    content: e,
+    hasChildren: !!n.has_children,
+    ...(s && s.length ? { children: s } : {}),
+  };
+}
+async function O(n = [], t = {}) {
+  return Promise.all(n.map((e) => z(e, t)));
+}
+async function ie(n = [], t = {}) {
+  let e =
+    t.mediaUrlResolver ||
+    (async (r, s) => {
+      if (!s) return "";
+      let o = s?.type === "external" ? s?.external?.url : s?.file?.url;
+      if (!t.fileManager || !o) return o || "";
+      try {
+        return await t.fileManager.processFileUrl(o, `content-block-${r.id}`);
+      } catch {
+        return o || "";
+      }
+    });
+  return H(n, { mediaUrlResolver: e });
+}
+function ce(n) {
+  let t = n.type,
+    e = n[t];
+  switch (t) {
+    case "paragraph":
+    case "heading_1":
+    case "heading_2":
+    case "heading_3":
+    case "bulleted_list_item":
+    case "numbered_list_item":
+    case "toggle":
+    case "quote":
+      return { text: g(e?.rich_text), richText: e?.rich_text };
+    case "code":
+      return { text: g(e?.rich_text), language: e?.language };
+    case "image":
+    case "file":
+    case "pdf":
+    case "video":
+    case "audio": {
+      let r = le(e);
+      return { caption: e?.caption ? g(e.caption) : "", url: r };
+    }
+    case "bookmark":
+    case "embed":
+    case "link_preview":
+      return { url: e?.url || "", caption: e?.caption ? g(e.caption) : "" };
+    case "divider":
+    case "equation":
+    case "table_of_contents":
+      return e || {};
+    case "to_do":
+      return { text: g(e?.rich_text), checked: !!e?.checked };
+    case "callout":
+      return { text: g(e?.rich_text), icon: e?.icon };
+    case "table":
+      return {
+        tableWidth: e?.table_width,
+        hasColumnHeader: e?.has_column_header,
+        hasRowHeader: e?.has_row_header,
+      };
+    case "table_row":
+      return {
+        cells: (e?.cells || []).map((r) => ({ plainText: g(r), richText: r })),
+      };
+    default:
+      return e || {};
+  }
+}
+function le(n) {
+  return (
+    (n && (n?.type === "external" ? n?.external?.url : n?.file?.url)) || ""
+  );
+}
+function g(n = []) {
+  return Array.isArray(n) ? n.map((t) => t?.plain_text || "").join("") : "";
+}
+var M = class {
+  constructor(t, e) {
+    this.client = t;
+    this.fileManager = e;
+  }
+  async getPageContent(t, e = true) {
+    let r = await this.getBlocks(t);
+    if (e)
+      for (let s of r)
+        s.has_children && (s.children = await this.getPageContent(s.id, true));
+    return r;
+  }
+  async getBlocks(t) {
+    let e = [],
+      r = true,
+      s;
+    for (; r; ) {
+      let o = await this.client.blocks.children.list({
+          block_id: t,
+          start_cursor: s,
+        }),
+        i = o.results;
+      (await Promise.all(i.map((c) => this.enrichBlockFiles(c))),
+        (e = [...e, ...i]),
+        (r = o.has_more),
+        (s = o.next_cursor || void 0));
+    }
+    return e;
+  }
+  async convertBlocksToSimple(t) {
+    return O(t, { fileManager: this.fileManager });
+  }
+  async enrichBlockFiles(t) {
+    let e = t.type,
+      r = t[e];
+    if (!r) return;
+    let s = async (a, i) => {
+        if (!a) return a;
+        try {
+          return await this.fileManager.processFileUrl(a, i || `${t.id}-${e}`);
+        } catch {
+          return a;
+        }
+      },
+      o = async (a, i) => {
+        a &&
+          (a.type === "external" &&
+            a.external?.url &&
+            (a.external.url = (await s(a.external.url, i)) || a.external.url),
+          a.type === "file" &&
+            a.file?.url &&
+            (a.file.url = (await s(a.file.url, i)) || a.file.url));
+      };
+    switch (e) {
+      case "image":
+      case "video":
+      case "audio":
+      case "file":
+      case "pdf": {
+        await o(r, r?.name);
+        break;
+      }
+      case "embed":
+      case "bookmark":
+      case "link_preview": {
+        r.url && (r.url = (await s(r.url, r?.url)) || r.url);
+        break;
+      }
+      case "callout": {
+        r.icon && r.icon.type === "file" && (await o(r.icon, `${t.id}-icon`));
+        break;
+      }
+    }
+  }
+};
+var D = class {
+    constructor() {
+      this.config = { enabled: false, level: "info" };
+    }
+    configure(t) {
+      this.config = { ...this.config, ...t };
+    }
+    normalizeLevel(t) {
+      return t && ["error", "warn", "info", "debug"].includes(t) ? t : "info";
+    }
+    shouldLog(t) {
+      if (!this.config.enabled) return false;
+      let e = ["error", "warn", "info", "debug"],
+        r = e.indexOf(this.normalizeLevel(this.config.level));
+      return e.indexOf(t) <= r;
+    }
+    log(...t) {
+      this.shouldLog("info") && console.log("[NotionCMS Debug]:", ...t);
+    }
+    query(t, e) {
+      this.shouldLog("debug") &&
+        console.log(
+          `
+[NotionCMS Query]:`,
+          {
+            databaseId: t,
+            filter: e.filter,
+            sorts: e.sorts,
+            pageSize: e.page_size,
+            startCursor: e.start_cursor,
+            timestamp: new Date().toISOString(),
+          },
+        );
+    }
+    error(t, e) {
+      this.shouldLog("error") &&
+        console.error("[NotionCMS Error]:", {
+          message: t.message,
+          code: t.code,
+          context: e,
+          timestamp: new Date().toISOString(),
+        });
+    }
+  },
+  u = new D();
+async function G(n, t) {
+  switch (n.type) {
+    case "unique_id":
+      return n.unique_id.number;
+    case "title":
+      return n.title?.[0]?.plain_text ?? "";
+    case "rich_text":
+      return n.rich_text?.[0]?.plain_text ?? "";
+    case "number":
+      return n.number;
+    case "select":
+      return n.select?.name ?? null;
+    case "multi_select":
+      return n.multi_select.map((e) => e.name);
+    case "date": {
+      let e = n;
+      return e.date ? new Date(e.date.start) : null;
+    }
+    case "people": {
+      let e = n;
+      return Array.isArray(e.people) ? e.people.map((r) => r.name || "") : [];
+    }
+    case "files": {
+      let r = n.files.map((s) =>
+        s.type === "external"
+          ? { name: s.name, url: s.external.url }
+          : s.type === "file"
+            ? { name: s.name, url: s.file.url }
+            : { name: s.name, url: "" },
+      );
+      return t
+        ? Promise.all(
+            r.map(async (s) => {
+              let o = await t.processFileUrl(s.url, s.name);
+              return { ...s, url: o };
+            }),
+          )
+        : r;
+    }
+    case "checkbox":
+      return n.checkbox;
+    case "url":
+      return n.url;
+    case "email":
+      return n.email;
+    case "phone_number":
+      return n.phone_number;
+    case "formula":
+      return n.formula;
+    case "relation": {
+      let e = n;
+      return Array.isArray(e.relation) ? e.relation.map((r) => r.id) : [];
+    }
+    case "rollup":
+      return n.rollup;
+    case "created_time":
+      return n.created_time;
+    case "created_by": {
+      let e = n.created_by;
+      return { id: e.id, name: e.name, avatar_url: e.avatar_url };
+    }
+    case "last_edited_time":
+      return n.last_edited_time;
+    case "last_edited_by": {
+      let e = n.last_edited_by;
+      return { id: e.id, name: e.name, avatar_url: e.avatar_url };
+    }
+    default:
+      return null;
+  }
+}
+async function W(n, t) {
+  switch (n.type) {
+    case "title": {
+      let e = n;
+      return Array.isArray(e.title)
+        ? e.title.map((r) => ({
+            content: r.plain_text,
+            annotations: r.annotations,
+            href: r.href,
+            ...(r.type === "text" && { link: r.text.link }),
+          }))
+        : [];
+    }
+    case "rich_text": {
+      let e = n;
+      return Array.isArray(e.rich_text)
+        ? e.rich_text.map((r) => ({
+            content: r.plain_text,
+            annotations: r.annotations,
+            href: r.href,
+            ...(r.type === "text" && { link: r.text.link }),
+          }))
+        : [];
+    }
+    case "number":
+      return n.number;
+    case "select": {
+      let e = n.select;
+      return e ? { id: e.id, name: e.name, color: e.color } : null;
+    }
+    case "multi_select":
+      return n.multi_select.map((r) => ({
+        id: r.id,
+        name: r.name,
+        color: r.color,
+      }));
+    case "date": {
+      let e = n;
+      return e.date
+        ? {
+            start: e.date.start,
+            end: e.date.end,
+            time_zone: e.date.time_zone,
+            parsedStart: e.date.start ? new Date(e.date.start) : null,
+            parsedEnd: e.date.end ? new Date(e.date.end) : null,
+          }
+        : null;
+    }
+    case "people": {
+      let e = n;
+      return Array.isArray(e.people)
+        ? e.people.map((r) => ({
+            id: r.id,
+            name: r.name,
+            avatar_url: r.avatar_url,
+            object: r.object,
+            type: r.type,
+            ...(r.type === "person" && r.person && { email: r.person.email }),
+          }))
+        : [];
+    }
+    case "files": {
+      let r = n.files.map((s) =>
+        s.type === "external"
+          ? { name: s.name, type: s.type, external: { url: s.external.url } }
+          : s.type === "file"
+            ? {
+                name: s.name,
+                type: s.type,
+                file: { url: s.file.url, expiry_time: s.file.expiry_time },
+              }
+            : { name: s.name, type: s.type },
+      );
+      return t
+        ? Promise.all(
+            r.map(async (s) => {
+              let o = s.type === "external" ? s.external?.url : s.file?.url;
+              if (o) {
+                let a = await t.processFileUrl(o, s.name);
+                s.type === "external" && s.external
+                  ? (s.external.url = a)
+                  : s.type === "file" && s.file && (s.file.url = a);
+              }
+              return s;
+            }),
+          )
+        : r;
+    }
+    case "checkbox":
+      return n.checkbox;
+    case "url":
+      return n.url;
+    case "email":
+      return n.email;
+    case "phone_number":
+      return n.phone_number;
+    case "formula": {
+      let e = n.formula;
+      return {
+        type: e.type,
+        value:
+          e.type === "string"
+            ? e.string
+            : e.type === "number"
+              ? e.number
+              : e.type === "boolean"
+                ? e.boolean
+                : e.type === "date"
+                  ? e.date
+                  : null,
+      };
+    }
+    case "relation": {
+      let e = n;
+      return Array.isArray(e.relation)
+        ? e.relation.map((r) => ({ id: r.id }))
+        : [];
+    }
+    case "rollup": {
+      let e = n.rollup;
+      return {
+        type: e.type,
+        function: e.function,
+        ...(e.type === "array" && { array: e.array }),
+        ...(e.type === "number" && { number: e.number }),
+        ...(e.type === "date" && { date: e.date }),
+      };
+    }
+    case "created_time":
+      return { timestamp: n.created_time, date: new Date(n.created_time) };
+    case "created_by": {
+      let e = n.created_by;
+      return {
+        id: e.id,
+        name: e.name,
+        avatar_url: e.avatar_url,
+        object: e.object,
+        type: e.type,
+        ...(e.type === "person" && e.person && { email: e.person.email }),
+      };
+    }
+    case "last_edited_time":
+      return {
+        timestamp: n.last_edited_time,
+        date: new Date(n.last_edited_time),
+      };
+    case "last_edited_by": {
+      let e = n.last_edited_by;
+      return {
+        id: e.id,
+        name: e.name,
+        avatar_url: e.avatar_url,
+        object: e.object,
+        type: e.type,
+        ...(e.type === "person" && e.person && { email: e.person.email }),
+      };
+    }
+    case "status": {
+      let e = n.status;
+      return e ? { id: e.id, name: e.name, color: e.color } : null;
+    }
+    case "unique_id": {
+      let e = n.unique_id;
+      return e ? { prefix: e.prefix, number: e.number } : null;
+    }
+    default:
+      return null;
+  }
+}
+async function Z(n, t, e = {}) {
+  switch (t) {
+    case "simple":
+      return F(n, e.fileManager);
+    case "advanced":
+      return B(n, e.fileManager);
+    default:
+      return n;
+  }
+}
+async function F(n, t) {
+  let e = { id: n.id };
+  return (
+    await Promise.all(
+      Object.entries(n.properties).map(async ([r, s]) => {
+        e[r] = await G(s, t);
+      }),
+    ),
+    e
+  );
+}
+async function B(n, t) {
+  let e = { id: n.id };
+  return (
+    await Promise.all(
+      Object.entries(n.properties).map(async ([r, s]) => {
+        e[r] = await W(s, t);
+      }),
+    ),
+    e
+  );
+}
+async function de(n, t, e = {}) {
+  return Promise.all(n.map((r) => Z(r, t, e)));
+}
+var U = {
+    title: [
+      "equals",
+      "does_not_equal",
+      "contains",
+      "does_not_contain",
+      "starts_with",
+      "ends_with",
+      "is_empty",
+      "is_not_empty",
+    ],
+    rich_text: [
+      "equals",
+      "does_not_equal",
+      "contains",
+      "does_not_contain",
+      "starts_with",
+      "ends_with",
+      "is_empty",
+      "is_not_empty",
+    ],
+    url: [
+      "equals",
+      "does_not_equal",
+      "contains",
+      "does_not_contain",
+      "starts_with",
+      "ends_with",
+      "is_empty",
+      "is_not_empty",
+    ],
+    email: [
+      "equals",
+      "does_not_equal",
+      "contains",
+      "does_not_contain",
+      "starts_with",
+      "ends_with",
+      "is_empty",
+      "is_not_empty",
+    ],
+    phone_number: [
+      "equals",
+      "does_not_equal",
+      "contains",
+      "does_not_contain",
+      "starts_with",
+      "ends_with",
+      "is_empty",
+      "is_not_empty",
+    ],
+    number: [
+      "equals",
+      "does_not_equal",
+      "greater_than",
+      "less_than",
+      "greater_than_or_equal_to",
+      "less_than_or_equal_to",
+      "is_empty",
+      "is_not_empty",
+    ],
+    select: ["equals", "does_not_equal", "is_empty", "is_not_empty"],
+    multi_select: ["contains", "does_not_contain", "is_empty", "is_not_empty"],
+    status: ["equals", "does_not_equal", "is_empty", "is_not_empty"],
+    date: [
+      "equals",
+      "before",
+      "after",
+      "on_or_before",
+      "on_or_after",
+      "is_empty",
+      "is_not_empty",
+    ],
+    created_time: ["equals", "before", "after", "on_or_before", "on_or_after"],
+    last_edited_time: [
+      "equals",
+      "before",
+      "after",
+      "on_or_before",
+      "on_or_after",
+    ],
+    checkbox: ["equals"],
+    people: ["contains", "does_not_contain", "is_empty", "is_not_empty"],
+    relation: ["contains", "does_not_contain", "is_empty", "is_not_empty"],
+    created_by: ["contains", "does_not_contain"],
+    last_edited_by: ["contains", "does_not_contain"],
+    files: ["is_empty", "is_not_empty"],
+    formula: [
+      "equals",
+      "does_not_equal",
+      "contains",
+      "does_not_contain",
+      "greater_than",
+      "less_than",
+      "greater_than_or_equal_to",
+      "less_than_or_equal_to",
+      "is_empty",
+      "is_not_empty",
+    ],
+    rollup: [
+      "equals",
+      "does_not_equal",
+      "contains",
+      "does_not_contain",
+      "greater_than",
+      "less_than",
+      "greater_than_or_equal_to",
+      "less_than_or_equal_to",
+      "is_empty",
+      "is_not_empty",
+    ],
+    unique_id: [
+      "equals",
+      "does_not_equal",
+      "greater_than",
+      "less_than",
+      "greater_than_or_equal_to",
+      "less_than_or_equal_to",
+    ],
+    verification: ["equals", "before", "after", "on_or_before", "on_or_after"],
+    unknown: ["equals", "does_not_equal", "is_empty", "is_not_empty"],
+  },
+  b = class {
+    constructor(t, e, r = {}, s, o = "raw") {
+      this.filterConditions = [];
+      this.logicalOperator = "and";
+      this.nestedFilters = [];
+      this.sortOptions = [];
+      this.pageLimit = 100;
+      this.singleMode = null;
+      this.recordType = "raw";
+      ((this.client = t),
+        (this.databaseId = e),
+        (this.fieldTypes = r),
+        (this.fileManager = s),
+        (this.recordType = o));
+    }
+    filter(t, e, r) {
+      if (!this.isValidOperatorForField(t, e))
+        throw new Error(
+          `Invalid operator "${e}" for field "${t}" of type "${this.getFieldTypeForFilter(t)}"`,
+        );
+      let s = this.getFieldTypeForFilter(t),
+        o = this.mapFieldTypeToNotionProperty(s);
+      return (
+        this.filterConditions.push({
+          property: t,
+          operator: e,
+          value: this.prepareFilterValue(s, e, r),
+          propertyType: o,
+        }),
+        this
+      );
+    }
+    mapFieldTypeToNotionProperty(t) {
+      if (!t) return "rich_text";
+      switch (t) {
+        case "title":
+          return "title";
+        case "rich_text":
+          return "rich_text";
+        case "number":
+          return "number";
+        case "select":
+          return "select";
+        case "multi_select":
+          return "multi_select";
+        case "date":
+        case "created_time":
+        case "last_edited_time":
+          return "date";
+        case "checkbox":
+          return "checkbox";
+        case "people":
+        case "created_by":
+        case "last_edited_by":
+          return "people";
+        case "files":
+          return "files";
+        case "url":
+          return "url";
+        case "email":
+          return "email";
+        case "phone_number":
+          return "phone_number";
+        case "relation":
+          return "relation";
+        case "formula":
+          return "formula";
+        case "rollup":
+          return "rollup";
+        case "status":
+          return "status";
+        case "unique_id":
+          return "unique_id";
+        case "button":
+          return "button";
+        default:
+          return "rich_text";
+      }
+    }
+    prepareFilterValue(t, e, r) {
+      return e === "is_empty" || e === "is_not_empty"
+        ? true
+        : t === "date" || t === "created_time" || t === "last_edited_time"
+          ? r instanceof Date
+            ? r.toISOString()
+            : r
+          : t === "multi_select" &&
+              (e === "contains" || e === "does_not_contain") &&
+              Array.isArray(r)
+            ? r[0] || ""
+            : r;
+    }
+    sort(t, e = "ascending") {
+      if (!this.isValidSortField(t))
+        throw new Error(
+          `Invalid sort property "${t}". Property not found in database schema. Available fields: ${Object.keys(this.fieldTypes).join(", ")}`,
+        );
+      if (e !== "ascending" && e !== "descending")
+        throw new Error(
+          `Invalid sort direction "${e}". Must be "ascending" or "descending".`,
+        );
+      return (
+        u.log(`Adding sort: ${t} ${e}`),
+        this.sortOptions.push({ property: t, direction: e }),
+        this
+      );
+    }
+    limit(t) {
+      return ((this.pageLimit = t), this);
+    }
+    startAfter(t) {
+      return ((this.startCursor = t), this);
+    }
+    single() {
+      return ((this.singleMode = "required"), (this.pageLimit = 2), this);
+    }
+    maybeSingle() {
+      return ((this.singleMode = "optional"), (this.pageLimit = 1), this);
+    }
+    then(t, e) {
+      return this.execute().then(t, e);
+    }
+    async execute() {
+      let { results: t } = await this.paginate(this.pageLimit);
+      if (this.singleMode === "required") {
+        if (t.length === 0)
+          throw new Error("No records found matching the query");
+        if (t.length > 1)
+          throw new Error("Multiple records found when expecting exactly one");
+        return t[0];
+      }
+      return this.singleMode === "optional" ? (t.length > 0 ? t[0] : null) : t;
+    }
+    async paginate(t = 100) {
+      let e = this.buildFilter();
+      try {
+        u.query(this.databaseId, {
+          database_id: this.databaseId,
+          filter: e || void 0,
+          sorts: this.sortOptions,
+          page_size: t,
+          start_cursor: this.startCursor,
+        });
+        let r = await this.client.databases.query({
+          database_id: this.databaseId,
+          filter: e || void 0,
+          sorts:
+            this.sortOptions && this.sortOptions.length > 0
+              ? this.sortOptions
+              : void 0,
+          page_size: t,
+          start_cursor: this.startCursor,
+        });
+        u.log(`Query returned ${r.results.length} results`);
+        let s = r.results;
+        (u.log("[QueryBuilder] FileManager present:", !!this.fileManager),
+          u.log(
+            "[QueryBuilder] Cache enabled:",
+            this.fileManager?.isCacheEnabled(),
+          ),
+          u.log(`[QueryBuilder] recordType=${this.recordType}`));
+        let o;
+        switch (this.recordType) {
+          case "advanced":
+            o = await Promise.all(s.map(async (a) => B(a, this.fileManager)));
+            break;
+          case "simple":
+            o = await Promise.all(s.map(async (a) => F(a, this.fileManager)));
+            break;
+          case "raw":
+            o = s;
+            break;
+          default:
+            o = s;
+            break;
+        }
+        return { results: o, hasMore: r.has_more, nextCursor: r.next_cursor };
+      } catch (r) {
+        throw (
+          u.error(r, {
+            databaseId: this.databaseId,
+            filter: e,
+            sorts: this.sortOptions,
+            pageSize: t,
+            startCursor: this.startCursor,
+          }),
+          r
+        );
+      }
+    }
+    async all() {
+      let t = [],
+        e = true,
+        r = null;
+      for (; e; ) {
+        r && this.startAfter(r);
+        let s = await this.paginate(100);
+        ((t = [...t, ...s.results]), (e = s.hasMore), (r = s.nextCursor));
+      }
+      return t;
+    }
+    buildFilter() {
+      let t = [];
+      if (
+        (this.filterConditions.forEach((e) => {
+          let { property: r, operator: s, value: o, propertyType: a } = e,
+            i = { property: r };
+          if (!a)
+            throw new Error(
+              `Property type not determined for property: ${String(r)}`,
+            );
+          let c = this.mapToNotionOperator(s);
+          ((i[a] = { [c]: o }), t.push(i));
+        }),
+        t.push(...this.nestedFilters),
+        t.length !== 0)
+      )
+        return t.length === 1 ? t[0] : { [this.logicalOperator]: t };
+    }
+    mapToNotionOperator(t) {
+      switch (t) {
+        case "equals":
+        case "does_not_equal":
+        case "contains":
+        case "does_not_contain":
+        case "starts_with":
+        case "ends_with":
+        case "greater_than":
+        case "less_than":
+        case "greater_than_or_equal_to":
+        case "less_than_or_equal_to":
+        case "before":
+        case "after":
+        case "on_or_before":
+        case "on_or_after":
+        case "is_empty":
+        case "is_not_empty":
+          return t;
+        default:
+          return t;
+      }
+    }
+    getFieldTypeForFilter(t) {
+      return this.fieldTypes[t]?.type;
+    }
+    isValidOperatorForField(t, e) {
+      let r = this.getFieldTypeForFilter(t);
+      return !r || !(r in U) ? false : U[r].includes(e);
+    }
+    isValidSortField(t) {
+      return this.getFieldTypeForFilter(t) !== void 0;
+    }
+  };
+var q = class {
+  constructor(t, e) {
+    this.client = t;
+    this.fileManager = e;
+  }
+  query(t, e, r) {
+    return e
+      ? new b(this.client, t, e, this.fileManager, r?.recordType || "raw")
+      : new b(this.client, t, {}, this.fileManager, r?.recordType || "raw");
+  }
+  async getDatabase(t, e = {}) {
+    try {
+      u.query(t, {
+        database_id: t,
+        filter: e.filter,
+        sorts: e.sorts,
+        page_size: e.pageSize,
+        start_cursor: e.startCursor,
+      });
+      let r = await this.client.databases.query({
+        database_id: t,
+        filter: e.filter,
+        sorts: e.sorts,
+        page_size: e.pageSize,
+        start_cursor: e.startCursor,
+      });
+      u.log(`Query returned ${r.results.length} results`);
+      let s = r.results;
+      return (
+        await Promise.all(s.map((o) => this.enrichRecordFiles(o))),
+        { results: s, nextCursor: r.next_cursor, hasMore: r.has_more }
+      );
+    } catch (r) {
+      throw (u.error(r, { databaseId: t, options: e }), r);
+    }
+  }
+  async getRecord(t) {
+    let e = await this.client.pages.retrieve({ page_id: t });
+    return (await this.enrichRecordFiles(e), e);
+  }
+  async getAllDatabaseRecords(t, e = {}) {
+    let r = [],
+      s = true,
+      o = null;
+    for (; s; ) {
+      let a = await this.getDatabase(t, { ...e, startCursor: o || void 0 });
+      (r.push(...a.results), (s = a.hasMore), (o = a.nextCursor));
+    }
+    return r;
+  }
+  async enrichRecordFiles(t) {
+    (t.cover &&
+      (t.cover = await this.processPageCover(t.cover, `${t.id}-cover`)),
+      t.icon &&
+        t.icon.type === "file" &&
+        (t.icon = await this.processPageIcon(t.icon, `${t.id}-icon`)));
+    let e = Object.entries(t.properties);
+    await Promise.all(
+      e.map(async ([r, s]) => {
+        if (s.type === "files") {
+          let o = s;
+          o.files = await Promise.all(
+            o.files.map((a, i) =>
+              this.processPropertyFile(a, `${t.id}-${r}-${i}`),
+            ),
+          );
+        }
+      }),
+    );
+  }
+  async processPageCover(t, e) {
+    if (t.type === "external") {
+      let r = await this.safeProcessUrl(t.external.url, e);
+      t.external.url = r;
+    } else if (t.type === "file") {
+      let r = await this.safeProcessUrl(t.file.url, e);
+      t.file.url = r;
+    }
+    return t;
+  }
+  async processPageIcon(t, e) {
+    let r = await this.safeProcessUrl(t.file.url, e);
+    return ((t.file.url = r), t);
+  }
+  async processPropertyFile(t, e) {
+    let r = t.name || e,
+      s = this.fileManager.extractFileUrl(t);
+    if (!s) return t;
+    try {
+      let o = await this.fileManager.processFileUrl(s, r);
+      t.type === "external" && t.external
+        ? (t.external.url = o)
+        : t.type === "file" && t.file && (t.file.url = o);
+    } catch (o) {
+      u.error(o, { scope: "file-cache", fileName: r, originalUrl: s });
+    }
+    return t;
+  }
+  async safeProcessUrl(t, e) {
+    try {
+      return await this.fileManager.processFileUrl(t, e);
+    } catch (r) {
+      return (
+        u.error(r, { scope: "file-cache", fallbackName: e, originalUrl: t }),
+        t
+      );
+    }
+  }
+};
+var K = class K {
+  constructor(t, e) {
+    ((this.client = new client.Client({ auth: t , fetch:fetch.bind(globalThis)})),
+      (this.config = E(e)),
+      u.configure(this.config.debug),
+      (this.fileManager = new k(this.config)),
+      (this.pageContentService = new M(this.client, this.fileManager)),
+      (this.databaseService = new q(this.client, this.fileManager)));
+  }
+  query(t, e) {
+    let r = this.databases?.[t];
+    if (!r)
+      throw new Error(
+        `Database "${String(t)}" not found in registry. Make sure you've imported the generated types file.`,
+      );
+    return this._query(r.id, r.fields, { recordType: e?.recordType || "raw" });
+  }
+  _query(t, e, r) {
+    return this.databaseService.query(t, e, r);
+  }
+  async getRecord(t) {
+    return this.databaseService.getRecord(t);
+  }
+  async getPageContent(t, e = {}) {
+    let r = e.recursive ?? true;
+    return this.pageContentService.getPageContent(t, r);
+  }
+};
+K.prototype.databases = {};
+var j = K;
+function pe(n, t) {
+  j.prototype.databases[n] = t;
+}
+function J(n) {
+  return n === "bulleted_list_item" || n === "numbered_list_item";
+}
+function $(n) {
+  let t = [],
+    e = 0;
+  for (; e < n.length; ) {
+    let r = n[e],
+      s = r.type;
+    if (J(s)) {
+      let o = s,
+        a = [];
+      for (; e < n.length && J(n[e].type); ) {
+        let i = n[e];
+        if (i.type !== o) break;
+        (a.push(i), (e += 1));
+      }
+      t.push({ kind: "list_group", listType: o, items: a });
+      continue;
+    }
+    (t.push(r), (e += 1));
+  }
+  return t;
+}
+function X(n) {
+  return n.type;
+}
+function x(n) {
+  let t = X(n);
+  return n[t];
+}
+function Y(n, t) {
+  return t.repeat(Math.max(0, n * 2));
+}
+function me(n) {
+  let t = Math.max(1, Math.floor(n)),
+    e = "";
+  for (; t > 0; )
+    (t--,
+      (e = String.fromCharCode(97 + (t % 26)) + e),
+      (t = Math.floor(t / 26)));
+  return e;
+}
+function ye(n) {
+  let t = Math.max(1, Math.floor(n)),
+    e = [
+      [1e3, "m"],
+      [900, "cm"],
+      [500, "d"],
+      [400, "cd"],
+      [100, "c"],
+      [90, "xc"],
+      [50, "l"],
+      [40, "xl"],
+      [10, "x"],
+      [9, "ix"],
+      [5, "v"],
+      [4, "iv"],
+      [1, "i"],
+    ],
+    r = "";
+  for (let [s, o] of e) for (; t >= s; ) ((r += o), (t -= s));
+  return r;
+}
+function fe(n, t) {
+  let r = (Math.max(1, t) - 1) % 3;
+  return r === 0 ? String(n) : r === 1 ? me(n) : ye(n);
+}
+function I(n, t, e, r) {
+  let s = t.id,
+    o = `[${n}]${e ? ` ${e}` : ""}`;
+  return (
+    (o += ` [id: ${s}]`),
+    `${o}
+`
+  );
+}
+function h(n, t, e, r) {
+  let s = n.children;
+  return !s || !s.length ? "" : L(s, t, e, r);
+}
+function _e(n, t, e, r, s) {
+  let o = Y(e, r.listIndent),
+    a = "";
+  if (t === "bulleted_list_item")
+    for (let i of n) {
+      let c = x(i),
+        d = l(c?.rich_text ?? []);
+      ((a += `${o}- ${d}
+`),
+        (a += h(i, e + 1, r, 0)));
+    }
+  else {
+    let i = 1;
+    for (let c of n) {
+      let d = x(c),
+        y = l(d?.rich_text ?? []),
+        _ = r.alternateOrderedListStyles ? fe(i, s) : String(i);
+      ((a += `${o}${_}. ${y}
+`),
+        (a += h(c, e + 1, r, s)),
+        i++);
+    }
+  }
+  return a;
+}
+function ge(n, t) {
+  let e = x(n),
+    s = (n.children || []).map((c) =>
+      (x(c)?.cells || []).map((_) => {
+        let P = Array.isArray(_) ? _ : [];
+        return l(P);
+      }),
+    ),
+    o = !!e?.has_column_header,
+    a = "";
+  if (s.length === 0) return a;
+  let i = s[0].length;
+  if (o) {
+    ((a += `| ${s[0].join(" | ")} |
+`),
+      (a += `| ${Array.from({ length: i })
+        .map(() => "---")
+        .join(" | ")} |
+`));
+    for (let c = 1; c < s.length; c++)
+      a += `| ${s[c].join(" | ")} |
+`;
+  } else {
+    ((a += `| ${Array.from({ length: i })
+      .map(() => " ")
+      .join(" | ")} |
+`),
+      (a += `| ${Array.from({ length: i })
+        .map(() => "---")
+        .join(" | ")} |
+`));
+    for (let c = 0; c < s.length; c++)
+      a += `| ${s[c].join(" | ")} |
+`;
+  }
+  return a;
+}
+function he(n, t, e) {
+  let r = X(n),
+    s = x(n);
+  if (s === void 0)
+    throw new Error(
+      `blocksToMarkdown expects Raw Notion blocks; missing field for type "${r}"`,
+    );
+  let o = Y(t, e.listIndent);
+  switch (r) {
+    case "paragraph": {
+      let a = l(s?.rich_text ?? []);
+      return a ? `${a}` : "";
+    }
+    case "quote": {
+      let a = l(s?.rich_text ?? []);
+      return a ? `> ${a}` : ">";
+    }
+    case "toggle":
+      return `${l(s?.rich_text ?? [])}${h(n, t + 1, e, 0)}`;
+    case "to_do": {
+      let a = !!s?.checked,
+        i = l(s?.rich_text ?? []);
+      return `${o}- [${a ? "x" : " "}] ${i}${h(n, t + 1, e, 0)}`;
+    }
+    case "heading_1":
+      return `# ${l(s?.rich_text ?? [])}`;
+    case "heading_2":
+      return `## ${l(s?.rich_text ?? [])}`;
+    case "heading_3":
+      return `### ${l(s?.rich_text ?? [])}`;
+    case "code": {
+      let a = s?.language || "",
+        i = m(s?.rich_text ?? []);
+      return `\`\`\`
 ${a}
 ${i}
-\`\`\``}case "bookmark":case "embed":case "link_preview":{let a=s?.url||"",i=l(s?.caption??[]),c=`${a}`;return i&&(c+=`${i}`),c}case "image":case "video":case "audio":case "file":case "pdf":{let a=s?.type==="external"?s?.external?.url:s?.file?.url;return `![${l(s?.caption??[])??""}](${a??""})`}case "equation":return `$$${s?.expression||""}$$`;case "divider":return "---";case "table":return ge(n);case "table_row":return "";case "columns":{s?.children||[];let i="",c=n.children;return c&&c.length&&(i+=L(c,t,e,0)),i}case "column":return h(n,t,e,0);case "synced_block":return h(n,t,e,0);case "child_page":{if(!e.debug)return "";let a=s?.title||"";return I("child_page",n,a)}case "child_database":{if(!e.debug)return "";let a=s?.title||"";return I("child_database",n,a)}case "breadcrumb":return e.debug?I("breadcrumb",n,void 0):"";case "table_of_contents":return e.debug?I("table_of_contents",n,void 0):"";case "template":return h(n,t,e,0);default:return ""}}function L(n,t,e,r){let s="",o=$(n);for(let a of o){if(a.kind==="list_group"){let i=a,c=i.listType==="numbered_list_item"?r+1:0;s+=_e(i.items,i.listType,t,e,c)+`
+\`\`\``;
+    }
+    case "bookmark":
+    case "embed":
+    case "link_preview": {
+      let a = s?.url || "",
+        i = l(s?.caption ?? []),
+        c = `${a}`;
+      return (i && (c += `${i}`), c);
+    }
+    case "image":
+    case "video":
+    case "audio":
+    case "file":
+    case "pdf": {
+      let a = s?.type === "external" ? s?.external?.url : s?.file?.url;
+      return `![${l(s?.caption ?? []) ?? ""}](${a ?? ""})`;
+    }
+    case "equation":
+      return `$$${s?.expression || ""}$$`;
+    case "divider":
+      return "---";
+    case "table":
+      return ge(n);
+    case "table_row":
+      return "";
+    case "columns": {
+      s?.children || [];
+      let i = "",
+        c = n.children;
+      return (c && c.length && (i += L(c, t, e, 0)), i);
+    }
+    case "column":
+      return h(n, t, e, 0);
+    case "synced_block":
+      return h(n, t, e, 0);
+    case "child_page": {
+      if (!e.debug) return "";
+      let a = s?.title || "";
+      return I("child_page", n, a);
+    }
+    case "child_database": {
+      if (!e.debug) return "";
+      let a = s?.title || "";
+      return I("child_database", n, a);
+    }
+    case "breadcrumb":
+      return e.debug ? I("breadcrumb", n, void 0) : "";
+    case "table_of_contents":
+      return e.debug ? I("table_of_contents", n, void 0) : "";
+    case "template":
+      return h(n, t, e, 0);
+    default:
+      return "";
+  }
+}
+function L(n, t, e, r) {
+  let s = "",
+    o = $(n);
+  for (let a of o) {
+    if (a.kind === "list_group") {
+      let i = a,
+        c = i.listType === "numbered_list_item" ? r + 1 : 0;
+      s +=
+        _e(i.items, i.listType, t, e, c) +
+        `
 
-`;continue}s+=he(a,t,e)+`
+`;
+      continue;
+    }
+    s +=
+      he(a, t, e) +
+      `
 
-`;}return s}function be(n=[],t){t=t??{};let e={listIndent:t.listIndent??"  ",debug:t.debug??false,alternateOrderedListStyles:t.alternateOrderedListStyles??false};return !Array.isArray(n)||n.length===0?"":L(n,0,e,0)}function ee(n){return n.type}function w(n){let t=ee(n);return n[t]}function R(n,t,e){let r=n.children;return !r||!r.length?"":te(r,t+1,e)}function xe(n,t,e,r){let s=t==="bulleted_list_item"?"ul":"ol",o=`<${s}>`;for(let a of n){let i=w(a),c=p(i?.rich_text??[],r.classPrefix);o+=`<li>${c}${R(a,e+1,r)}</li>`;}return o+=`</${s}>`,o}function Re(n,t){let e=w(n),r=n.children||[],s=!!e?.has_column_header,o="<table>";if(r.length){if(s){let i=r[0],d=w(i)?.cells||[];o+="<thead><tr>",o+=d.map(y=>`<th>${p(y?.[0]?.rich_text||[],t.classPrefix)}</th>`).join(""),o+="</tr></thead>";}let a=s?1:0;o+="<tbody>";for(let i=a;i<r.length;i++){let c=r[i],y=w(c)?.cells||[];o+="<tr>",o+=y.map(_=>`<td>${p(_?.[0]?.rich_text||[],t.classPrefix)}</td>`).join(""),o+="</tr>";}o+="</tbody>";}return o+="</table>",o}function we(n,t,e){let r=ee(n),s=w(n);switch(r){case "paragraph":return `<p>${p(s?.rich_text??[],e.classPrefix)}</p>`;case "quote":return `<blockquote>${p(s?.rich_text??[],e.classPrefix)}</blockquote>`;case "toggle":return `<details><summary>${p(s?.rich_text??[],e.classPrefix)}</summary>${R(n,t+1,e)}</details>`;case "to_do":{let o=!!s?.checked,a=p(s?.rich_text??[],e.classPrefix);return `<div class="notion-todo"><input type="checkbox" disabled ${o?"checked":""} /> ${a}${R(n,t+1,e)}</div>`}case "heading_1":return `<h1>${p(s?.rich_text??[],e.classPrefix)}</h1>`;case "heading_2":return `<h2>${p(s?.rich_text??[],e.classPrefix)}</h2>`;case "heading_3":return `<h3>${p(s?.rich_text??[],e.classPrefix)}</h3>`;case "code":{let o=s?.language||"",a=m(s?.rich_text??[]),i=C(a);return `<pre><code class="language-${o}">${i}</code></pre>`}case "bookmark":case "embed":case "link_preview":{let o=s?.url||"";return `<a href="${o}">${o}</a>`}case "image":{let o=s?.type==="external"?s?.external?.url:s?.file?.url,a=p(s?.caption??[],e.classPrefix);return `<figure><img src="${o||""}" />${a?`<figcaption>${a}</figcaption>`:""}</figure>`}case "video":case "audio":{let o=s?.type==="external"?s?.external?.url:s?.file?.url,a=r==="video"?"video":"audio",i=p(s?.caption??[],e.classPrefix);return `<figure><${a} src="${o||""}" controls></${a}>${i?`<figcaption>${i}</figcaption>`:""}</figure>`}case "file":case "pdf":{let o=s?.type==="external"?s?.external?.url:s?.file?.url,a=p(s?.caption??[],e.classPrefix);return `<div class="notion-file"><a href="${o||""}">${o||""}</a>${a?`<div class="caption">${a}</div>`:""}</div>`}case "equation":return `<span class="notion-equation">$$${s?.expression||""}$$</span>`;case "divider":return "<hr />";case "table":return Re(n,e);case "table_row":return "";case "columns":{let o=n.children,a='<div class="notion-columns">';return o&&o.length&&(a+=o.map(i=>`<div class="notion-column">${R(i,t+1,e)}</div>`).join("")),a+="</div>",a}case "column":case "synced_block":case "template":return R(n,t,e);case "child_page":return `<div class="notion-child-page">${s?.title||""}</div>`;case "child_database":return `<div class="notion-child-database">${s?.title||""}</div>`;case "breadcrumb":return '<nav class="notion-breadcrumb"></nav>';case "table_of_contents":return '<nav class="notion-toc"></nav>';default:return ""}}function te(n,t,e){let r="",s=$(n);for(let o of s){if(o.kind==="list_group"){let a=o;r+=xe(a.items,a.listType,t,e);continue}r+=we(o,t,e);}return r}function Pe(n=[],t={}){let e={classPrefix:t.classPrefix??""};return !Array.isArray(n)||n.length===0?"":te(n,0,e)}exports.NotionCMS=j;exports.OPERATOR_MAP=U;exports.QueryBuilder=b;exports.blocksToHtml=Pe;exports.blocksToMarkdown=be;exports.convertBlockToSimple=z;exports.convertBlocksToAdvanced=ie;exports.convertBlocksToSimple=O;exports.convertRecord=Z;exports.convertRecordToAdvanced=B;exports.convertRecordToSimple=F;exports.convertRecords=de;exports.registerDatabase=pe;exports.richTextToHtml=p;exports.richTextToMarkdown=l;exports.richTextToPlain=m;
\ No newline at end of file
+`;
+  }
+  return s;
+}
+function be(n = [], t) {
+  t = t ?? {};
+  let e = {
+    listIndent: t.listIndent ?? "  ",
+    debug: t.debug ?? false,
+    alternateOrderedListStyles: t.alternateOrderedListStyles ?? false,
+  };
+  return !Array.isArray(n) || n.length === 0 ? "" : L(n, 0, e, 0);
+}
+function ee(n) {
+  return n.type;
+}
+function w(n) {
+  let t = ee(n);
+  return n[t];
+}
+function R(n, t, e) {
+  let r = n.children;
+  return !r || !r.length ? "" : te(r, t + 1, e);
+}
+function xe(n, t, e, r) {
+  let s = t === "bulleted_list_item" ? "ul" : "ol",
+    o = `<${s}>`;
+  for (let a of n) {
+    let i = w(a),
+      c = p(i?.rich_text ?? [], r.classPrefix);
+    o += `<li>${c}${R(a, e + 1, r)}</li>`;
+  }
+  return ((o += `</${s}>`), o);
+}
+function Re(n, t) {
+  let e = w(n),
+    r = n.children || [],
+    s = !!e?.has_column_header,
+    o = "<table>";
+  if (r.length) {
+    if (s) {
+      let i = r[0],
+        d = w(i)?.cells || [];
+      ((o += "<thead><tr>"),
+        (o += d
+          .map((y) => `<th>${p(y?.[0]?.rich_text || [], t.classPrefix)}</th>`)
+          .join("")),
+        (o += "</tr></thead>"));
+    }
+    let a = s ? 1 : 0;
+    o += "<tbody>";
+    for (let i = a; i < r.length; i++) {
+      let c = r[i],
+        y = w(c)?.cells || [];
+      ((o += "<tr>"),
+        (o += y
+          .map((_) => `<td>${p(_?.[0]?.rich_text || [], t.classPrefix)}</td>`)
+          .join("")),
+        (o += "</tr>"));
+    }
+    o += "</tbody>";
+  }
+  return ((o += "</table>"), o);
+}
+function we(n, t, e) {
+  let r = ee(n),
+    s = w(n);
+  switch (r) {
+    case "paragraph":
+      return `<p>${p(s?.rich_text ?? [], e.classPrefix)}</p>`;
+    case "quote":
+      return `<blockquote>${p(s?.rich_text ?? [], e.classPrefix)}</blockquote>`;
+    case "toggle":
+      return `<details><summary>${p(s?.rich_text ?? [], e.classPrefix)}</summary>${R(n, t + 1, e)}</details>`;
+    case "to_do": {
+      let o = !!s?.checked,
+        a = p(s?.rich_text ?? [], e.classPrefix);
+      return `<div class="notion-todo"><input type="checkbox" disabled ${o ? "checked" : ""} /> ${a}${R(n, t + 1, e)}</div>`;
+    }
+    case "heading_1":
+      return `<h1>${p(s?.rich_text ?? [], e.classPrefix)}</h1>`;
+    case "heading_2":
+      return `<h2>${p(s?.rich_text ?? [], e.classPrefix)}</h2>`;
+    case "heading_3":
+      return `<h3>${p(s?.rich_text ?? [], e.classPrefix)}</h3>`;
+    case "code": {
+      let o = s?.language || "",
+        a = m(s?.rich_text ?? []),
+        i = C(a);
+      return `<pre><code class="language-${o}">${i}</code></pre>`;
+    }
+    case "bookmark":
+    case "embed":
+    case "link_preview": {
+      let o = s?.url || "";
+      return `<a href="${o}">${o}</a>`;
+    }
+    case "image": {
+      let o = s?.type === "external" ? s?.external?.url : s?.file?.url,
+        a = p(s?.caption ?? [], e.classPrefix);
+      return `<figure><img src="${o || ""}" />${a ? `<figcaption>${a}</figcaption>` : ""}</figure>`;
+    }
+    case "video":
+    case "audio": {
+      let o = s?.type === "external" ? s?.external?.url : s?.file?.url,
+        a = r === "video" ? "video" : "audio",
+        i = p(s?.caption ?? [], e.classPrefix);
+      return `<figure><${a} src="${o || ""}" controls></${a}>${i ? `<figcaption>${i}</figcaption>` : ""}</figure>`;
+    }
+    case "file":
+    case "pdf": {
+      let o = s?.type === "external" ? s?.external?.url : s?.file?.url,
+        a = p(s?.caption ?? [], e.classPrefix);
+      return `<div class="notion-file"><a href="${o || ""}">${o || ""}</a>${a ? `<div class="caption">${a}</div>` : ""}</div>`;
+    }
+    case "equation":
+      return `<span class="notion-equation">$$${s?.expression || ""}$$</span>`;
+    case "divider":
+      return "<hr />";
+    case "table":
+      return Re(n, e);
+    case "table_row":
+      return "";
+    case "columns": {
+      let o = n.children,
+        a = '<div class="notion-columns">';
+      return (
+        o &&
+          o.length &&
+          (a += o
+            .map((i) => `<div class="notion-column">${R(i, t + 1, e)}</div>`)
+            .join("")),
+        (a += "</div>"),
+        a
+      );
+    }
+    case "column":
+    case "synced_block":
+    case "template":
+      return R(n, t, e);
+    case "child_page":
+      return `<div class="notion-child-page">${s?.title || ""}</div>`;
+    case "child_database":
+      return `<div class="notion-child-database">${s?.title || ""}</div>`;
+    case "breadcrumb":
+      return '<nav class="notion-breadcrumb"></nav>';
+    case "table_of_contents":
+      return '<nav class="notion-toc"></nav>';
+    default:
+      return "";
+  }
+}
+function te(n, t, e) {
+  let r = "",
+    s = $(n);
+  for (let o of s) {
+    if (o.kind === "list_group") {
+      let a = o;
+      r += xe(a.items, a.listType, t, e);
+      continue;
+    }
+    r += we(o, t, e);
+  }
+  return r;
+}
+function Pe(n = [], t = {}) {
+  let e = { classPrefix: t.classPrefix ?? "" };
+  return !Array.isArray(n) || n.length === 0 ? "" : te(n, 0, e);
+}
+exports.NotionCMS = j;
+exports.OPERATOR_MAP = U;
+exports.QueryBuilder = b;
+exports.blocksToHtml = Pe;
+exports.blocksToMarkdown = be;
+exports.convertBlockToSimple = z;
+exports.convertBlocksToAdvanced = ie;
+exports.convertBlocksToSimple = O;
+exports.convertRecord = Z;
+exports.convertRecordToAdvanced = B;
+exports.convertRecordToSimple = F;
+exports.convertRecords = de;
+exports.registerDatabase = pe;
+exports.richTextToHtml = p;
+exports.richTextToMarkdown = l;
+exports.richTextToPlain = m;
diff --git a/dist/index.mjs b/dist/index.mjs
index 2736c82601b5dea4c0b5b313c1c5ea1b4e04646f..80dd8c364d034b7fbbea27359e720d79026a7e60 100644
--- a/dist/index.mjs
+++ b/dist/index.mjs
@@ -1,18 +1,1848 @@
-import {Client}from'@notionhq/client';var re="./public/assets/notion-files",f={files:{strategy:"direct",storage:{path:re,endpoint:"",bucket:"",accessKey:"",secretKey:"",region:""}},debug:{enabled:false,level:"info"}};function E(n){return n?{files:{strategy:n.files?.strategy??f.files.strategy,storage:{path:n.files?.storage?.path??f.files.storage.path,endpoint:n.files?.storage?.endpoint??f.files.storage.endpoint,bucket:n.files?.storage?.bucket??f.files.storage.bucket,accessKey:n.files?.storage?.accessKey??f.files.storage.accessKey,secretKey:n.files?.storage?.secretKey??f.files.storage.secretKey,region:n.files?.storage?.region??f.files.storage.region}},debug:{enabled:n.debug?.enabled??f.debug.enabled,level:n.debug?.level??f.debug.level}}:f}var S=class{async processFileUrl(t,e){return t}},v=class{constructor(t){this.config=t;}async processFileUrl(t,e){try{let r=N(t),s=Q(e),o=`${r}${s}`,a=await this.createStorage();if(await a.exists(o))return a.getPublicUrl(o);let{downloadFile:i}=await import('./file-utils-MJXNBR7K.mjs'),c=await i(t);return await a.store(o,c),a.getPublicUrl(o)}catch(r){return console.warn(`Failed to cache file locally: ${e} from ${t}`,{fileName:e,url:t,error:r instanceof Error?r.message:String(r)}),t}}async createStorage(){let{LocalStorage:t}=await import('./s3-storage-33JGBQZG.mjs'),e=this.config?.storage?.path||"./public/assets/notion-files";return new t(e)}},T=class{constructor(t){this.config=t;}async processFileUrl(t,e){if(!this.config?.storage)return t;try{let r=N(t),s=Q(e),o=this.config.storage.path||"",a=o?`${o}${r}${s}`:`${r}${s}`,i=await this.createStorage();if(await i.exists(a))return i.getPublicUrl(a);let{downloadFile:c}=await import('./file-utils-MJXNBR7K.mjs'),d=await c(t);return await i.store(a,d),i.getPublicUrl(a)}catch(r){return console.warn(`Failed to store file remotely: ${e} from ${t}`,{fileName:e,url:t,error:r instanceof Error?r.message:String(r)}),t}}async createStorage(){if(!this.config?.storage)throw new Error("S3 storage configuration is required for remote strategy");let{S3Storage:t}=await import('./s3-storage-33JGBQZG.mjs');return new t({endpoint:this.config.storage.endpoint,bucket:this.config.storage.bucket||"default-bucket",accessKey:this.config.storage.accessKey,secretKey:this.config.storage.secretKey,region:this.config.storage.region})}},k=class{constructor(t){let e=t.files;switch(e?.strategy){case "local":this.strategy=new v(e);break;case "remote":this.strategy=new T(e);break;case "direct":default:this.strategy=new S;break}}isCacheEnabled(){return this.strategy instanceof v||this.strategy instanceof T}async processFileUrl(t,e){return this.strategy.processFileUrl(t,e)}async processFileInfoArray(t){return Promise.all(t.map(async e=>{let r=await this.processFileUrl(e.url,e.name);return {...e,url:r}}))}extractFileUrl(t){return t.type==="external"?t.external.url:t.type==="file"?t.file.url:""}createFileInfo(t){return {name:t.name,url:this.extractFileUrl(t),type:t.type,...t.type==="file"&&{expiry_time:t.file.expiry_time}}}};function N(n){let t=n.match(/([a-f0-9-]{36})/g);if(t&&t.length>=2)return t[1].replace(/-/g,"");if(t&&t.length===1)return t[0].replace(/-/g,"");let e=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);e=(e<<5)-e+s,e=e&e;}return Math.abs(e).toString(16)}function Q(n){let t=n.match(/\.([a-zA-Z0-9]+)(?:\?|$)/);return t?`.${t[1]}`:""}function ne(n,t){let e=n;return t.code&&(e=`\`${e}\``),t.bold&&(e=`**${e}**`),t.italic&&(e=`*${e}*`),t.strikethrough&&(e=`~~${e}~~`),e}function m(n=[]){return Array.isArray(n)?n.map(t=>t.plain_text||"").join(""):""}function l(n=[]){return Array.isArray(n)?n.map(t=>{let e=t.plain_text||"",r=ne(e,t.annotations),s=t.href;return s?`[${r}](${s})`:r}).join(""):""}function C(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function p(n=[],t=""){if(!Array.isArray(n))return "";let e=t||"";return n.map(r=>{let s=C(r.plain_text||""),{bold:o,italic:a,strikethrough:i,code:c,color:d}=r.annotations;c&&(s=`<code>${s}</code>`),o&&(s=`<strong>${s}</strong>`),a&&(s=`<em>${s}</em>`),i&&(s=`<s>${s}</s>`);let y=[];if(d&&d!=="default")if(d.endsWith("_background")){let P=d.replace("_background","");y.push(`${e}bg-${P}`);}else y.push(`${e}color-${d}`);y.length&&(s=`<span class="${y.join(" ")}">${s}</span>`);let _=r.href;return _?`<a href="${C(_)}">${s}</a>`:s}).join("")}function V(n){return n.type}function se(n){return n[V(n)]}async function ae(n,t,e){if(e.mediaUrlResolver){let r=await e.mediaUrlResolver(n,t);if(r)return r}return t?t?.type==="external"?t?.external?.url??"":t?.file?.url??"":""}async function oe(n,t){let e=V(n),r=se(n),s=n.children||[],o=await A(s,t);switch(e){case "paragraph":case "quote":{let a=m(r?.rich_text??[]),i=l(r?.rich_text??[]);return {id:n.id,type:e,text:a,text_md:i,children:o.length?o:void 0}}case "heading_1":case "heading_2":case "heading_3":{let a=m(r?.rich_text??[]),i=l(r?.rich_text??[]);return {id:n.id,type:e,text:a,text_md:i}}case "bulleted_list_item":case "numbered_list_item":case "toggle":{let a=m(r?.rich_text??[]),i=l(r?.rich_text??[]);return {id:n.id,type:e,text:a,text_md:i,children:o.length?o:void 0}}case "to_do":{let a=m(r?.rich_text??[]),i=l(r?.rich_text??[]),c=!!r?.checked;return {id:n.id,type:e,checked:c,text:a,text_md:i,children:o.length?o:void 0}}case "code":{let a=r?.language||"",i=m(r?.rich_text??[]),c=l(r?.rich_text??[]);return {id:n.id,type:e,language:a,text:i,text_md:c}}case "bookmark":case "embed":case "link_preview":{let a=r?.url||"",i=m(r?.caption??[])||void 0,c=l(r?.caption??[])||void 0;return {id:n.id,type:e,url:a,caption_text:i,caption_md:c}}case "image":case "video":case "audio":case "file":case "pdf":{let a=await ae(n,r,t),i=m(r?.caption??[])||void 0,c=l(r?.caption??[])||void 0,d=r?.file?.expiry_time||void 0;return {id:n.id,type:e,url:a,caption_text:i,caption_md:c,expiry_time:d}}case "equation":{let a=r?.expression||"";return {id:n.id,type:e,expression:a}}case "divider":return {id:n.id,type:e};case "table":{let a=!!r?.has_column_header,i=!!r?.has_row_header,d=(await A(s,t)).filter(y=>y.type==="table_row");return {id:n.id,type:e,hasColumnHeader:a,hasRowHeader:i,rows:d}}case "table_row":{let a=r?.cells?.map(i=>{let c=Array.isArray(i)?i:[];return {text:m(c),text_md:l(c)}})??[];return {id:n.id,type:e,cells:a}}case "columns":{let i=(o.length?o:[]).filter(c=>c.type==="column").map(c=>({type:"column",children:c.children||[]}));return {id:n.id,type:"columns",children:i}}case "column":return {id:n.id,type:e,children:o.length?o:[]};case "synced_block":{let a=r?.synced_from?.block_id||void 0;return {id:n.id,type:e,originalBlockId:a,children:o.length?o:void 0}}case "child_page":{let a=r?.title||void 0;return {id:n.id,type:e,title:a,pageId:n.id}}case "child_database":{let a=r?.title||void 0;return {id:n.id,type:e,title:a,databaseId:n.id}}case "breadcrumb":case "table_of_contents":case "template":return {id:n.id,type:e,children:o.length?o:void 0};default:return null}}async function A(n,t){let e=[];for(let r of n){let s=await oe(r,t);s&&e.push(s);}return e}async function H(n=[],t={}){let e={mediaUrlResolver:t.mediaUrlResolver};return A(n,e)}async function z(n,t={}){let e=ce(n),r=n.children||[],s=r.length?await O(r,t):void 0;return {id:n.id,type:n.type,content:e,hasChildren:!!n.has_children,...s&&s.length?{children:s}:{}}}async function O(n=[],t={}){return Promise.all(n.map(e=>z(e,t)))}async function ie(n=[],t={}){let e=t.mediaUrlResolver||(async(r,s)=>{if(!s)return "";let o=s?.type==="external"?s?.external?.url:s?.file?.url;if(!t.fileManager||!o)return o||"";try{return await t.fileManager.processFileUrl(o,`content-block-${r.id}`)}catch{return o||""}});return H(n,{mediaUrlResolver:e})}function ce(n){let t=n.type,e=n[t];switch(t){case "paragraph":case "heading_1":case "heading_2":case "heading_3":case "bulleted_list_item":case "numbered_list_item":case "toggle":case "quote":return {text:g(e?.rich_text),richText:e?.rich_text};case "code":return {text:g(e?.rich_text),language:e?.language};case "image":case "file":case "pdf":case "video":case "audio":{let r=le(e);return {caption:e?.caption?g(e.caption):"",url:r}}case "bookmark":case "embed":case "link_preview":return {url:e?.url||"",caption:e?.caption?g(e.caption):""};case "divider":case "equation":case "table_of_contents":return e||{};case "to_do":return {text:g(e?.rich_text),checked:!!e?.checked};case "callout":return {text:g(e?.rich_text),icon:e?.icon};case "table":return {tableWidth:e?.table_width,hasColumnHeader:e?.has_column_header,hasRowHeader:e?.has_row_header};case "table_row":return {cells:(e?.cells||[]).map(r=>({plainText:g(r),richText:r}))};default:return e||{}}}function le(n){return n&&(n?.type==="external"?n?.external?.url:n?.file?.url)||""}function g(n=[]){return Array.isArray(n)?n.map(t=>t?.plain_text||"").join(""):""}var M=class{constructor(t,e){this.client=t;this.fileManager=e;}async getPageContent(t,e=true){let r=await this.getBlocks(t);if(e)for(let s of r)s.has_children&&(s.children=await this.getPageContent(s.id,true));return r}async getBlocks(t){let e=[],r=true,s;for(;r;){let o=await this.client.blocks.children.list({block_id:t,start_cursor:s}),i=o.results;await Promise.all(i.map(c=>this.enrichBlockFiles(c))),e=[...e,...i],r=o.has_more,s=o.next_cursor||void 0;}return e}async convertBlocksToSimple(t){return O(t,{fileManager:this.fileManager})}async enrichBlockFiles(t){let e=t.type,r=t[e];if(!r)return;let s=async(a,i)=>{if(!a)return a;try{return await this.fileManager.processFileUrl(a,i||`${t.id}-${e}`)}catch{return a}},o=async(a,i)=>{a&&(a.type==="external"&&a.external?.url&&(a.external.url=await s(a.external.url,i)||a.external.url),a.type==="file"&&a.file?.url&&(a.file.url=await s(a.file.url,i)||a.file.url));};switch(e){case "image":case "video":case "audio":case "file":case "pdf":{await o(r,r?.name);break}case "embed":case "bookmark":case "link_preview":{r.url&&(r.url=await s(r.url,r?.url)||r.url);break}case "callout":{r.icon&&r.icon.type==="file"&&await o(r.icon,`${t.id}-icon`);break}}}};var D=class{constructor(){this.config={enabled:false,level:"info"};}configure(t){this.config={...this.config,...t};}normalizeLevel(t){return t&&["error","warn","info","debug"].includes(t)?t:"info"}shouldLog(t){if(!this.config.enabled)return  false;let e=["error","warn","info","debug"],r=e.indexOf(this.normalizeLevel(this.config.level));return e.indexOf(t)<=r}log(...t){this.shouldLog("info")&&console.log("[NotionCMS Debug]:",...t);}query(t,e){this.shouldLog("debug")&&console.log(`
-[NotionCMS Query]:`,{databaseId:t,filter:e.filter,sorts:e.sorts,pageSize:e.page_size,startCursor:e.start_cursor,timestamp:new Date().toISOString()});}error(t,e){this.shouldLog("error")&&console.error("[NotionCMS Error]:",{message:t.message,code:t.code,context:e,timestamp:new Date().toISOString()});}},u=new D;async function G(n,t){switch(n.type){case "unique_id":return n.unique_id.number;case "title":return n.title?.[0]?.plain_text??"";case "rich_text":return n.rich_text?.[0]?.plain_text??"";case "number":return n.number;case "select":return n.select?.name??null;case "multi_select":return n.multi_select.map(e=>e.name);case "date":{let e=n;return e.date?new Date(e.date.start):null}case "people":{let e=n;return Array.isArray(e.people)?e.people.map(r=>r.name||""):[]}case "files":{let r=n.files.map(s=>s.type==="external"?{name:s.name,url:s.external.url}:s.type==="file"?{name:s.name,url:s.file.url}:{name:s.name,url:""});return t?Promise.all(r.map(async s=>{let o=await t.processFileUrl(s.url,s.name);return {...s,url:o}})):r}case "checkbox":return n.checkbox;case "url":return n.url;case "email":return n.email;case "phone_number":return n.phone_number;case "formula":return n.formula;case "relation":{let e=n;return Array.isArray(e.relation)?e.relation.map(r=>r.id):[]}case "rollup":return n.rollup;case "created_time":return n.created_time;case "created_by":{let e=n.created_by;return {id:e.id,name:e.name,avatar_url:e.avatar_url}}case "last_edited_time":return n.last_edited_time;case "last_edited_by":{let e=n.last_edited_by;return {id:e.id,name:e.name,avatar_url:e.avatar_url}}default:return null}}async function W(n,t){switch(n.type){case "title":{let e=n;return Array.isArray(e.title)?e.title.map(r=>({content:r.plain_text,annotations:r.annotations,href:r.href,...r.type==="text"&&{link:r.text.link}})):[]}case "rich_text":{let e=n;return Array.isArray(e.rich_text)?e.rich_text.map(r=>({content:r.plain_text,annotations:r.annotations,href:r.href,...r.type==="text"&&{link:r.text.link}})):[]}case "number":return n.number;case "select":{let e=n.select;return e?{id:e.id,name:e.name,color:e.color}:null}case "multi_select":return n.multi_select.map(r=>({id:r.id,name:r.name,color:r.color}));case "date":{let e=n;return e.date?{start:e.date.start,end:e.date.end,time_zone:e.date.time_zone,parsedStart:e.date.start?new Date(e.date.start):null,parsedEnd:e.date.end?new Date(e.date.end):null}:null}case "people":{let e=n;return Array.isArray(e.people)?e.people.map(r=>({id:r.id,name:r.name,avatar_url:r.avatar_url,object:r.object,type:r.type,...r.type==="person"&&r.person&&{email:r.person.email}})):[]}case "files":{let r=n.files.map(s=>s.type==="external"?{name:s.name,type:s.type,external:{url:s.external.url}}:s.type==="file"?{name:s.name,type:s.type,file:{url:s.file.url,expiry_time:s.file.expiry_time}}:{name:s.name,type:s.type});return t?Promise.all(r.map(async s=>{let o=s.type==="external"?s.external?.url:s.file?.url;if(o){let a=await t.processFileUrl(o,s.name);s.type==="external"&&s.external?s.external.url=a:s.type==="file"&&s.file&&(s.file.url=a);}return s})):r}case "checkbox":return n.checkbox;case "url":return n.url;case "email":return n.email;case "phone_number":return n.phone_number;case "formula":{let e=n.formula;return {type:e.type,value:e.type==="string"?e.string:e.type==="number"?e.number:e.type==="boolean"?e.boolean:e.type==="date"?e.date:null}}case "relation":{let e=n;return Array.isArray(e.relation)?e.relation.map(r=>({id:r.id})):[]}case "rollup":{let e=n.rollup;return {type:e.type,function:e.function,...e.type==="array"&&{array:e.array},...e.type==="number"&&{number:e.number},...e.type==="date"&&{date:e.date}}}case "created_time":return {timestamp:n.created_time,date:new Date(n.created_time)};case "created_by":{let e=n.created_by;return {id:e.id,name:e.name,avatar_url:e.avatar_url,object:e.object,type:e.type,...e.type==="person"&&e.person&&{email:e.person.email}}}case "last_edited_time":return {timestamp:n.last_edited_time,date:new Date(n.last_edited_time)};case "last_edited_by":{let e=n.last_edited_by;return {id:e.id,name:e.name,avatar_url:e.avatar_url,object:e.object,type:e.type,...e.type==="person"&&e.person&&{email:e.person.email}}}case "status":{let e=n.status;return e?{id:e.id,name:e.name,color:e.color}:null}case "unique_id":{let e=n.unique_id;return e?{prefix:e.prefix,number:e.number}:null}default:return null}}async function Z(n,t,e={}){switch(t){case "simple":return F(n,e.fileManager);case "advanced":return B(n,e.fileManager);default:return n}}async function F(n,t){let e={id:n.id};return await Promise.all(Object.entries(n.properties).map(async([r,s])=>{e[r]=await G(s,t);})),e}async function B(n,t){let e={id:n.id};return await Promise.all(Object.entries(n.properties).map(async([r,s])=>{e[r]=await W(s,t);})),e}async function de(n,t,e={}){return Promise.all(n.map(r=>Z(r,t,e)))}var U={title:["equals","does_not_equal","contains","does_not_contain","starts_with","ends_with","is_empty","is_not_empty"],rich_text:["equals","does_not_equal","contains","does_not_contain","starts_with","ends_with","is_empty","is_not_empty"],url:["equals","does_not_equal","contains","does_not_contain","starts_with","ends_with","is_empty","is_not_empty"],email:["equals","does_not_equal","contains","does_not_contain","starts_with","ends_with","is_empty","is_not_empty"],phone_number:["equals","does_not_equal","contains","does_not_contain","starts_with","ends_with","is_empty","is_not_empty"],number:["equals","does_not_equal","greater_than","less_than","greater_than_or_equal_to","less_than_or_equal_to","is_empty","is_not_empty"],select:["equals","does_not_equal","is_empty","is_not_empty"],multi_select:["contains","does_not_contain","is_empty","is_not_empty"],status:["equals","does_not_equal","is_empty","is_not_empty"],date:["equals","before","after","on_or_before","on_or_after","is_empty","is_not_empty"],created_time:["equals","before","after","on_or_before","on_or_after"],last_edited_time:["equals","before","after","on_or_before","on_or_after"],checkbox:["equals"],people:["contains","does_not_contain","is_empty","is_not_empty"],relation:["contains","does_not_contain","is_empty","is_not_empty"],created_by:["contains","does_not_contain"],last_edited_by:["contains","does_not_contain"],files:["is_empty","is_not_empty"],formula:["equals","does_not_equal","contains","does_not_contain","greater_than","less_than","greater_than_or_equal_to","less_than_or_equal_to","is_empty","is_not_empty"],rollup:["equals","does_not_equal","contains","does_not_contain","greater_than","less_than","greater_than_or_equal_to","less_than_or_equal_to","is_empty","is_not_empty"],unique_id:["equals","does_not_equal","greater_than","less_than","greater_than_or_equal_to","less_than_or_equal_to"],verification:["equals","before","after","on_or_before","on_or_after"],unknown:["equals","does_not_equal","is_empty","is_not_empty"]},b=class{constructor(t,e,r={},s,o="raw"){this.filterConditions=[];this.logicalOperator="and";this.nestedFilters=[];this.sortOptions=[];this.pageLimit=100;this.singleMode=null;this.recordType="raw";this.client=t,this.databaseId=e,this.fieldTypes=r,this.fileManager=s,this.recordType=o;}filter(t,e,r){if(!this.isValidOperatorForField(t,e))throw new Error(`Invalid operator "${e}" for field "${t}" of type "${this.getFieldTypeForFilter(t)}"`);let s=this.getFieldTypeForFilter(t),o=this.mapFieldTypeToNotionProperty(s);return this.filterConditions.push({property:t,operator:e,value:this.prepareFilterValue(s,e,r),propertyType:o}),this}mapFieldTypeToNotionProperty(t){if(!t)return "rich_text";switch(t){case "title":return "title";case "rich_text":return "rich_text";case "number":return "number";case "select":return "select";case "multi_select":return "multi_select";case "date":case "created_time":case "last_edited_time":return "date";case "checkbox":return "checkbox";case "people":case "created_by":case "last_edited_by":return "people";case "files":return "files";case "url":return "url";case "email":return "email";case "phone_number":return "phone_number";case "relation":return "relation";case "formula":return "formula";case "rollup":return "rollup";case "status":return "status";case "unique_id":return "unique_id";case "button":return "button";default:return "rich_text"}}prepareFilterValue(t,e,r){return e==="is_empty"||e==="is_not_empty"?true:t==="date"||t==="created_time"||t==="last_edited_time"?r instanceof Date?r.toISOString():r:t==="multi_select"&&(e==="contains"||e==="does_not_contain")&&Array.isArray(r)?r[0]||"":r}sort(t,e="ascending"){if(!this.isValidSortField(t))throw new Error(`Invalid sort property "${t}". Property not found in database schema. Available fields: ${Object.keys(this.fieldTypes).join(", ")}`);if(e!=="ascending"&&e!=="descending")throw new Error(`Invalid sort direction "${e}". Must be "ascending" or "descending".`);return u.log(`Adding sort: ${t} ${e}`),this.sortOptions.push({property:t,direction:e}),this}limit(t){return this.pageLimit=t,this}startAfter(t){return this.startCursor=t,this}single(){return this.singleMode="required",this.pageLimit=2,this}maybeSingle(){return this.singleMode="optional",this.pageLimit=1,this}then(t,e){return this.execute().then(t,e)}async execute(){let{results:t}=await this.paginate(this.pageLimit);if(this.singleMode==="required"){if(t.length===0)throw new Error("No records found matching the query");if(t.length>1)throw new Error("Multiple records found when expecting exactly one");return t[0]}return this.singleMode==="optional"?t.length>0?t[0]:null:t}async paginate(t=100){let e=this.buildFilter();try{u.query(this.databaseId,{database_id:this.databaseId,filter:e||void 0,sorts:this.sortOptions,page_size:t,start_cursor:this.startCursor});let r=await this.client.databases.query({database_id:this.databaseId,filter:e||void 0,sorts:this.sortOptions&&this.sortOptions.length>0?this.sortOptions:void 0,page_size:t,start_cursor:this.startCursor});u.log(`Query returned ${r.results.length} results`);let s=r.results;u.log("[QueryBuilder] FileManager present:",!!this.fileManager),u.log("[QueryBuilder] Cache enabled:",this.fileManager?.isCacheEnabled()),u.log(`[QueryBuilder] recordType=${this.recordType}`);let o;switch(this.recordType){case "advanced":o=await Promise.all(s.map(async a=>B(a,this.fileManager)));break;case "simple":o=await Promise.all(s.map(async a=>F(a,this.fileManager)));break;case "raw":o=s;break;default:o=s;break}return {results:o,hasMore:r.has_more,nextCursor:r.next_cursor}}catch(r){throw u.error(r,{databaseId:this.databaseId,filter:e,sorts:this.sortOptions,pageSize:t,startCursor:this.startCursor}),r}}async all(){let t=[],e=true,r=null;for(;e;){r&&this.startAfter(r);let s=await this.paginate(100);t=[...t,...s.results],e=s.hasMore,r=s.nextCursor;}return t}buildFilter(){let t=[];if(this.filterConditions.forEach(e=>{let{property:r,operator:s,value:o,propertyType:a}=e,i={property:r};if(!a)throw new Error(`Property type not determined for property: ${String(r)}`);let c=this.mapToNotionOperator(s);i[a]={[c]:o},t.push(i);}),t.push(...this.nestedFilters),t.length!==0)return t.length===1?t[0]:{[this.logicalOperator]:t}}mapToNotionOperator(t){switch(t){case "equals":case "does_not_equal":case "contains":case "does_not_contain":case "starts_with":case "ends_with":case "greater_than":case "less_than":case "greater_than_or_equal_to":case "less_than_or_equal_to":case "before":case "after":case "on_or_before":case "on_or_after":case "is_empty":case "is_not_empty":return t;default:return t}}getFieldTypeForFilter(t){return this.fieldTypes[t]?.type}isValidOperatorForField(t,e){let r=this.getFieldTypeForFilter(t);return !r||!(r in U)?false:U[r].includes(e)}isValidSortField(t){return this.getFieldTypeForFilter(t)!==void 0}};var q=class{constructor(t,e){this.client=t;this.fileManager=e;}query(t,e,r){return e?new b(this.client,t,e,this.fileManager,r?.recordType||"raw"):new b(this.client,t,{},this.fileManager,r?.recordType||"raw")}async getDatabase(t,e={}){try{u.query(t,{database_id:t,filter:e.filter,sorts:e.sorts,page_size:e.pageSize,start_cursor:e.startCursor});let r=await this.client.databases.query({database_id:t,filter:e.filter,sorts:e.sorts,page_size:e.pageSize,start_cursor:e.startCursor});u.log(`Query returned ${r.results.length} results`);let s=r.results;return await Promise.all(s.map(o=>this.enrichRecordFiles(o))),{results:s,nextCursor:r.next_cursor,hasMore:r.has_more}}catch(r){throw u.error(r,{databaseId:t,options:e}),r}}async getRecord(t){let e=await this.client.pages.retrieve({page_id:t});return await this.enrichRecordFiles(e),e}async getAllDatabaseRecords(t,e={}){let r=[],s=true,o=null;for(;s;){let a=await this.getDatabase(t,{...e,startCursor:o||void 0});r.push(...a.results),s=a.hasMore,o=a.nextCursor;}return r}async enrichRecordFiles(t){t.cover&&(t.cover=await this.processPageCover(t.cover,`${t.id}-cover`)),t.icon&&t.icon.type==="file"&&(t.icon=await this.processPageIcon(t.icon,`${t.id}-icon`));let e=Object.entries(t.properties);await Promise.all(e.map(async([r,s])=>{if(s.type==="files"){let o=s;o.files=await Promise.all(o.files.map((a,i)=>this.processPropertyFile(a,`${t.id}-${r}-${i}`)));}}));}async processPageCover(t,e){if(t.type==="external"){let r=await this.safeProcessUrl(t.external.url,e);t.external.url=r;}else if(t.type==="file"){let r=await this.safeProcessUrl(t.file.url,e);t.file.url=r;}return t}async processPageIcon(t,e){let r=await this.safeProcessUrl(t.file.url,e);return t.file.url=r,t}async processPropertyFile(t,e){let r=t.name||e,s=this.fileManager.extractFileUrl(t);if(!s)return t;try{let o=await this.fileManager.processFileUrl(s,r);t.type==="external"&&t.external?t.external.url=o:t.type==="file"&&t.file&&(t.file.url=o);}catch(o){u.error(o,{scope:"file-cache",fileName:r,originalUrl:s});}return t}async safeProcessUrl(t,e){try{return await this.fileManager.processFileUrl(t,e)}catch(r){return u.error(r,{scope:"file-cache",fallbackName:e,originalUrl:t}),t}}};var K=class K{constructor(t,e){this.client=new Client({auth:t}),this.config=E(e),u.configure(this.config.debug),this.fileManager=new k(this.config),this.pageContentService=new M(this.client,this.fileManager),this.databaseService=new q(this.client,this.fileManager);}query(t,e){let r=this.databases?.[t];if(!r)throw new Error(`Database "${String(t)}" not found in registry. Make sure you've imported the generated types file.`);return this._query(r.id,r.fields,{recordType:e?.recordType||"raw"})}_query(t,e,r){return this.databaseService.query(t,e,r)}async getRecord(t){return this.databaseService.getRecord(t)}async getPageContent(t,e={}){let r=e.recursive??true;return this.pageContentService.getPageContent(t,r)}};K.prototype.databases={};var j=K;function pe(n,t){j.prototype.databases[n]=t;}function J(n){return n==="bulleted_list_item"||n==="numbered_list_item"}function $(n){let t=[],e=0;for(;e<n.length;){let r=n[e],s=r.type;if(J(s)){let o=s,a=[];for(;e<n.length&&J(n[e].type);){let i=n[e];if(i.type!==o)break;a.push(i),e+=1;}t.push({kind:"list_group",listType:o,items:a});continue}t.push(r),e+=1;}return t}function X(n){return n.type}function x(n){let t=X(n);return n[t]}function Y(n,t){return t.repeat(Math.max(0,n*2))}function me(n){let t=Math.max(1,Math.floor(n)),e="";for(;t>0;)t--,e=String.fromCharCode(97+t%26)+e,t=Math.floor(t/26);return e}function ye(n){let t=Math.max(1,Math.floor(n)),e=[[1e3,"m"],[900,"cm"],[500,"d"],[400,"cd"],[100,"c"],[90,"xc"],[50,"l"],[40,"xl"],[10,"x"],[9,"ix"],[5,"v"],[4,"iv"],[1,"i"]],r="";for(let[s,o]of e)for(;t>=s;)r+=o,t-=s;return r}function fe(n,t){let r=(Math.max(1,t)-1)%3;return r===0?String(n):r===1?me(n):ye(n)}function I(n,t,e,r){let s=t.id,o=`[${n}]${e?` ${e}`:""}`;return o+=` [id: ${s}]`,`${o}
-`}function h(n,t,e,r){let s=n.children;return !s||!s.length?"":L(s,t,e,r)}function _e(n,t,e,r,s){let o=Y(e,r.listIndent),a="";if(t==="bulleted_list_item")for(let i of n){let c=x(i),d=l(c?.rich_text??[]);a+=`${o}- ${d}
-`,a+=h(i,e+1,r,0);}else {let i=1;for(let c of n){let d=x(c),y=l(d?.rich_text??[]),_=r.alternateOrderedListStyles?fe(i,s):String(i);a+=`${o}${_}. ${y}
-`,a+=h(c,e+1,r,s),i++;}}return a}function ge(n,t){let e=x(n),s=(n.children||[]).map(c=>(x(c)?.cells||[]).map(_=>{let P=Array.isArray(_)?_:[];return l(P)})),o=!!e?.has_column_header,a="";if(s.length===0)return a;let i=s[0].length;if(o){a+=`| ${s[0].join(" | ")} |
-`,a+=`| ${Array.from({length:i}).map(()=>"---").join(" | ")} |
-`;for(let c=1;c<s.length;c++)a+=`| ${s[c].join(" | ")} |
-`;}else {a+=`| ${Array.from({length:i}).map(()=>" ").join(" | ")} |
-`,a+=`| ${Array.from({length:i}).map(()=>"---").join(" | ")} |
-`;for(let c=0;c<s.length;c++)a+=`| ${s[c].join(" | ")} |
-`;}return a}function he(n,t,e){let r=X(n),s=x(n);if(s===void 0)throw new Error(`blocksToMarkdown expects Raw Notion blocks; missing field for type "${r}"`);let o=Y(t,e.listIndent);switch(r){case "paragraph":{let a=l(s?.rich_text??[]);return a?`${a}`:""}case "quote":{let a=l(s?.rich_text??[]);return a?`> ${a}`:">"}case "toggle":return `${l(s?.rich_text??[])}${h(n,t+1,e,0)}`;case "to_do":{let a=!!s?.checked,i=l(s?.rich_text??[]);return `${o}- [${a?"x":" "}] ${i}${h(n,t+1,e,0)}`}case "heading_1":return `# ${l(s?.rich_text??[])}`;case "heading_2":return `## ${l(s?.rich_text??[])}`;case "heading_3":return `### ${l(s?.rich_text??[])}`;case "code":{let a=s?.language||"",i=m(s?.rich_text??[]);return `\`\`\`
+import { Client } from "@notionhq/client";
+var re = "./public/assets/notion-files",
+  f = {
+    files: {
+      strategy: "direct",
+      storage: {
+        path: re,
+        endpoint: "",
+        bucket: "",
+        accessKey: "",
+        secretKey: "",
+        region: "",
+      },
+    },
+    debug: { enabled: false, level: "info" },
+  };
+function E(n) {
+  return n
+    ? {
+        files: {
+          strategy: n.files?.strategy ?? f.files.strategy,
+          storage: {
+            path: n.files?.storage?.path ?? f.files.storage.path,
+            endpoint: n.files?.storage?.endpoint ?? f.files.storage.endpoint,
+            bucket: n.files?.storage?.bucket ?? f.files.storage.bucket,
+            accessKey: n.files?.storage?.accessKey ?? f.files.storage.accessKey,
+            secretKey: n.files?.storage?.secretKey ?? f.files.storage.secretKey,
+            region: n.files?.storage?.region ?? f.files.storage.region,
+          },
+        },
+        debug: {
+          enabled: n.debug?.enabled ?? f.debug.enabled,
+          level: n.debug?.level ?? f.debug.level,
+        },
+      }
+    : f;
+}
+var S = class {
+    async processFileUrl(t, e) {
+      return t;
+    }
+  },
+  v = class {
+    constructor(t) {
+      this.config = t;
+    }
+    async processFileUrl(t, e) {
+      try {
+        let r = N(t),
+          s = Q(e),
+          o = `${r}${s}`,
+          a = await this.createStorage();
+        if (await a.exists(o)) return a.getPublicUrl(o);
+        let { downloadFile: i } = await import("./file-utils-MJXNBR7K.mjs"),
+          c = await i(t);
+        return (await a.store(o, c), a.getPublicUrl(o));
+      } catch (r) {
+        return (
+          console.warn(`Failed to cache file locally: ${e} from ${t}`, {
+            fileName: e,
+            url: t,
+            error: r instanceof Error ? r.message : String(r),
+          }),
+          t
+        );
+      }
+    }
+    async createStorage() {
+      let { LocalStorage: t } = await import("./s3-storage-33JGBQZG.mjs"),
+        e = this.config?.storage?.path || "./public/assets/notion-files";
+      return new t(e);
+    }
+  },
+  T = class {
+    constructor(t) {
+      this.config = t;
+    }
+    async processFileUrl(t, e) {
+      if (!this.config?.storage) return t;
+      try {
+        let r = N(t),
+          s = Q(e),
+          o = this.config.storage.path || "",
+          a = o ? `${o}${r}${s}` : `${r}${s}`,
+          i = await this.createStorage();
+        if (await i.exists(a)) return i.getPublicUrl(a);
+        let { downloadFile: c } = await import("./file-utils-MJXNBR7K.mjs"),
+          d = await c(t);
+        return (await i.store(a, d), i.getPublicUrl(a));
+      } catch (r) {
+        return (
+          console.warn(`Failed to store file remotely: ${e} from ${t}`, {
+            fileName: e,
+            url: t,
+            error: r instanceof Error ? r.message : String(r),
+          }),
+          t
+        );
+      }
+    }
+    async createStorage() {
+      if (!this.config?.storage)
+        throw new Error(
+          "S3 storage configuration is required for remote strategy",
+        );
+      let { S3Storage: t } = await import("./s3-storage-33JGBQZG.mjs");
+      return new t({
+        endpoint: this.config.storage.endpoint,
+        bucket: this.config.storage.bucket || "default-bucket",
+        accessKey: this.config.storage.accessKey,
+        secretKey: this.config.storage.secretKey,
+        region: this.config.storage.region,
+      });
+    }
+  },
+  k = class {
+    constructor(t) {
+      let e = t.files;
+      switch (e?.strategy) {
+        case "local":
+          this.strategy = new v(e);
+          break;
+        case "remote":
+          this.strategy = new T(e);
+          break;
+        case "direct":
+        default:
+          this.strategy = new S();
+          break;
+      }
+    }
+    isCacheEnabled() {
+      return this.strategy instanceof v || this.strategy instanceof T;
+    }
+    async processFileUrl(t, e) {
+      return this.strategy.processFileUrl(t, e);
+    }
+    async processFileInfoArray(t) {
+      return Promise.all(
+        t.map(async (e) => {
+          let r = await this.processFileUrl(e.url, e.name);
+          return { ...e, url: r };
+        }),
+      );
+    }
+    extractFileUrl(t) {
+      return t.type === "external"
+        ? t.external.url
+        : t.type === "file"
+          ? t.file.url
+          : "";
+    }
+    createFileInfo(t) {
+      return {
+        name: t.name,
+        url: this.extractFileUrl(t),
+        type: t.type,
+        ...(t.type === "file" && { expiry_time: t.file.expiry_time }),
+      };
+    }
+  };
+function N(n) {
+  let t = n.match(/([a-f0-9-]{36})/g);
+  if (t && t.length >= 2) return t[1].replace(/-/g, "");
+  if (t && t.length === 1) return t[0].replace(/-/g, "");
+  let e = 0;
+  for (let r = 0; r < n.length; r++) {
+    let s = n.charCodeAt(r);
+    ((e = (e << 5) - e + s), (e = e & e));
+  }
+  return Math.abs(e).toString(16);
+}
+function Q(n) {
+  let t = n.match(/\.([a-zA-Z0-9]+)(?:\?|$)/);
+  return t ? `.${t[1]}` : "";
+}
+function ne(n, t) {
+  let e = n;
+  return (
+    t.code && (e = `\`${e}\``),
+    t.bold && (e = `**${e}**`),
+    t.italic && (e = `*${e}*`),
+    t.strikethrough && (e = `~~${e}~~`),
+    e
+  );
+}
+function m(n = []) {
+  return Array.isArray(n) ? n.map((t) => t.plain_text || "").join("") : "";
+}
+function l(n = []) {
+  return Array.isArray(n)
+    ? n
+        .map((t) => {
+          let e = t.plain_text || "",
+            r = ne(e, t.annotations),
+            s = t.href;
+          return s ? `[${r}](${s})` : r;
+        })
+        .join("")
+    : "";
+}
+function C(n) {
+  return n
+    .replace(/&/g, "&amp;")
+    .replace(/</g, "&lt;")
+    .replace(/>/g, "&gt;")
+    .replace(/"/g, "&quot;")
+    .replace(/'/g, "&#39;");
+}
+function p(n = [], t = "") {
+  if (!Array.isArray(n)) return "";
+  let e = t || "";
+  return n
+    .map((r) => {
+      let s = C(r.plain_text || ""),
+        {
+          bold: o,
+          italic: a,
+          strikethrough: i,
+          code: c,
+          color: d,
+        } = r.annotations;
+      (c && (s = `<code>${s}</code>`),
+        o && (s = `<strong>${s}</strong>`),
+        a && (s = `<em>${s}</em>`),
+        i && (s = `<s>${s}</s>`));
+      let y = [];
+      if (d && d !== "default")
+        if (d.endsWith("_background")) {
+          let P = d.replace("_background", "");
+          y.push(`${e}bg-${P}`);
+        } else y.push(`${e}color-${d}`);
+      y.length && (s = `<span class="${y.join(" ")}">${s}</span>`);
+      let _ = r.href;
+      return _ ? `<a href="${C(_)}">${s}</a>` : s;
+    })
+    .join("");
+}
+function V(n) {
+  return n.type;
+}
+function se(n) {
+  return n[V(n)];
+}
+async function ae(n, t, e) {
+  if (e.mediaUrlResolver) {
+    let r = await e.mediaUrlResolver(n, t);
+    if (r) return r;
+  }
+  return t
+    ? t?.type === "external"
+      ? (t?.external?.url ?? "")
+      : (t?.file?.url ?? "")
+    : "";
+}
+async function oe(n, t) {
+  let e = V(n),
+    r = se(n),
+    s = n.children || [],
+    o = await A(s, t);
+  switch (e) {
+    case "paragraph":
+    case "quote": {
+      let a = m(r?.rich_text ?? []),
+        i = l(r?.rich_text ?? []);
+      return {
+        id: n.id,
+        type: e,
+        text: a,
+        text_md: i,
+        children: o.length ? o : void 0,
+      };
+    }
+    case "heading_1":
+    case "heading_2":
+    case "heading_3": {
+      let a = m(r?.rich_text ?? []),
+        i = l(r?.rich_text ?? []);
+      return { id: n.id, type: e, text: a, text_md: i };
+    }
+    case "bulleted_list_item":
+    case "numbered_list_item":
+    case "toggle": {
+      let a = m(r?.rich_text ?? []),
+        i = l(r?.rich_text ?? []);
+      return {
+        id: n.id,
+        type: e,
+        text: a,
+        text_md: i,
+        children: o.length ? o : void 0,
+      };
+    }
+    case "to_do": {
+      let a = m(r?.rich_text ?? []),
+        i = l(r?.rich_text ?? []),
+        c = !!r?.checked;
+      return {
+        id: n.id,
+        type: e,
+        checked: c,
+        text: a,
+        text_md: i,
+        children: o.length ? o : void 0,
+      };
+    }
+    case "code": {
+      let a = r?.language || "",
+        i = m(r?.rich_text ?? []),
+        c = l(r?.rich_text ?? []);
+      return { id: n.id, type: e, language: a, text: i, text_md: c };
+    }
+    case "bookmark":
+    case "embed":
+    case "link_preview": {
+      let a = r?.url || "",
+        i = m(r?.caption ?? []) || void 0,
+        c = l(r?.caption ?? []) || void 0;
+      return { id: n.id, type: e, url: a, caption_text: i, caption_md: c };
+    }
+    case "image":
+    case "video":
+    case "audio":
+    case "file":
+    case "pdf": {
+      let a = await ae(n, r, t),
+        i = m(r?.caption ?? []) || void 0,
+        c = l(r?.caption ?? []) || void 0,
+        d = r?.file?.expiry_time || void 0;
+      return {
+        id: n.id,
+        type: e,
+        url: a,
+        caption_text: i,
+        caption_md: c,
+        expiry_time: d,
+      };
+    }
+    case "equation": {
+      let a = r?.expression || "";
+      return { id: n.id, type: e, expression: a };
+    }
+    case "divider":
+      return { id: n.id, type: e };
+    case "table": {
+      let a = !!r?.has_column_header,
+        i = !!r?.has_row_header,
+        d = (await A(s, t)).filter((y) => y.type === "table_row");
+      return {
+        id: n.id,
+        type: e,
+        hasColumnHeader: a,
+        hasRowHeader: i,
+        rows: d,
+      };
+    }
+    case "table_row": {
+      let a =
+        r?.cells?.map((i) => {
+          let c = Array.isArray(i) ? i : [];
+          return { text: m(c), text_md: l(c) };
+        }) ?? [];
+      return { id: n.id, type: e, cells: a };
+    }
+    case "columns": {
+      let i = (o.length ? o : [])
+        .filter((c) => c.type === "column")
+        .map((c) => ({ type: "column", children: c.children || [] }));
+      return { id: n.id, type: "columns", children: i };
+    }
+    case "column":
+      return { id: n.id, type: e, children: o.length ? o : [] };
+    case "synced_block": {
+      let a = r?.synced_from?.block_id || void 0;
+      return {
+        id: n.id,
+        type: e,
+        originalBlockId: a,
+        children: o.length ? o : void 0,
+      };
+    }
+    case "child_page": {
+      let a = r?.title || void 0;
+      return { id: n.id, type: e, title: a, pageId: n.id };
+    }
+    case "child_database": {
+      let a = r?.title || void 0;
+      return { id: n.id, type: e, title: a, databaseId: n.id };
+    }
+    case "breadcrumb":
+    case "table_of_contents":
+    case "template":
+      return { id: n.id, type: e, children: o.length ? o : void 0 };
+    default:
+      return null;
+  }
+}
+async function A(n, t) {
+  let e = [];
+  for (let r of n) {
+    let s = await oe(r, t);
+    s && e.push(s);
+  }
+  return e;
+}
+async function H(n = [], t = {}) {
+  let e = { mediaUrlResolver: t.mediaUrlResolver };
+  return A(n, e);
+}
+async function z(n, t = {}) {
+  let e = ce(n),
+    r = n.children || [],
+    s = r.length ? await O(r, t) : void 0;
+  return {
+    id: n.id,
+    type: n.type,
+    content: e,
+    hasChildren: !!n.has_children,
+    ...(s && s.length ? { children: s } : {}),
+  };
+}
+async function O(n = [], t = {}) {
+  return Promise.all(n.map((e) => z(e, t)));
+}
+async function ie(n = [], t = {}) {
+  let e =
+    t.mediaUrlResolver ||
+    (async (r, s) => {
+      if (!s) return "";
+      let o = s?.type === "external" ? s?.external?.url : s?.file?.url;
+      if (!t.fileManager || !o) return o || "";
+      try {
+        return await t.fileManager.processFileUrl(o, `content-block-${r.id}`);
+      } catch {
+        return o || "";
+      }
+    });
+  return H(n, { mediaUrlResolver: e });
+}
+function ce(n) {
+  let t = n.type,
+    e = n[t];
+  switch (t) {
+    case "paragraph":
+    case "heading_1":
+    case "heading_2":
+    case "heading_3":
+    case "bulleted_list_item":
+    case "numbered_list_item":
+    case "toggle":
+    case "quote":
+      return { text: g(e?.rich_text), richText: e?.rich_text };
+    case "code":
+      return { text: g(e?.rich_text), language: e?.language };
+    case "image":
+    case "file":
+    case "pdf":
+    case "video":
+    case "audio": {
+      let r = le(e);
+      return { caption: e?.caption ? g(e.caption) : "", url: r };
+    }
+    case "bookmark":
+    case "embed":
+    case "link_preview":
+      return { url: e?.url || "", caption: e?.caption ? g(e.caption) : "" };
+    case "divider":
+    case "equation":
+    case "table_of_contents":
+      return e || {};
+    case "to_do":
+      return { text: g(e?.rich_text), checked: !!e?.checked };
+    case "callout":
+      return { text: g(e?.rich_text), icon: e?.icon };
+    case "table":
+      return {
+        tableWidth: e?.table_width,
+        hasColumnHeader: e?.has_column_header,
+        hasRowHeader: e?.has_row_header,
+      };
+    case "table_row":
+      return {
+        cells: (e?.cells || []).map((r) => ({ plainText: g(r), richText: r })),
+      };
+    default:
+      return e || {};
+  }
+}
+function le(n) {
+  return (
+    (n && (n?.type === "external" ? n?.external?.url : n?.file?.url)) || ""
+  );
+}
+function g(n = []) {
+  return Array.isArray(n) ? n.map((t) => t?.plain_text || "").join("") : "";
+}
+var M = class {
+  constructor(t, e) {
+    this.client = t;
+    this.fileManager = e;
+  }
+  async getPageContent(t, e = true) {
+    let r = await this.getBlocks(t);
+    if (e)
+      for (let s of r)
+        s.has_children && (s.children = await this.getPageContent(s.id, true));
+    return r;
+  }
+  async getBlocks(t) {
+    let e = [],
+      r = true,
+      s;
+    for (; r; ) {
+      let o = await this.client.blocks.children.list({
+          block_id: t,
+          start_cursor: s,
+        }),
+        i = o.results;
+      (await Promise.all(i.map((c) => this.enrichBlockFiles(c))),
+        (e = [...e, ...i]),
+        (r = o.has_more),
+        (s = o.next_cursor || void 0));
+    }
+    return e;
+  }
+  async convertBlocksToSimple(t) {
+    return O(t, { fileManager: this.fileManager });
+  }
+  async enrichBlockFiles(t) {
+    let e = t.type,
+      r = t[e];
+    if (!r) return;
+    let s = async (a, i) => {
+        if (!a) return a;
+        try {
+          return await this.fileManager.processFileUrl(a, i || `${t.id}-${e}`);
+        } catch {
+          return a;
+        }
+      },
+      o = async (a, i) => {
+        a &&
+          (a.type === "external" &&
+            a.external?.url &&
+            (a.external.url = (await s(a.external.url, i)) || a.external.url),
+          a.type === "file" &&
+            a.file?.url &&
+            (a.file.url = (await s(a.file.url, i)) || a.file.url));
+      };
+    switch (e) {
+      case "image":
+      case "video":
+      case "audio":
+      case "file":
+      case "pdf": {
+        await o(r, r?.name);
+        break;
+      }
+      case "embed":
+      case "bookmark":
+      case "link_preview": {
+        r.url && (r.url = (await s(r.url, r?.url)) || r.url);
+        break;
+      }
+      case "callout": {
+        r.icon && r.icon.type === "file" && (await o(r.icon, `${t.id}-icon`));
+        break;
+      }
+    }
+  }
+};
+var D = class {
+    constructor() {
+      this.config = { enabled: false, level: "info" };
+    }
+    configure(t) {
+      this.config = { ...this.config, ...t };
+    }
+    normalizeLevel(t) {
+      return t && ["error", "warn", "info", "debug"].includes(t) ? t : "info";
+    }
+    shouldLog(t) {
+      if (!this.config.enabled) return false;
+      let e = ["error", "warn", "info", "debug"],
+        r = e.indexOf(this.normalizeLevel(this.config.level));
+      return e.indexOf(t) <= r;
+    }
+    log(...t) {
+      this.shouldLog("info") && console.log("[NotionCMS Debug]:", ...t);
+    }
+    query(t, e) {
+      this.shouldLog("debug") &&
+        console.log(
+          `
+[NotionCMS Query]:`,
+          {
+            databaseId: t,
+            filter: e.filter,
+            sorts: e.sorts,
+            pageSize: e.page_size,
+            startCursor: e.start_cursor,
+            timestamp: new Date().toISOString(),
+          },
+        );
+    }
+    error(t, e) {
+      this.shouldLog("error") &&
+        console.error("[NotionCMS Error]:", {
+          message: t.message,
+          code: t.code,
+          context: e,
+          timestamp: new Date().toISOString(),
+        });
+    }
+  },
+  u = new D();
+async function G(n, t) {
+  switch (n.type) {
+    case "unique_id":
+      return n.unique_id.number;
+    case "title":
+      return n.title?.[0]?.plain_text ?? "";
+    case "rich_text":
+      return n.rich_text?.[0]?.plain_text ?? "";
+    case "number":
+      return n.number;
+    case "select":
+      return n.select?.name ?? null;
+    case "multi_select":
+      return n.multi_select.map((e) => e.name);
+    case "date": {
+      let e = n;
+      return e.date ? new Date(e.date.start) : null;
+    }
+    case "people": {
+      let e = n;
+      return Array.isArray(e.people) ? e.people.map((r) => r.name || "") : [];
+    }
+    case "files": {
+      let r = n.files.map((s) =>
+        s.type === "external"
+          ? { name: s.name, url: s.external.url }
+          : s.type === "file"
+            ? { name: s.name, url: s.file.url }
+            : { name: s.name, url: "" },
+      );
+      return t
+        ? Promise.all(
+            r.map(async (s) => {
+              let o = await t.processFileUrl(s.url, s.name);
+              return { ...s, url: o };
+            }),
+          )
+        : r;
+    }
+    case "checkbox":
+      return n.checkbox;
+    case "url":
+      return n.url;
+    case "email":
+      return n.email;
+    case "phone_number":
+      return n.phone_number;
+    case "formula":
+      return n.formula;
+    case "relation": {
+      let e = n;
+      return Array.isArray(e.relation) ? e.relation.map((r) => r.id) : [];
+    }
+    case "rollup":
+      return n.rollup;
+    case "created_time":
+      return n.created_time;
+    case "created_by": {
+      let e = n.created_by;
+      return { id: e.id, name: e.name, avatar_url: e.avatar_url };
+    }
+    case "last_edited_time":
+      return n.last_edited_time;
+    case "last_edited_by": {
+      let e = n.last_edited_by;
+      return { id: e.id, name: e.name, avatar_url: e.avatar_url };
+    }
+    default:
+      return null;
+  }
+}
+async function W(n, t) {
+  switch (n.type) {
+    case "title": {
+      let e = n;
+      return Array.isArray(e.title)
+        ? e.title.map((r) => ({
+            content: r.plain_text,
+            annotations: r.annotations,
+            href: r.href,
+            ...(r.type === "text" && { link: r.text.link }),
+          }))
+        : [];
+    }
+    case "rich_text": {
+      let e = n;
+      return Array.isArray(e.rich_text)
+        ? e.rich_text.map((r) => ({
+            content: r.plain_text,
+            annotations: r.annotations,
+            href: r.href,
+            ...(r.type === "text" && { link: r.text.link }),
+          }))
+        : [];
+    }
+    case "number":
+      return n.number;
+    case "select": {
+      let e = n.select;
+      return e ? { id: e.id, name: e.name, color: e.color } : null;
+    }
+    case "multi_select":
+      return n.multi_select.map((r) => ({
+        id: r.id,
+        name: r.name,
+        color: r.color,
+      }));
+    case "date": {
+      let e = n;
+      return e.date
+        ? {
+            start: e.date.start,
+            end: e.date.end,
+            time_zone: e.date.time_zone,
+            parsedStart: e.date.start ? new Date(e.date.start) : null,
+            parsedEnd: e.date.end ? new Date(e.date.end) : null,
+          }
+        : null;
+    }
+    case "people": {
+      let e = n;
+      return Array.isArray(e.people)
+        ? e.people.map((r) => ({
+            id: r.id,
+            name: r.name,
+            avatar_url: r.avatar_url,
+            object: r.object,
+            type: r.type,
+            ...(r.type === "person" && r.person && { email: r.person.email }),
+          }))
+        : [];
+    }
+    case "files": {
+      let r = n.files.map((s) =>
+        s.type === "external"
+          ? { name: s.name, type: s.type, external: { url: s.external.url } }
+          : s.type === "file"
+            ? {
+                name: s.name,
+                type: s.type,
+                file: { url: s.file.url, expiry_time: s.file.expiry_time },
+              }
+            : { name: s.name, type: s.type },
+      );
+      return t
+        ? Promise.all(
+            r.map(async (s) => {
+              let o = s.type === "external" ? s.external?.url : s.file?.url;
+              if (o) {
+                let a = await t.processFileUrl(o, s.name);
+                s.type === "external" && s.external
+                  ? (s.external.url = a)
+                  : s.type === "file" && s.file && (s.file.url = a);
+              }
+              return s;
+            }),
+          )
+        : r;
+    }
+    case "checkbox":
+      return n.checkbox;
+    case "url":
+      return n.url;
+    case "email":
+      return n.email;
+    case "phone_number":
+      return n.phone_number;
+    case "formula": {
+      let e = n.formula;
+      return {
+        type: e.type,
+        value:
+          e.type === "string"
+            ? e.string
+            : e.type === "number"
+              ? e.number
+              : e.type === "boolean"
+                ? e.boolean
+                : e.type === "date"
+                  ? e.date
+                  : null,
+      };
+    }
+    case "relation": {
+      let e = n;
+      return Array.isArray(e.relation)
+        ? e.relation.map((r) => ({ id: r.id }))
+        : [];
+    }
+    case "rollup": {
+      let e = n.rollup;
+      return {
+        type: e.type,
+        function: e.function,
+        ...(e.type === "array" && { array: e.array }),
+        ...(e.type === "number" && { number: e.number }),
+        ...(e.type === "date" && { date: e.date }),
+      };
+    }
+    case "created_time":
+      return { timestamp: n.created_time, date: new Date(n.created_time) };
+    case "created_by": {
+      let e = n.created_by;
+      return {
+        id: e.id,
+        name: e.name,
+        avatar_url: e.avatar_url,
+        object: e.object,
+        type: e.type,
+        ...(e.type === "person" && e.person && { email: e.person.email }),
+      };
+    }
+    case "last_edited_time":
+      return {
+        timestamp: n.last_edited_time,
+        date: new Date(n.last_edited_time),
+      };
+    case "last_edited_by": {
+      let e = n.last_edited_by;
+      return {
+        id: e.id,
+        name: e.name,
+        avatar_url: e.avatar_url,
+        object: e.object,
+        type: e.type,
+        ...(e.type === "person" && e.person && { email: e.person.email }),
+      };
+    }
+    case "status": {
+      let e = n.status;
+      return e ? { id: e.id, name: e.name, color: e.color } : null;
+    }
+    case "unique_id": {
+      let e = n.unique_id;
+      return e ? { prefix: e.prefix, number: e.number } : null;
+    }
+    default:
+      return null;
+  }
+}
+async function Z(n, t, e = {}) {
+  switch (t) {
+    case "simple":
+      return F(n, e.fileManager);
+    case "advanced":
+      return B(n, e.fileManager);
+    default:
+      return n;
+  }
+}
+async function F(n, t) {
+  let e = { id: n.id };
+  return (
+    await Promise.all(
+      Object.entries(n.properties).map(async ([r, s]) => {
+        e[r] = await G(s, t);
+      }),
+    ),
+    e
+  );
+}
+async function B(n, t) {
+  let e = { id: n.id };
+  return (
+    await Promise.all(
+      Object.entries(n.properties).map(async ([r, s]) => {
+        e[r] = await W(s, t);
+      }),
+    ),
+    e
+  );
+}
+async function de(n, t, e = {}) {
+  return Promise.all(n.map((r) => Z(r, t, e)));
+}
+var U = {
+    title: [
+      "equals",
+      "does_not_equal",
+      "contains",
+      "does_not_contain",
+      "starts_with",
+      "ends_with",
+      "is_empty",
+      "is_not_empty",
+    ],
+    rich_text: [
+      "equals",
+      "does_not_equal",
+      "contains",
+      "does_not_contain",
+      "starts_with",
+      "ends_with",
+      "is_empty",
+      "is_not_empty",
+    ],
+    url: [
+      "equals",
+      "does_not_equal",
+      "contains",
+      "does_not_contain",
+      "starts_with",
+      "ends_with",
+      "is_empty",
+      "is_not_empty",
+    ],
+    email: [
+      "equals",
+      "does_not_equal",
+      "contains",
+      "does_not_contain",
+      "starts_with",
+      "ends_with",
+      "is_empty",
+      "is_not_empty",
+    ],
+    phone_number: [
+      "equals",
+      "does_not_equal",
+      "contains",
+      "does_not_contain",
+      "starts_with",
+      "ends_with",
+      "is_empty",
+      "is_not_empty",
+    ],
+    number: [
+      "equals",
+      "does_not_equal",
+      "greater_than",
+      "less_than",
+      "greater_than_or_equal_to",
+      "less_than_or_equal_to",
+      "is_empty",
+      "is_not_empty",
+    ],
+    select: ["equals", "does_not_equal", "is_empty", "is_not_empty"],
+    multi_select: ["contains", "does_not_contain", "is_empty", "is_not_empty"],
+    status: ["equals", "does_not_equal", "is_empty", "is_not_empty"],
+    date: [
+      "equals",
+      "before",
+      "after",
+      "on_or_before",
+      "on_or_after",
+      "is_empty",
+      "is_not_empty",
+    ],
+    created_time: ["equals", "before", "after", "on_or_before", "on_or_after"],
+    last_edited_time: [
+      "equals",
+      "before",
+      "after",
+      "on_or_before",
+      "on_or_after",
+    ],
+    checkbox: ["equals"],
+    people: ["contains", "does_not_contain", "is_empty", "is_not_empty"],
+    relation: ["contains", "does_not_contain", "is_empty", "is_not_empty"],
+    created_by: ["contains", "does_not_contain"],
+    last_edited_by: ["contains", "does_not_contain"],
+    files: ["is_empty", "is_not_empty"],
+    formula: [
+      "equals",
+      "does_not_equal",
+      "contains",
+      "does_not_contain",
+      "greater_than",
+      "less_than",
+      "greater_than_or_equal_to",
+      "less_than_or_equal_to",
+      "is_empty",
+      "is_not_empty",
+    ],
+    rollup: [
+      "equals",
+      "does_not_equal",
+      "contains",
+      "does_not_contain",
+      "greater_than",
+      "less_than",
+      "greater_than_or_equal_to",
+      "less_than_or_equal_to",
+      "is_empty",
+      "is_not_empty",
+    ],
+    unique_id: [
+      "equals",
+      "does_not_equal",
+      "greater_than",
+      "less_than",
+      "greater_than_or_equal_to",
+      "less_than_or_equal_to",
+    ],
+    verification: ["equals", "before", "after", "on_or_before", "on_or_after"],
+    unknown: ["equals", "does_not_equal", "is_empty", "is_not_empty"],
+  },
+  b = class {
+    constructor(t, e, r = {}, s, o = "raw") {
+      this.filterConditions = [];
+      this.logicalOperator = "and";
+      this.nestedFilters = [];
+      this.sortOptions = [];
+      this.pageLimit = 100;
+      this.singleMode = null;
+      this.recordType = "raw";
+      ((this.client = t),
+        (this.databaseId = e),
+        (this.fieldTypes = r),
+        (this.fileManager = s),
+        (this.recordType = o));
+    }
+    filter(t, e, r) {
+      if (!this.isValidOperatorForField(t, e))
+        throw new Error(
+          `Invalid operator "${e}" for field "${t}" of type "${this.getFieldTypeForFilter(t)}"`,
+        );
+      let s = this.getFieldTypeForFilter(t),
+        o = this.mapFieldTypeToNotionProperty(s);
+      return (
+        this.filterConditions.push({
+          property: t,
+          operator: e,
+          value: this.prepareFilterValue(s, e, r),
+          propertyType: o,
+        }),
+        this
+      );
+    }
+    mapFieldTypeToNotionProperty(t) {
+      if (!t) return "rich_text";
+      switch (t) {
+        case "title":
+          return "title";
+        case "rich_text":
+          return "rich_text";
+        case "number":
+          return "number";
+        case "select":
+          return "select";
+        case "multi_select":
+          return "multi_select";
+        case "date":
+        case "created_time":
+        case "last_edited_time":
+          return "date";
+        case "checkbox":
+          return "checkbox";
+        case "people":
+        case "created_by":
+        case "last_edited_by":
+          return "people";
+        case "files":
+          return "files";
+        case "url":
+          return "url";
+        case "email":
+          return "email";
+        case "phone_number":
+          return "phone_number";
+        case "relation":
+          return "relation";
+        case "formula":
+          return "formula";
+        case "rollup":
+          return "rollup";
+        case "status":
+          return "status";
+        case "unique_id":
+          return "unique_id";
+        case "button":
+          return "button";
+        default:
+          return "rich_text";
+      }
+    }
+    prepareFilterValue(t, e, r) {
+      return e === "is_empty" || e === "is_not_empty"
+        ? true
+        : t === "date" || t === "created_time" || t === "last_edited_time"
+          ? r instanceof Date
+            ? r.toISOString()
+            : r
+          : t === "multi_select" &&
+              (e === "contains" || e === "does_not_contain") &&
+              Array.isArray(r)
+            ? r[0] || ""
+            : r;
+    }
+    sort(t, e = "ascending") {
+      if (!this.isValidSortField(t))
+        throw new Error(
+          `Invalid sort property "${t}". Property not found in database schema. Available fields: ${Object.keys(this.fieldTypes).join(", ")}`,
+        );
+      if (e !== "ascending" && e !== "descending")
+        throw new Error(
+          `Invalid sort direction "${e}". Must be "ascending" or "descending".`,
+        );
+      return (
+        u.log(`Adding sort: ${t} ${e}`),
+        this.sortOptions.push({ property: t, direction: e }),
+        this
+      );
+    }
+    limit(t) {
+      return ((this.pageLimit = t), this);
+    }
+    startAfter(t) {
+      return ((this.startCursor = t), this);
+    }
+    single() {
+      return ((this.singleMode = "required"), (this.pageLimit = 2), this);
+    }
+    maybeSingle() {
+      return ((this.singleMode = "optional"), (this.pageLimit = 1), this);
+    }
+    then(t, e) {
+      return this.execute().then(t, e);
+    }
+    async execute() {
+      let { results: t } = await this.paginate(this.pageLimit);
+      if (this.singleMode === "required") {
+        if (t.length === 0)
+          throw new Error("No records found matching the query");
+        if (t.length > 1)
+          throw new Error("Multiple records found when expecting exactly one");
+        return t[0];
+      }
+      return this.singleMode === "optional" ? (t.length > 0 ? t[0] : null) : t;
+    }
+    async paginate(t = 100) {
+      let e = this.buildFilter();
+      try {
+        u.query(this.databaseId, {
+          database_id: this.databaseId,
+          filter: e || void 0,
+          sorts: this.sortOptions,
+          page_size: t,
+          start_cursor: this.startCursor,
+        });
+        let r = await this.client.databases.query({
+          database_id: this.databaseId,
+          filter: e || void 0,
+          sorts:
+            this.sortOptions && this.sortOptions.length > 0
+              ? this.sortOptions
+              : void 0,
+          page_size: t,
+          start_cursor: this.startCursor,
+        });
+        u.log(`Query returned ${r.results.length} results`);
+        let s = r.results;
+        (u.log("[QueryBuilder] FileManager present:", !!this.fileManager),
+          u.log(
+            "[QueryBuilder] Cache enabled:",
+            this.fileManager?.isCacheEnabled(),
+          ),
+          u.log(`[QueryBuilder] recordType=${this.recordType}`));
+        let o;
+        switch (this.recordType) {
+          case "advanced":
+            o = await Promise.all(s.map(async (a) => B(a, this.fileManager)));
+            break;
+          case "simple":
+            o = await Promise.all(s.map(async (a) => F(a, this.fileManager)));
+            break;
+          case "raw":
+            o = s;
+            break;
+          default:
+            o = s;
+            break;
+        }
+        return { results: o, hasMore: r.has_more, nextCursor: r.next_cursor };
+      } catch (r) {
+        throw (
+          u.error(r, {
+            databaseId: this.databaseId,
+            filter: e,
+            sorts: this.sortOptions,
+            pageSize: t,
+            startCursor: this.startCursor,
+          }),
+          r
+        );
+      }
+    }
+    async all() {
+      let t = [],
+        e = true,
+        r = null;
+      for (; e; ) {
+        r && this.startAfter(r);
+        let s = await this.paginate(100);
+        ((t = [...t, ...s.results]), (e = s.hasMore), (r = s.nextCursor));
+      }
+      return t;
+    }
+    buildFilter() {
+      let t = [];
+      if (
+        (this.filterConditions.forEach((e) => {
+          let { property: r, operator: s, value: o, propertyType: a } = e,
+            i = { property: r };
+          if (!a)
+            throw new Error(
+              `Property type not determined for property: ${String(r)}`,
+            );
+          let c = this.mapToNotionOperator(s);
+          ((i[a] = { [c]: o }), t.push(i));
+        }),
+        t.push(...this.nestedFilters),
+        t.length !== 0)
+      )
+        return t.length === 1 ? t[0] : { [this.logicalOperator]: t };
+    }
+    mapToNotionOperator(t) {
+      switch (t) {
+        case "equals":
+        case "does_not_equal":
+        case "contains":
+        case "does_not_contain":
+        case "starts_with":
+        case "ends_with":
+        case "greater_than":
+        case "less_than":
+        case "greater_than_or_equal_to":
+        case "less_than_or_equal_to":
+        case "before":
+        case "after":
+        case "on_or_before":
+        case "on_or_after":
+        case "is_empty":
+        case "is_not_empty":
+          return t;
+        default:
+          return t;
+      }
+    }
+    getFieldTypeForFilter(t) {
+      return this.fieldTypes[t]?.type;
+    }
+    isValidOperatorForField(t, e) {
+      let r = this.getFieldTypeForFilter(t);
+      return !r || !(r in U) ? false : U[r].includes(e);
+    }
+    isValidSortField(t) {
+      return this.getFieldTypeForFilter(t) !== void 0;
+    }
+  };
+var q = class {
+  constructor(t, e) {
+    this.client = t;
+    this.fileManager = e;
+  }
+  query(t, e, r) {
+    return e
+      ? new b(this.client, t, e, this.fileManager, r?.recordType || "raw")
+      : new b(this.client, t, {}, this.fileManager, r?.recordType || "raw");
+  }
+  async getDatabase(t, e = {}) {
+    try {
+      u.query(t, {
+        database_id: t,
+        filter: e.filter,
+        sorts: e.sorts,
+        page_size: e.pageSize,
+        start_cursor: e.startCursor,
+      });
+      let r = await this.client.databases.query({
+        database_id: t,
+        filter: e.filter,
+        sorts: e.sorts,
+        page_size: e.pageSize,
+        start_cursor: e.startCursor,
+      });
+      u.log(`Query returned ${r.results.length} results`);
+      let s = r.results;
+      return (
+        await Promise.all(s.map((o) => this.enrichRecordFiles(o))),
+        { results: s, nextCursor: r.next_cursor, hasMore: r.has_more }
+      );
+    } catch (r) {
+      throw (u.error(r, { databaseId: t, options: e }), r);
+    }
+  }
+  async getRecord(t) {
+    let e = await this.client.pages.retrieve({ page_id: t });
+    return (await this.enrichRecordFiles(e), e);
+  }
+  async getAllDatabaseRecords(t, e = {}) {
+    let r = [],
+      s = true,
+      o = null;
+    for (; s; ) {
+      let a = await this.getDatabase(t, { ...e, startCursor: o || void 0 });
+      (r.push(...a.results), (s = a.hasMore), (o = a.nextCursor));
+    }
+    return r;
+  }
+  async enrichRecordFiles(t) {
+    (t.cover &&
+      (t.cover = await this.processPageCover(t.cover, `${t.id}-cover`)),
+      t.icon &&
+        t.icon.type === "file" &&
+        (t.icon = await this.processPageIcon(t.icon, `${t.id}-icon`)));
+    let e = Object.entries(t.properties);
+    await Promise.all(
+      e.map(async ([r, s]) => {
+        if (s.type === "files") {
+          let o = s;
+          o.files = await Promise.all(
+            o.files.map((a, i) =>
+              this.processPropertyFile(a, `${t.id}-${r}-${i}`),
+            ),
+          );
+        }
+      }),
+    );
+  }
+  async processPageCover(t, e) {
+    if (t.type === "external") {
+      let r = await this.safeProcessUrl(t.external.url, e);
+      t.external.url = r;
+    } else if (t.type === "file") {
+      let r = await this.safeProcessUrl(t.file.url, e);
+      t.file.url = r;
+    }
+    return t;
+  }
+  async processPageIcon(t, e) {
+    let r = await this.safeProcessUrl(t.file.url, e);
+    return ((t.file.url = r), t);
+  }
+  async processPropertyFile(t, e) {
+    let r = t.name || e,
+      s = this.fileManager.extractFileUrl(t);
+    if (!s) return t;
+    try {
+      let o = await this.fileManager.processFileUrl(s, r);
+      t.type === "external" && t.external
+        ? (t.external.url = o)
+        : t.type === "file" && t.file && (t.file.url = o);
+    } catch (o) {
+      u.error(o, { scope: "file-cache", fileName: r, originalUrl: s });
+    }
+    return t;
+  }
+  async safeProcessUrl(t, e) {
+    try {
+      return await this.fileManager.processFileUrl(t, e);
+    } catch (r) {
+      return (
+        u.error(r, { scope: "file-cache", fallbackName: e, originalUrl: t }),
+        t
+      );
+    }
+  }
+};
+var K = class K {
+  constructor(t, e) {
+    ((this.client = new Client({ auth: t , fetch:fetch.bind(globalThis) })),
+      (this.config = E(e)),
+      u.configure(this.config.debug),
+      (this.fileManager = new k(this.config)),
+      (this.pageContentService = new M(this.client, this.fileManager)),
+      (this.databaseService = new q(this.client, this.fileManager)));
+  }
+  query(t, e) {
+    let r = this.databases?.[t];
+    if (!r)
+      throw new Error(
+        `Database "${String(t)}" not found in registry. Make sure you've imported the generated types file.`,
+      );
+    return this._query(r.id, r.fields, { recordType: e?.recordType || "raw" });
+  }
+  _query(t, e, r) {
+    return this.databaseService.query(t, e, r);
+  }
+  async getRecord(t) {
+    return this.databaseService.getRecord(t);
+  }
+  async getPageContent(t, e = {}) {
+    let r = e.recursive ?? true;
+    return this.pageContentService.getPageContent(t, r);
+  }
+};
+K.prototype.databases = {};
+var j = K;
+function pe(n, t) {
+  j.prototype.databases[n] = t;
+}
+function J(n) {
+  return n === "bulleted_list_item" || n === "numbered_list_item";
+}
+function $(n) {
+  let t = [],
+    e = 0;
+  for (; e < n.length; ) {
+    let r = n[e],
+      s = r.type;
+    if (J(s)) {
+      let o = s,
+        a = [];
+      for (; e < n.length && J(n[e].type); ) {
+        let i = n[e];
+        if (i.type !== o) break;
+        (a.push(i), (e += 1));
+      }
+      t.push({ kind: "list_group", listType: o, items: a });
+      continue;
+    }
+    (t.push(r), (e += 1));
+  }
+  return t;
+}
+function X(n) {
+  return n.type;
+}
+function x(n) {
+  let t = X(n);
+  return n[t];
+}
+function Y(n, t) {
+  return t.repeat(Math.max(0, n * 2));
+}
+function me(n) {
+  let t = Math.max(1, Math.floor(n)),
+    e = "";
+  for (; t > 0; )
+    (t--,
+      (e = String.fromCharCode(97 + (t % 26)) + e),
+      (t = Math.floor(t / 26)));
+  return e;
+}
+function ye(n) {
+  let t = Math.max(1, Math.floor(n)),
+    e = [
+      [1e3, "m"],
+      [900, "cm"],
+      [500, "d"],
+      [400, "cd"],
+      [100, "c"],
+      [90, "xc"],
+      [50, "l"],
+      [40, "xl"],
+      [10, "x"],
+      [9, "ix"],
+      [5, "v"],
+      [4, "iv"],
+      [1, "i"],
+    ],
+    r = "";
+  for (let [s, o] of e) for (; t >= s; ) ((r += o), (t -= s));
+  return r;
+}
+function fe(n, t) {
+  let r = (Math.max(1, t) - 1) % 3;
+  return r === 0 ? String(n) : r === 1 ? me(n) : ye(n);
+}
+function I(n, t, e, r) {
+  let s = t.id,
+    o = `[${n}]${e ? ` ${e}` : ""}`;
+  return (
+    (o += ` [id: ${s}]`),
+    `${o}
+`
+  );
+}
+function h(n, t, e, r) {
+  let s = n.children;
+  return !s || !s.length ? "" : L(s, t, e, r);
+}
+function _e(n, t, e, r, s) {
+  let o = Y(e, r.listIndent),
+    a = "";
+  if (t === "bulleted_list_item")
+    for (let i of n) {
+      let c = x(i),
+        d = l(c?.rich_text ?? []);
+      ((a += `${o}- ${d}
+`),
+        (a += h(i, e + 1, r, 0)));
+    }
+  else {
+    let i = 1;
+    for (let c of n) {
+      let d = x(c),
+        y = l(d?.rich_text ?? []),
+        _ = r.alternateOrderedListStyles ? fe(i, s) : String(i);
+      ((a += `${o}${_}. ${y}
+`),
+        (a += h(c, e + 1, r, s)),
+        i++);
+    }
+  }
+  return a;
+}
+function ge(n, t) {
+  let e = x(n),
+    s = (n.children || []).map((c) =>
+      (x(c)?.cells || []).map((_) => {
+        let P = Array.isArray(_) ? _ : [];
+        return l(P);
+      }),
+    ),
+    o = !!e?.has_column_header,
+    a = "";
+  if (s.length === 0) return a;
+  let i = s[0].length;
+  if (o) {
+    ((a += `| ${s[0].join(" | ")} |
+`),
+      (a += `| ${Array.from({ length: i })
+        .map(() => "---")
+        .join(" | ")} |
+`));
+    for (let c = 1; c < s.length; c++)
+      a += `| ${s[c].join(" | ")} |
+`;
+  } else {
+    ((a += `| ${Array.from({ length: i })
+      .map(() => " ")
+      .join(" | ")} |
+`),
+      (a += `| ${Array.from({ length: i })
+        .map(() => "---")
+        .join(" | ")} |
+`));
+    for (let c = 0; c < s.length; c++)
+      a += `| ${s[c].join(" | ")} |
+`;
+  }
+  return a;
+}
+function he(n, t, e) {
+  let r = X(n),
+    s = x(n);
+  if (s === void 0)
+    throw new Error(
+      `blocksToMarkdown expects Raw Notion blocks; missing field for type "${r}"`,
+    );
+  let o = Y(t, e.listIndent);
+  switch (r) {
+    case "paragraph": {
+      let a = l(s?.rich_text ?? []);
+      return a ? `${a}` : "";
+    }
+    case "quote": {
+      let a = l(s?.rich_text ?? []);
+      return a ? `> ${a}` : ">";
+    }
+    case "toggle":
+      return `${l(s?.rich_text ?? [])}${h(n, t + 1, e, 0)}`;
+    case "to_do": {
+      let a = !!s?.checked,
+        i = l(s?.rich_text ?? []);
+      return `${o}- [${a ? "x" : " "}] ${i}${h(n, t + 1, e, 0)}`;
+    }
+    case "heading_1":
+      return `# ${l(s?.rich_text ?? [])}`;
+    case "heading_2":
+      return `## ${l(s?.rich_text ?? [])}`;
+    case "heading_3":
+      return `### ${l(s?.rich_text ?? [])}`;
+    case "code": {
+      let a = s?.language || "",
+        i = m(s?.rich_text ?? []);
+      return `\`\`\`
 ${a}
 ${i}
-\`\`\``}case "bookmark":case "embed":case "link_preview":{let a=s?.url||"",i=l(s?.caption??[]),c=`${a}`;return i&&(c+=`${i}`),c}case "image":case "video":case "audio":case "file":case "pdf":{let a=s?.type==="external"?s?.external?.url:s?.file?.url;return `![${l(s?.caption??[])??""}](${a??""})`}case "equation":return `$$${s?.expression||""}$$`;case "divider":return "---";case "table":return ge(n);case "table_row":return "";case "columns":{s?.children||[];let i="",c=n.children;return c&&c.length&&(i+=L(c,t,e,0)),i}case "column":return h(n,t,e,0);case "synced_block":return h(n,t,e,0);case "child_page":{if(!e.debug)return "";let a=s?.title||"";return I("child_page",n,a)}case "child_database":{if(!e.debug)return "";let a=s?.title||"";return I("child_database",n,a)}case "breadcrumb":return e.debug?I("breadcrumb",n,void 0):"";case "table_of_contents":return e.debug?I("table_of_contents",n,void 0):"";case "template":return h(n,t,e,0);default:return ""}}function L(n,t,e,r){let s="",o=$(n);for(let a of o){if(a.kind==="list_group"){let i=a,c=i.listType==="numbered_list_item"?r+1:0;s+=_e(i.items,i.listType,t,e,c)+`
+\`\`\``;
+    }
+    case "bookmark":
+    case "embed":
+    case "link_preview": {
+      let a = s?.url || "",
+        i = l(s?.caption ?? []),
+        c = `${a}`;
+      return (i && (c += `${i}`), c);
+    }
+    case "image":
+    case "video":
+    case "audio":
+    case "file":
+    case "pdf": {
+      let a = s?.type === "external" ? s?.external?.url : s?.file?.url;
+      return `![${l(s?.caption ?? []) ?? ""}](${a ?? ""})`;
+    }
+    case "equation":
+      return `$$${s?.expression || ""}$$`;
+    case "divider":
+      return "---";
+    case "table":
+      return ge(n);
+    case "table_row":
+      return "";
+    case "columns": {
+      s?.children || [];
+      let i = "",
+        c = n.children;
+      return (c && c.length && (i += L(c, t, e, 0)), i);
+    }
+    case "column":
+      return h(n, t, e, 0);
+    case "synced_block":
+      return h(n, t, e, 0);
+    case "child_page": {
+      if (!e.debug) return "";
+      let a = s?.title || "";
+      return I("child_page", n, a);
+    }
+    case "child_database": {
+      if (!e.debug) return "";
+      let a = s?.title || "";
+      return I("child_database", n, a);
+    }
+    case "breadcrumb":
+      return e.debug ? I("breadcrumb", n, void 0) : "";
+    case "table_of_contents":
+      return e.debug ? I("table_of_contents", n, void 0) : "";
+    case "template":
+      return h(n, t, e, 0);
+    default:
+      return "";
+  }
+}
+function L(n, t, e, r) {
+  let s = "",
+    o = $(n);
+  for (let a of o) {
+    if (a.kind === "list_group") {
+      let i = a,
+        c = i.listType === "numbered_list_item" ? r + 1 : 0;
+      s +=
+        _e(i.items, i.listType, t, e, c) +
+        `
 
-`;continue}s+=he(a,t,e)+`
+`;
+      continue;
+    }
+    s +=
+      he(a, t, e) +
+      `
 
-`;}return s}function be(n=[],t){t=t??{};let e={listIndent:t.listIndent??"  ",debug:t.debug??false,alternateOrderedListStyles:t.alternateOrderedListStyles??false};return !Array.isArray(n)||n.length===0?"":L(n,0,e,0)}function ee(n){return n.type}function w(n){let t=ee(n);return n[t]}function R(n,t,e){let r=n.children;return !r||!r.length?"":te(r,t+1,e)}function xe(n,t,e,r){let s=t==="bulleted_list_item"?"ul":"ol",o=`<${s}>`;for(let a of n){let i=w(a),c=p(i?.rich_text??[],r.classPrefix);o+=`<li>${c}${R(a,e+1,r)}</li>`;}return o+=`</${s}>`,o}function Re(n,t){let e=w(n),r=n.children||[],s=!!e?.has_column_header,o="<table>";if(r.length){if(s){let i=r[0],d=w(i)?.cells||[];o+="<thead><tr>",o+=d.map(y=>`<th>${p(y?.[0]?.rich_text||[],t.classPrefix)}</th>`).join(""),o+="</tr></thead>";}let a=s?1:0;o+="<tbody>";for(let i=a;i<r.length;i++){let c=r[i],y=w(c)?.cells||[];o+="<tr>",o+=y.map(_=>`<td>${p(_?.[0]?.rich_text||[],t.classPrefix)}</td>`).join(""),o+="</tr>";}o+="</tbody>";}return o+="</table>",o}function we(n,t,e){let r=ee(n),s=w(n);switch(r){case "paragraph":return `<p>${p(s?.rich_text??[],e.classPrefix)}</p>`;case "quote":return `<blockquote>${p(s?.rich_text??[],e.classPrefix)}</blockquote>`;case "toggle":return `<details><summary>${p(s?.rich_text??[],e.classPrefix)}</summary>${R(n,t+1,e)}</details>`;case "to_do":{let o=!!s?.checked,a=p(s?.rich_text??[],e.classPrefix);return `<div class="notion-todo"><input type="checkbox" disabled ${o?"checked":""} /> ${a}${R(n,t+1,e)}</div>`}case "heading_1":return `<h1>${p(s?.rich_text??[],e.classPrefix)}</h1>`;case "heading_2":return `<h2>${p(s?.rich_text??[],e.classPrefix)}</h2>`;case "heading_3":return `<h3>${p(s?.rich_text??[],e.classPrefix)}</h3>`;case "code":{let o=s?.language||"",a=m(s?.rich_text??[]),i=C(a);return `<pre><code class="language-${o}">${i}</code></pre>`}case "bookmark":case "embed":case "link_preview":{let o=s?.url||"";return `<a href="${o}">${o}</a>`}case "image":{let o=s?.type==="external"?s?.external?.url:s?.file?.url,a=p(s?.caption??[],e.classPrefix);return `<figure><img src="${o||""}" />${a?`<figcaption>${a}</figcaption>`:""}</figure>`}case "video":case "audio":{let o=s?.type==="external"?s?.external?.url:s?.file?.url,a=r==="video"?"video":"audio",i=p(s?.caption??[],e.classPrefix);return `<figure><${a} src="${o||""}" controls></${a}>${i?`<figcaption>${i}</figcaption>`:""}</figure>`}case "file":case "pdf":{let o=s?.type==="external"?s?.external?.url:s?.file?.url,a=p(s?.caption??[],e.classPrefix);return `<div class="notion-file"><a href="${o||""}">${o||""}</a>${a?`<div class="caption">${a}</div>`:""}</div>`}case "equation":return `<span class="notion-equation">$$${s?.expression||""}$$</span>`;case "divider":return "<hr />";case "table":return Re(n,e);case "table_row":return "";case "columns":{let o=n.children,a='<div class="notion-columns">';return o&&o.length&&(a+=o.map(i=>`<div class="notion-column">${R(i,t+1,e)}</div>`).join("")),a+="</div>",a}case "column":case "synced_block":case "template":return R(n,t,e);case "child_page":return `<div class="notion-child-page">${s?.title||""}</div>`;case "child_database":return `<div class="notion-child-database">${s?.title||""}</div>`;case "breadcrumb":return '<nav class="notion-breadcrumb"></nav>';case "table_of_contents":return '<nav class="notion-toc"></nav>';default:return ""}}function te(n,t,e){let r="",s=$(n);for(let o of s){if(o.kind==="list_group"){let a=o;r+=xe(a.items,a.listType,t,e);continue}r+=we(o,t,e);}return r}function Pe(n=[],t={}){let e={classPrefix:t.classPrefix??""};return !Array.isArray(n)||n.length===0?"":te(n,0,e)}export{j as NotionCMS,U as OPERATOR_MAP,b as QueryBuilder,Pe as blocksToHtml,be as blocksToMarkdown,z as convertBlockToSimple,ie as convertBlocksToAdvanced,O as convertBlocksToSimple,Z as convertRecord,B as convertRecordToAdvanced,F as convertRecordToSimple,de as convertRecords,pe as registerDatabase,p as richTextToHtml,l as richTextToMarkdown,m as richTextToPlain};
\ No newline at end of file
+`;
+  }
+  return s;
+}
+function be(n = [], t) {
+  t = t ?? {};
+  let e = {
+    listIndent: t.listIndent ?? "  ",
+    debug: t.debug ?? false,
+    alternateOrderedListStyles: t.alternateOrderedListStyles ?? false,
+  };
+  return !Array.isArray(n) || n.length === 0 ? "" : L(n, 0, e, 0);
+}
+function ee(n) {
+  return n.type;
+}
+function w(n) {
+  let t = ee(n);
+  return n[t];
+}
+function R(n, t, e) {
+  let r = n.children;
+  return !r || !r.length ? "" : te(r, t + 1, e);
+}
+function xe(n, t, e, r) {
+  let s = t === "bulleted_list_item" ? "ul" : "ol",
+    o = `<${s}>`;
+  for (let a of n) {
+    let i = w(a),
+      c = p(i?.rich_text ?? [], r.classPrefix);
+    o += `<li>${c}${R(a, e + 1, r)}</li>`;
+  }
+  return ((o += `</${s}>`), o);
+}
+function Re(n, t) {
+  let e = w(n),
+    r = n.children || [],
+    s = !!e?.has_column_header,
+    o = "<table>";
+  if (r.length) {
+    if (s) {
+      let i = r[0],
+        d = w(i)?.cells || [];
+      ((o += "<thead><tr>"),
+        (o += d
+          .map((y) => `<th>${p(y?.[0]?.rich_text || [], t.classPrefix)}</th>`)
+          .join("")),
+        (o += "</tr></thead>"));
+    }
+    let a = s ? 1 : 0;
+    o += "<tbody>";
+    for (let i = a; i < r.length; i++) {
+      let c = r[i],
+        y = w(c)?.cells || [];
+      ((o += "<tr>"),
+        (o += y
+          .map((_) => `<td>${p(_?.[0]?.rich_text || [], t.classPrefix)}</td>`)
+          .join("")),
+        (o += "</tr>"));
+    }
+    o += "</tbody>";
+  }
+  return ((o += "</table>"), o);
+}
+function we(n, t, e) {
+  let r = ee(n),
+    s = w(n);
+  switch (r) {
+    case "paragraph":
+      return `<p>${p(s?.rich_text ?? [], e.classPrefix)}</p>`;
+    case "quote":
+      return `<blockquote>${p(s?.rich_text ?? [], e.classPrefix)}</blockquote>`;
+    case "toggle":
+      return `<details><summary>${p(s?.rich_text ?? [], e.classPrefix)}</summary>${R(n, t + 1, e)}</details>`;
+    case "to_do": {
+      let o = !!s?.checked,
+        a = p(s?.rich_text ?? [], e.classPrefix);
+      return `<div class="notion-todo"><input type="checkbox" disabled ${o ? "checked" : ""} /> ${a}${R(n, t + 1, e)}</div>`;
+    }
+    case "heading_1":
+      return `<h1>${p(s?.rich_text ?? [], e.classPrefix)}</h1>`;
+    case "heading_2":
+      return `<h2>${p(s?.rich_text ?? [], e.classPrefix)}</h2>`;
+    case "heading_3":
+      return `<h3>${p(s?.rich_text ?? [], e.classPrefix)}</h3>`;
+    case "code": {
+      let o = s?.language || "",
+        a = m(s?.rich_text ?? []),
+        i = C(a);
+      return `<pre><code class="language-${o}">${i}</code></pre>`;
+    }
+    case "bookmark":
+    case "embed":
+    case "link_preview": {
+      let o = s?.url || "";
+      return `<a href="${o}">${o}</a>`;
+    }
+    case "image": {
+      let o = s?.type === "external" ? s?.external?.url : s?.file?.url,
+        a = p(s?.caption ?? [], e.classPrefix);
+      return `<figure><img src="${o || ""}" />${a ? `<figcaption>${a}</figcaption>` : ""}</figure>`;
+    }
+    case "video":
+    case "audio": {
+      let o = s?.type === "external" ? s?.external?.url : s?.file?.url,
+        a = r === "video" ? "video" : "audio",
+        i = p(s?.caption ?? [], e.classPrefix);
+      return `<figure><${a} src="${o || ""}" controls></${a}>${i ? `<figcaption>${i}</figcaption>` : ""}</figure>`;
+    }
+    case "file":
+    case "pdf": {
+      let o = s?.type === "external" ? s?.external?.url : s?.file?.url,
+        a = p(s?.caption ?? [], e.classPrefix);
+      return `<div class="notion-file"><a href="${o || ""}">${o || ""}</a>${a ? `<div class="caption">${a}</div>` : ""}</div>`;
+    }
+    case "equation":
+      return `<span class="notion-equation">$$${s?.expression || ""}$$</span>`;
+    case "divider":
+      return "<hr />";
+    case "table":
+      return Re(n, e);
+    case "table_row":
+      return "";
+    case "columns": {
+      let o = n.children,
+        a = '<div class="notion-columns">';
+      return (
+        o &&
+          o.length &&
+          (a += o
+            .map((i) => `<div class="notion-column">${R(i, t + 1, e)}</div>`)
+            .join("")),
+        (a += "</div>"),
+        a
+      );
+    }
+    case "column":
+    case "synced_block":
+    case "template":
+      return R(n, t, e);
+    case "child_page":
+      return `<div class="notion-child-page">${s?.title || ""}</div>`;
+    case "child_database":
+      return `<div class="notion-child-database">${s?.title || ""}</div>`;
+    case "breadcrumb":
+      return '<nav class="notion-breadcrumb"></nav>';
+    case "table_of_contents":
+      return '<nav class="notion-toc"></nav>';
+    default:
+      return "";
+  }
+}
+function te(n, t, e) {
+  let r = "",
+    s = $(n);
+  for (let o of s) {
+    if (o.kind === "list_group") {
+      let a = o;
+      r += xe(a.items, a.listType, t, e);
+      continue;
+    }
+    r += we(o, t, e);
+  }
+  return r;
+}
+function Pe(n = [], t = {}) {
+  let e = { classPrefix: t.classPrefix ?? "" };
+  return !Array.isArray(n) || n.length === 0 ? "" : te(n, 0, e);
+}
+export {
+  j as NotionCMS,
+  U as OPERATOR_MAP,
+  b as QueryBuilder,
+  Pe as blocksToHtml,
+  be as blocksToMarkdown,
+  z as convertBlockToSimple,
+  ie as convertBlocksToAdvanced,
+  O as convertBlocksToSimple,
+  Z as convertRecord,
+  B as convertRecordToAdvanced,
+  F as convertRecordToSimple,
+  de as convertRecords,
+  pe as registerDatabase,
+  p as richTextToHtml,
+  l as richTextToMarkdown,
+  m as richTextToPlain,
+};
